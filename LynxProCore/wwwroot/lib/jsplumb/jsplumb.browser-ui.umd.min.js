/**
 * Minified by jsDelivr using Terser v5.17.1.
 * Original file: /npm/@jsplumb/browser-ui@6.2.10/js/jsplumb.browser-ui.umd.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).jsPlumb={})}(this,(function(t){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function a(t){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},a(t)}function l(t,e){return l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},l(t,e)}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=a(t);if(e){var o=a(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return function(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?u(t):e}(this,n)}}function h(t,e,n){return h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=a(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}},h(t,e,n||t)}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var i,o,r=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(r.push(i.value),!e||r.length!==e);s=!0);}catch(t){a=!0,o=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw o}}return r}(t,e)||f(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t){return function(t){if(Array.isArray(t))return v(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||f(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){if(t){if("string"==typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(t,e):void 0}}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function g(t,e,n){return"*"===t||(t.length>0?-1!==t.indexOf(e):!n)}function y(t,e,n){var i,o=t=t||{},r=e=e||{};if(n)for(i=0;i<n.length;i++)o[n[i]]=r[n[i]];else for(i in r)o[i]=r[i];return t}function m(t){return"[object Number]"===Object.prototype.toString.call(t)}function _(t){return"string"==typeof t}function E(t){return"boolean"==typeof t}function x(t){return null!=t&&"[object Object]"===Object.prototype.toString.call(t)}function b(t){return"[object Date]"===Object.prototype.toString.call(t)}function k(t){return"[object Function]"===Object.prototype.toString.call(t)}function C(t){if(_(t))return""+t;if(E(t))return!!t;if(b(t))return new Date(t.getTime());if(k(t))return t;if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++)e.push(C(t[n]));return e}if(x(t)){var i={};for(var o in t)i[o]=C(t[o]);return i}return t}function S(t,e,n,i){var o,r,s={},a={};for(n=n||[],i=i||[],r=0;r<n.length;r++)s[n[r]]=!0;for(r=0;r<i.length;r++)a[i[r]]=!0;var l=C(t);for(r in e)if(null==l[r]||a[r])l[r]=e[r];else if(s[r])(o=[]).push.apply(o,Array.isArray(l[r])?l[r]:[l[r]]),o.push(e[r]),l[r]=o;else if(_(e[r])||E(e[r])||k(e[r])||m(e[r]))l[r]=e[r];else if(Array.isArray(e[r]))o=[],Array.isArray(l[r])&&o.push.apply(o,l[r]),o.push.apply(o,e[r]),l[r]=o;else if(x(e[r]))for(var u in x(l[r])||(l[r]={}),e[r])l[r][u]=e[r][u];return l}function P(t,e){if(null!=t&&null==e)return!1;if((null==t||_(t)||E(t)||m(t))&&t!==e)return!1;if(Array.isArray(t)){if(!Array.isArray(e))return!1;if(!T(t,e))return!1}else if(x(t)){if(!x(t))return!1;if(!A(t,e))return!1}return!0}function T(t,e){if(null==t&&null==e)return!0;if(null==t&&null!=e)return!1;if(null!=t&&null==e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!P(t[n],e[n]))return!1;return!0}function A(t,e){if(null==t&&null==e)return!0;if(null==t&&null!=e)return!1;if(null!=t&&null==e)return!1;for(var n in t){if(!P(t[n],e[n]))return!1}return!0}function M(t,e,n){for(var i=0;i<n.length;i++){var o=n[i][0][n[i][1]].apply(n[i][0],n[i][2]);if(o===e)return o}return t}function w(t,e,n,i){return function t(o){if(null!=o){if(_(o))return function(t){var n=t.match(/(\${.*?})/g);if(null!=n)for(var i=0;i<n.length;i++){var o=e[n[i].substring(2,n[i].length-1)]||"";null!=o&&(t=t.replace(n[i],o))}if(null!=(n=t.match(/({{.*?}})/g)))for(var r=0;r<n.length;r++){var s=e[n[r].substring(2,n[r].length-2)]||"";null!=s&&(t=t.replace(n[r],s))}return t}(o);if(!k(o)||i||null!=n&&0!==(o.name||"").indexOf(n)){if(Array.isArray(o)){for(var r=[],s=0;s<o.length;s++)r.push(t(o[s]));return r}if(x(o)){var a={};for(var l in o)a[l]=t(o[l]);return a}return o}return o(e)}}(t)}function D(t,e){if(!t)return null;for(var n=0;n<t.length;n++)e(t[n])}function O(t,e){if(t)for(var n=0;n<t.length;n++)if(e(t[n]))return n;return-1}function I(t,e){var n=[];if(t)for(var i=0;i<t.length;i++)e(t[i])&&n.push(i);return n}function j(t,e){var n=O(t,e);return-1===n?null:t[n]}function L(t,e){return I(t,e).map((function(e){return t[e]}))}function N(t,e){var n=null;return t.forEach((function(t){e(t)&&(n=t)})),n}function G(t){var e=[];return t.forEach((function(t){e.push(t)})),e}function R(t,e){var n=O(t,e);return n>-1&&t.splice(n,1),-1!==n}function F(t){if(null!=Array.fromArray)return Array.from(t);var e=[];return Array.prototype.push.apply(e,t),e}function V(t,e){var n=t.indexOf(e);return n>-1&&t.splice(n,1),-1!==n}function H(t,e,n,i){var o=t[e];return null==o&&(o=[],t[e]=o),o[i?"unshift":"push"](n),o}function U(t,e,n){return-1===t.indexOf(e)&&(n?t.unshift(e):t.push(e),!0)}for(var B=[],Y=0;Y<256;Y++)B[Y]=(Y<16?"0":"")+Y.toString(16);function X(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return B[255&t]+B[t>>8&255]+B[t>>16&255]+B[t>>24&255]+"-"+B[255&e]+B[e>>8&255]+"-"+B[e>>16&15|64]+B[e>>24&255]+"-"+B[63&n|128]+B[n>>8&255]+"-"+B[n>>16&255]+B[n>>24&255]+B[255&i]+B[i>>8&255]+B[i>>16&255]+B[i>>24&255]}function z(t,e,n){var i=t.x-e.x,o=t.y-e.y,r=Math.cos(n/360*Math.PI*2),s=Math.sin(n/360*Math.PI*2);return{x:i*r-o*s+e.x,y:o*r+i*s+e.y,cr:r,sr:s}}function W(t){if(null==t)return null;for(var e=t.replace(/^\s\s*/,""),n=/\s/,i=e.length;n.test(e.charAt(--i)););return e.slice(0,i+1)}function q(t,e){t=null==t.length||"string"==typeof t?[t]:t;for(var n=0;n<t.length;n++)e(t[n])}function K(t,e){for(var n=[],i=0;i<t.length;i++)n.push(e(t[i]));return n}var Z;function J(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if("undefined"!=typeof console)try{var i=arguments[arguments.length-1];console.log(i)}catch(t){}}function Q(t){return t<0?-1:t>0?1:0}function $(t,e,n){return function(){var i=null;try{null!=e&&(i=e.apply(this,arguments))}catch(t){J("jsPlumb function failed : "+t)}if(null!=t&&(null==n||i!==n))try{i=t.apply(this,arguments)}catch(t){J("wrapped function failed : "+t)}return i}}function tt(t,e,n){return t.has(e)||t.set(e,n()),t.get(e)}function et(t,e){for(var n=t.__proto__;null!=n;){if(n instanceof e)return!0;n=n.__proto__}return!1}function nt(t,e,n,i){if(0===e.length)e.push(t);else{for(var o=i?-1:1,r=0,s=e.length,a=Math.floor((r+s)/2);s>r;){n(t,e[a])*o<0?s=a:r=a+1,a=Math.floor((r+s)/2)}e.splice(a,0,t)}}function it(t,e,n){for(var i=(n=n||t.parentNode).querySelectorAll(e),o=0;o<i.length;o++)if(i[o]===t)return!0;return!1}function ot(t,e){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!e&&t.preventDefault&&t.preventDefault()}function rt(t,e,n,i){if(i&&it(t,e,n))return t;for(t=t.parentNode;null!=t&&t!==n;){if(it(t,e))return t;t=t.parentNode}}function st(t){return t.srcElement||t.target}function at(t){return null!=t.className?void 0===t.className.baseVal?t.className:t.className.baseVal:""}function lt(t,e,n){var i=null==e?[]:Array.isArray(e)?e:e.split(/\s+/),o=null==n?[]:Array.isArray(n)?n:n.split(/\s+/),r=at(t).split(/\s+/),s=function(t,e){for(var n=0;n<e.length;n++)if(t)-1===r.indexOf(e[n])&&r.push(e[n]);else{var i=r.indexOf(e[n]);-1!==i&&r.splice(i,1)}};s(!0,i),s(!1,o),function(t,e,n){e=W(e),void 0!==t.className.baseVal?t.className.baseVal=e:t.className=e;try{var i=t.classList;if(null!=i){for(;i.length>0;)i.remove(i.item(0));for(var o=0;o<n.length;o++)n[o]&&i.add(n[o])}}catch(t){J("WARN: cannot set class list",t)}}(t,r.join(" "),r)}function ut(t){return!_(t)&&!Array.isArray(t)&&null!=t.length&&null==t.documentElement&&null==t.nodeType}function ct(t){return at(t)}function ht(t,e){var n=function(t,e){null!=t&&null!=e&&e.length>0&&(t.classList?D(W(e).split(/\s+/),(function(e){t.classList.add(e)})):lt(t,e))};ut(t)?D(t,(function(t){return n(t,e)})):n(t,e)}function dt(t,e){return t.classList?t.classList.contains(e):-1!==at(t).indexOf(e)}function pt(t,e){var n=function(t,e){null!=t&&null!=e&&e.length>0&&(t.classList?W(e).split(/\s+/).forEach((function(e){t.classList.remove(e)})):lt(t,null,e))};ut(t)?D(t,(function(t){return n(t,e)})):n(t,e)}function ft(t,e){var n=this,i=function(t,e){null!=t&&null!=e&&e.length>0&&(t.classList?t.classList.toggle(e):n.hasClass(t,e)?n.removeClass(t,e):n.addClass(t,e))};ut(t)?D(t,(function(t){return i(t,e)})):i(t,e)}function vt(t,e,n,i){return gt(null,t,e,n,i)}function gt(t,e,n,i,o){var r,s=null==t?document.createElement(e):document.createElementNS(t,e);for(r in n=n||{})s.style[r]=n[r];for(r in i&&(s.className=i),o=o||{})s.setAttribute(r,""+o[r]);return s}function yt(t){var e=t.getBoundingClientRect(),n=document.body,i=document.documentElement,o=window.pageYOffset||i.scrollTop||n.scrollTop,r=window.pageXOffset||i.scrollLeft||n.scrollLeft,s=i.clientTop||n.clientTop||0,a=i.clientLeft||n.clientLeft||0,l=e.top+o-s,u=e.left+r-a;return{x:Math.round(u),y:Math.round(l)}}function mt(t){return{w:t.offsetWidth,h:t.offsetHeight}}function _t(t){try{return{w:parseFloat(t.width.baseVal.value),h:parseFloat(t.height.baseVal.value)}}catch(t){return{w:0,h:0}}}function Et(t){try{return{x:parseFloat(t.x.baseVal.value),y:parseFloat(t.y.baseVal.value)}}catch(t){return{x:0,y:0}}}function xt(t,e){var n=e.getContainer().getBoundingClientRect(),i=t.getBoundingClientRect(),o=e.currentZoom;return{x:(i.left-n.left)/o,y:(i.top-n.top)/o}}function bt(t,e){var n=t.getBoundingClientRect(),i=e.currentZoom;return{w:n.width/i,h:n.height/i}}function kt(e){return e instanceof SVGElement?t.ElementTypes.SVG:t.ElementTypes.HTML}function Ct(e){return kt(e)===t.ElementTypes.SVG}function St(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.map((function(t){return"."+t})).join(",")}function Pt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.join(" ")}function Tt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.map((function(t){return"["+t+"]"})).join(",")}t.ElementTypes=void 0,(Z=t.ElementTypes||(t.ElementTypes={})).SVG="SVG",Z.HTML="HTML";var At="source",Mt="target",wt="block",Dt="none",Ot="absolute",It="fixed",jt="static",Lt="data-jtk-group",Nt="data-jtk-managed",Gt="data-jtk-not-draggable",Rt="tabindex",Ft="data-jtk-scope",Vt=Ft+"-",Ht="checkCondition",Ut="checkDropAllowed",Bt="jtk-connector",Yt="jtk-connector-outline",Xt="jtk-connected",zt="jtk-endpoint",Wt="jtk-endpoint-connected",qt="jtk-endpoint-full",Kt="jtk-floating-endpoint",Zt="jtk-endpoint-drop-allowed",Jt="jtk-endpoint-drop-forbidden",Qt="jtk-endpoint-anchor",$t="jtk-group-collapsed",te="jtk-group-expanded",ee="jtk-overlay",ne="anchor:changed",ie="connection",oe="internal.connection",re="connection:detach",se="connection:move",ae="container:change",le="endpoint:replaced",ue="internal.endpoint:unregistered",ce="internal.connection:detached",he="element:manage",de="group:added",pe="group:collapse",fe="group:expand",ve="group:member:added",ge="group:member:removed",ye="group:removed",me="maxConnections",_e="group:nested:added",Ee="group:nested:removed",xe="element:unmanage",be="zoom",ke="isDetachAllowed",Ce="beforeDrag",Se="beforeDrop",Pe="beforeDetach",Te="beforeStartDetach",Ae=Tt(Nt),Me="Cannot establish connection: source endpoint is full",we="Cannot establish connection: target endpoint is full",De="Cannot establish connection: source does not exist",Oe="Cannot establish connection: target does not exist",Ie="connectionOverlays",je={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},Le="stroke-dasharray",Ne="dashstyle",Ge="fill",Re="stroke",Fe="stroke-width",Ve="strokeWidth",He="svg",Ue="path",Be={svg:"http://www.w3.org/2000/svg"};function Ye(t,e){for(var n in e)t.setAttribute(n,""+e[n])}function Xe(t,e){return(e=e||{}).version="1.1",e.xmlns=Be.svg,gt(Be.svg,t,null,null,e)}function ze(t){return"position:absolute;left:"+t[0]+"px;top:"+t[1]+"px"}function We(t,e,n){if(e.setAttribute(Ge,n.fill?n.fill:Dt),e.setAttribute(Re,n.stroke?n.stroke:Dt),n.strokeWidth&&e.setAttribute(Fe,n.strokeWidth),n[Ne]&&n[Ve]&&!n[Le]){var i=-1===n[Ne].indexOf(",")?" ":",",o=n[Ne].split(i),r="";D(o,(function(t){r+=Math.floor(t*n.strokeWidth)+i})),e.setAttribute(Le,r)}else n[Le]&&e.setAttribute(Le,n[Le]);for(var s in je)n[s]&&e.setAttribute(je[s],n[s])}function qe(t,e,n){t.childNodes.length>n?t.insertBefore(e,t.childNodes[n]):t.appendChild(e)}var Ke={attr:Ye,node:Xe,ns:Be};function Ze(t,e,n){var i=[t,e];return n&&i.push(n),i.join(":")}var Je,Qe,$e="data-jtk-container",tn="data-jtk-group-content",en="data-jtk-enabled",nn="data-jtk-scope",on="endpoint",rn="element",sn="connection",an="div",ln="click",un="contextmenu",cn="dblclick",hn="dbltap",dn="focus",pn="mousedown",fn="mouseenter",vn="mouseexit",gn="mousemove",yn="mouseup",mn="mouseout",_n="mouseover",En="tap",xn="touchstart",bn="touchend",kn="touchmove",Cn="drag:move",Sn="drag:stop",Pn="drag:start",Tn="revert",An="connection:abort",Mn="connection:drag",wn=Ze(rn,ln),Dn=Ze(rn,cn),On=Ze(rn,hn),In=Ze(rn,mn),jn=Ze(rn,_n),Ln=Ze(rn,gn),Nn=Ze(rn,yn),Gn=Ze(rn,pn),Rn=Ze(rn,un),Fn=Ze(rn,En),Vn=Ze(on,ln),Hn=Ze(on,cn),Un=Ze(on,hn),Bn=Ze(on,mn),Yn=Ze(on,_n),Xn=Ze(on,yn),zn=Ze(on,pn),Wn=Ze(on,En),qn=Ze(sn,ln),Kn=Ze(sn,cn),Zn=Ze(sn,hn),Jn=Ze(sn,mn),Qn=Ze(sn,_n),$n=Ze(sn,yn),ti=Ze(sn,pn),ei=Ze(sn,un),ni=Ze(sn,En),ii="position",oi=St(Bt),ri=St(zt),si=Tt(Lt),ai=Tt(tn),li=St(ee);function ui(){return{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}}t.PerimeterAnchorShapes=void 0,(Je=t.PerimeterAnchorShapes||(t.PerimeterAnchorShapes={})).Circle="Circle",Je.Ellipse="Ellipse",Je.Triangle="Triangle",Je.Diamond="Diamond",Je.Rectangle="Rectangle",Je.Square="Square",t.AnchorLocations=void 0,(Qe=t.AnchorLocations||(t.AnchorLocations={})).Assign="Assign",Qe.AutoDefault="AutoDefault",Qe.Bottom="Bottom",Qe.BottomLeft="BottomLeft",Qe.BottomRight="BottomRight",Qe.Center="Center",Qe.Continuous="Continuous",Qe.ContinuousBottom="ContinuousBottom",Qe.ContinuousLeft="ContinuousLeft",Qe.ContinuousRight="ContinuousRight",Qe.ContinuousTop="ContinuousTop",Qe.ContinuousLeftRight="ContinuousLeftRight",Qe.ContinuousTopBottom="ContinuousTopBottom",Qe.Left="Left",Qe.Perimeter="Perimeter",Qe.Right="Right",Qe.Top="Top",Qe.TopLeft="TopLeft",Qe.TopRight="TopRight";var ci,hi,di=function(){function t(e){n(this,t),this.params=e,r(this,"x1",void 0),r(this,"x2",void 0),r(this,"y1",void 0),r(this,"y2",void 0),r(this,"extents",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),r(this,"type",void 0),this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2}return o(t,[{key:"findClosestPointOnPath",value:function(t,e){return{d:1/0,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(t,e,n,i){return[]}},{key:"boxIntersection",value:function(t,e,n,i){var o=[];return o.push.apply(o,this.lineIntersection(t,e,t+n,e)),o.push.apply(o,this.lineIntersection(t+n,e,t+n,e+i)),o.push.apply(o,this.lineIntersection(t+n,e+i,t,e+i)),o.push.apply(o,this.lineIntersection(t,e+i,t,e)),o}},{key:"boundingBoxIntersection",value:function(t){return this.boxIntersection(t.x,t.y,t.w,t.h)}}]),t}(),pi="undefined",fi="default",vi="true",gi="false",yi="*";function mi(t,e,n,i,o,r,s){return function(){var t=[];return t.push.apply(t,arguments),t.item=function(t){return this[t]},t}(function(t,e,n,i,o,r,s){return new Touch({target:t,identifier:X(),pageX:e,pageY:n,screenX:i,screenY:o,clientX:r||i,clientY:s||o})}(t,e,n,i,o,r,s))}function _i(t,e,n){for(var i=(n=n||t.parentNode).querySelectorAll(e),o=0;o<i.length;o++)if(i[o]===t)return!0;return!1}function Ei(t){return t.srcElement||t.target}function xi(t,e,n,i){if(i){var o=t.composedPath?t.composedPath():t.path;if(void 0!==o&&o.indexOf)return{path:o,end:o.indexOf(n)};var r={path:[],end:-1};return function t(e){r.path.push(e),e===n?r.end=r.path.length-1:null!=e.parentNode&&t(e.parentNode)}(e),r}return{path:[e],end:1}}var bi=1,ki=!1,Ci=!1;function Si(){return ki||"ontouchstart"in document.documentElement||null!=navigator.maxTouchPoints&&navigator.maxTouchPoints>0}function Pi(){return Ci||"onmousedown"in document.documentElement}var Ti=(r(ci={},pn,xn),r(ci,yn,bn),r(ci,gn,kn),ci),Ai="page";function Mi(t,e){if(null==t)return{x:0,y:0};var n=Di(Oi(t),0);return{x:n[e+"X"],y:n[e+"Y"]}}function wi(t){return Mi(t,Ai)}function Di(t,e){return t.item?t.item(e):t[e]}function Oi(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]}function Ii(t){return Oi(t).length}function ji(t,e,n,i,o){if(Gi(t,e,n),i.__tauid=n.__tauid,t.addEventListener)t.addEventListener(e,n,!1,o);else if(t.attachEvent){var r=e+n.__tauid;t["e"+r]=n,t[r]=function(){t["e"+r]&&t["e"+r](window.event)},t.attachEvent("on"+e,t[r])}}function Li(t,e,n){var i=this;null!=n&&Ni(t,(function(o){if(function(t,e,n){if(t.__ta&&t.__ta[e]&&delete t.__ta[e][n.__tauid],n.__taExtra){for(var i=0;i<n.__taExtra.length;i++)Li(t,n.__taExtra[i][0],n.__taExtra[i][1]);n.__taExtra.length=0}n.__taUnstore&&n.__taUnstore()}(o,e,n),null!=n.__tauid)if(o.removeEventListener)o.removeEventListener(e,n,!1),Si()&&Ti[e]&&o.removeEventListener(Ti[e],n,!1);else if(i.detachEvent){var r=e+n.__tauid;o[r]&&o.detachEvent("on"+e,o[r]),o[r]=null,o["e"+r]=null}n.__taTouchProxy&&Li(t,n.__taTouchProxy[1],n.__taTouchProxy[0])}))}function Ni(t,e){if(null!=t)for(var n="string"==typeof t?document.querySelectorAll(t):null!=t.length?t:[t],i=0;i<n.length;i++)e(n[i])}function Gi(t,e,n){var i=bi++;return t.__ta=t.__ta||{},t.__ta[e]=t.__ta[e]||{},t.__ta[e][i]=n,n.__tauid=i,i}var Ri=/:not\(([^)]+)\)/;function Fi(t,e,n,i){if(null==t)return n;var o=t.split(","),r=[],s=[];D(o,(function(t){var e=t.match(Ri);null!=e?s.push(e[1]):r.push(t)})),s.length>0&&0===r.length&&r.push(yi);var a=function i(o){i.__tauid=n.__tauid;var a=Ei(o),l=!1,u=a,c=xi(o,a,e,null!=t);if(-1!=c.end)for(var h=0;!l&&h<c.end;h++){u=c.path[h];for(var d=0;d<s.length;d++)if(_i(u,s[d],e))return;for(var p=0;!l&&p<r.length;p++)if(_i(u,r[p],e)){n.apply(u,[o,u]),l=!0;break}}};return function(t,e,n){t.__taExtra=t.__taExtra||[],t.__taExtra.push([e,n])}(n,i,a),a}var Vi=function(t,e,n,i,o){if(Si()&&Ti[e]){var r=Fi(i,t,n,Ti[e]);ji(t,Ti[e],r,n,o)}e===dn&&null==t.getAttribute(Rt)&&t.setAttribute(Rt,"1"),ji(t,e,Fi(i,t,n,e),n,o)},Hi=(r(hi={},En,{touches:1,taps:1}),r(hi,hn,{touches:1,taps:2}),r(hi,un,{touches:2,taps:1}),hi);function Ui(t,e,n,i){for(var o in n.__tamee[t])n.__tamee[t].hasOwnProperty(o)&&n.__tamee[t][o].apply(i,[e])}var Bi=function(){function t(){n(this,t)}return o(t,null,[{key:"generate",value:function(t,e){return function(n,i,o,r){if(i==un&&Pi())Vi(n,i,o,r);else{if(null==n.__taTapHandler){var s=n.__taTapHandler={tap:[],dbltap:[],down:!1,taps:0,downSelectors:[]},a=function(i){for(var o=Ei(i),a=xi(i,o,n,null!=r),l=!1,h=0;h<a.end;h++){if(l)return;o=a.path[h];for(var d=0;d<s.downSelectors.length;d++)if(null==s.downSelectors[d]||_i(o,s.downSelectors[d],n)){s.down=!0,setTimeout(u,t),setTimeout(c,e),l=!0;break}}},l=function(t){if(s.down){var e,i,o=Ei(t);s.taps++;var r=Ii(t);for(var a in Hi)if(Hi.hasOwnProperty(a)){var l=Hi[a];if(l.touches===r&&(1===l.taps||l.taps===s.taps))for(var u=0;u<s[a].length;u++){i=xi(t,o,n,null!=s[a][u][1]);for(var c=0;c<i.end;c++)if(e=i.path[c],null==s[a][u][1]||_i(e,s[a][u][1],n)){s[a][u][0].apply(e,[t,e]);break}}}}},u=function(){s.down=!1},c=function(){s.taps=0};n.__taTapHandler.downHandler=a,n.__taTapHandler.upHandler=l,Vi(n,pn,a),Vi(n,yn,l)}n.__taTapHandler.downSelectors.push(r),n.__taTapHandler[i].push([o,r]),o.__taUnstore=function(){null!=n.__taTapHandler&&(R(n.__taTapHandler.downSelectors,(function(t){return t===r})),function(t,e){var n,i=0;for(i=0,n=t.length;i<n&&t[i][0]!==e;i++);i<t.length&&t.splice(i,1)}(n.__taTapHandler[i],o),0===n.__taTapHandler.downSelectors.length&&(Li(n,pn,n.__taTapHandler.downHandler),Li(n,yn,n.__taTapHandler.upHandler),delete n.__taTapHandler))}}}}}]),t}(),Yi=function(){function t(){n(this,t)}return o(t,null,[{key:"generate",value:function(){var t=[];return function(e,n,i,o){if(!e.__tamee){e.__tamee={over:!1,mouseenter:[],mouseexit:[]};var r=function(n){var i=Ei(n);(null==o&&i==e&&!e.__tamee.over||_i(i,o,e)&&(null==i.__tamee||!i.__tamee.over))&&(Ui(fn,n,e,i),i.__tamee=i.__tamee||{},i.__tamee.over=!0,t.push(i))},s=function(n){for(var i=Ei(n),o=0;o<t.length;o++)i!=t[o]||_i(n.relatedTarget||n.toElement,"*",i)||(i.__tamee.over=!1,t.splice(o,1),Ui(vn,n,e,i))};ji(e,_n,Fi(o,e,r,_n),r),ji(e,mn,Fi(o,e,s,mn),s)}i.__taUnstore=function(){delete e.__tamee[n][i.__tauid]},Gi(e,n,i),e.__tamee[n][i.__tauid]=i}}}]),t}(),Xi=function(){function t(e){n(this,t),r(this,"clickThreshold",void 0),r(this,"dblClickThreshold",void 0),r(this,"tapHandler",void 0),r(this,"mouseEnterExitHandler",void 0),e=e||{},this.clickThreshold=e.clickThreshold||250,this.dblClickThreshold=e.dblClickThreshold||450,this.mouseEnterExitHandler=Yi.generate(),this.tapHandler=Bi.generate(this.clickThreshold,this.dblClickThreshold)}return o(t,[{key:"_doBind",value:function(t,e,n,i,o){if(null!=n){var r=t;e===En||e===hn||e===un?this.tapHandler(r,e,n,i,o):e===fn||e==vn?this.mouseEnterExitHandler(r,e,n,i,o):Vi(r,e,n,i,o)}}},{key:"on",value:function(t,e,n,i,o){var r=null==i?null:n,s=null==i?n:i;return this._doBind(t,e,s,r,o),this}},{key:"off",value:function(t,e,n){return Li(t,e,n),this}},{key:"trigger",value:function(t,e,n,i,o){var r=Pi()&&("undefined"==typeof MouseEvent||null==n||n.constructor===MouseEvent),s=Si()&&!Pi()&&Ti[e]?Ti[e]:e,a=!(Si()&&!Pi()&&Ti[e]),l=wi(n),u=Mi(n,"screen"),c=function(t){return Mi(t,"client")}(n);return Ni(t,(function(t){var h;n=n||{screenX:u.x,screenY:u.y,clientX:c.x,clientY:c.y};var d,p={TouchEvent:function(e){var n=mi(t,l.x,l.y,u.x,u.y,c.x,c.y);(e.initTouchEvent||e.initEvent)(s,!0,!0,window,null,u.x,u.y,c.x,c.y,!1,!1,!1,!1,n,n,n,1,0)},MouseEvents:function(e){e.initMouseEvent(s,!0,!0,window,null==o?1:o,u.x,u.y,c.x,c.y,!1,!1,!1,!1,1,t)}},f=!a&&!r&&Si()&&Ti[e]?"TouchEvent":"MouseEvents";h=document.createEvent(f),p[f](h),d=h,i&&(d.payload=i),t.dispatchEvent(h)})),this}}]),t}();var zi=[null,[1,-1],[1,1],[-1,1],[-1,-1]],Wi=[null,[-1,-1],[-1,1],[1,1],[1,-1]],qi=2*Math.PI;function Ki(t,e){return e.x===t.x?e.y>t.y?1/0:-1/0:e.y===t.y?e.x>t.x?0:-0:(e.y-t.y)/(e.x-t.x)}function Zi(t,e){return-1/Ki(t,e)}function Ji(t,e){return Math.sqrt(Math.pow(e.y-t.y,2)+Math.pow(e.x-t.x,2))}function Qi(t,e){return e.x>t.x||e.x==t.x?e.y>t.y?2:1:e.y>t.y?3:4}function $i(t,e){var n=Ki(t,e),i=Math.atan(n),o=Qi(t,e);return 4!=o&&3!=o||(i+=Math.PI),i<0&&(i+=2*Math.PI),i}function to(t,e){var n=t.x,i=t.x+t.w,o=t.y,r=t.y+t.h,s=e.x,a=e.x+e.w,l=e.y,u=e.y+e.h;return n<=s&&s<=i&&o<=l&&l<=r||n<=a&&a<=i&&o<=l&&l<=r||n<=s&&s<=i&&o<=u&&u<=r||n<=a&&s<=i&&o<=u&&u<=r||s<=n&&n<=a&&l<=o&&o<=u||s<=i&&i<=a&&l<=o&&o<=u||s<=n&&n<=a&&l<=r&&r<=u||s<=i&&n<=a&&l<=r&&r<=u}function eo(t){var e=t[1].y-t[0].y,n=t[0].x-t[1].x;return{A:e,B:n,C:no(e*t[0].x+n*t[0].y)}}function no(t,e){return e=null==e?3:e,Math.floor(t*Math.pow(10,e))/Math.pow(10,e)}function io(t,e){var n=eo(t),i=eo(e),o=n.A*i.B-i.A*n.B;if(0==o)return null;var r={x:Math.round((i.B*n.C-n.B*i.C)/o),y:Math.round((n.A*i.C-i.A*n.C)/o)},s=Math.floor(Math.min(t[0].x,t[1].x)),a=Math.round(Math.max(t[0].x,t[1].x)),l=Math.floor(Math.min(t[0].y,t[1].y)),u=Math.round(Math.max(t[0].y,t[1].y)),c=Math.floor(Math.min(e[0].x,e[1].x)),h=Math.round(Math.max(e[0].x,e[1].x)),d=Math.floor(Math.min(e[0].y,e[1].y)),p=Math.round(Math.max(e[0].y,e[1].y));return r.x>=s&&r.x<=a&&r.y>=l&&r.y<=u&&r.x>=c&&r.x<=h&&r.y>=d&&r.y<=p?r:null}function oo(t,e,n){var i=Ki(t,e),o=Qi(t,e),r=n>0?zi[o]:Wi[o],s=Math.atan(i),a=Math.abs(n*Math.sin(s))*r[1],l=Math.abs(n*Math.cos(s))*r[0];return{x:t.x+l,y:t.y+a}}function ro(t,e,n){var i=Ki(t,e),o=Math.atan(-1/i),r=n/2*Math.sin(o),s=n/2*Math.cos(o);return[{x:e.x+s,y:e.y+r},{x:e.x-s,y:e.y-r}]}function so(t,e,n,i){n=null==n?null==e.thresholdX?e.w/2:e.thresholdX:n,i=null==i?null==e.thresholdY?e.h/2:e.thresholdY:i;var o=Math.floor(t.x/e.w),r=e.w*o,s=r+e.w,a=Math.abs(t.x-r)<=n?r:Math.abs(s-t.x)<=n?s:t.x,l=Math.floor(t.y/e.h),u=e.h*l,c=u+e.h;return{x:a,y:Math.abs(t.y-u)<=i?u:Math.abs(c-t.y)<=i?c:t.y}}function ao(t,e,n){if(it(e,n,t))return e;for(var i=e.parentNode;null!=i&&i!==t;){if(it(i,n,t))return i;i=i.parentNode}}function lo(t,e,n){var i=e.parentNode,o=t.getSize(i),r=t.getSize(e),s=n.x,a=s+r.w,l=n.y,u=l+r.h;return a>0&&s<o.w&&u>0&&l<o.h}var uo,co="start",ho="beforeStart",po="drag",fo="drop",vo="over",go="stop",yo="katavorio-draggable",mo=function(){return!0},_o=function(){return!1},Eo="katavorio-delegated-draggable",xo="katavorio-drag-no-select",bo="katavorio-ghost-proxy",ko="katavorio-clone-drag";t.PositioningStrategies=void 0,(uo=t.PositioningStrategies||(t.PositioningStrategies={})).absolutePosition="absolutePosition",uo.transform="transform",uo.xyAttributes="xyAttributes";var Co=new Map;Co.set(t.PositioningStrategies.absolutePosition,(function(t,e){t.style.left="".concat(e.x,"px"),t.style.top="".concat(e.y,"px")})),Co.set(t.PositioningStrategies.xyAttributes,(function(t,e){t.setAttribute("x","".concat(e.x)),t.setAttribute("y","".concat(e.y))}));var So=new Map;So.set(t.PositioningStrategies.absolutePosition,(function(t){return{x:t.offsetLeft,y:t.offsetTop}})),So.set(t.PositioningStrategies.xyAttributes,(function(t){return{x:parseFloat(t.getAttribute("x")),y:parseFloat(t.getAttribute("y"))}}));var Po=new Map;Po.set(t.PositioningStrategies.absolutePosition,(function(t,e){t.style.width="".concat(e.w,"px"),t.style.height="".concat(e.h,"px")})),Po.set(t.PositioningStrategies.xyAttributes,(function(t,e){t.setAttribute("width","".concat(e.w)),t.setAttribute("height","".concat(e.h))}));var To=new Map;To.set(t.PositioningStrategies.absolutePosition,(function(t){return{w:t.offsetWidth,h:t.offsetHeight}})),To.set(t.PositioningStrategies.xyAttributes,(function(t){return{w:parseFloat(t.getAttribute("width")),h:parseFloat(t.getAttribute("height"))}}));var Ao,Mo=[go,co,po,fo,vo,"out",ho],wo=function(){},Do=function(t,e){if(null!=t){t=_(t)||null!=t.tagName||null==t.length?[t]:t;for(var n=0;n<t.length;n++)e.apply(t[n],[t[n]])}},Oo=function(){function t(e,i){n(this,t),this.el=e,this.manager=i,r(this,"_class",void 0),r(this,"uuid",X()),r(this,"enabled",!0),r(this,"scopes",[]),r(this,"eventManager",void 0),this.eventManager=i.eventManager}return o(t,[{key:"setEnabled",value:function(t){this.enabled=t}},{key:"isEnabled",value:function(){return this.enabled}},{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"addScope",value:function(t){var e={};for(var n in Do(this.scopes,(function(t){e[t]=!0})),Do(t?t.split(/\s+/):[],(function(t){e[t]=!0})),this.scopes.length=0,e)this.scopes.push(n)}},{key:"removeScope",value:function(t){var e={};for(var n in Do(this.scopes,(function(t){e[t]=!0})),Do(t?t.split(/\s+/):[],(function(t){delete e[t]})),this.scopes.length=0,e)this.scopes.push(n)}},{key:"toggleScope",value:function(t){var e={};for(var n in Do(this.scopes,(function(t){e[t]=!0})),Do(t?t.split(/\s+/):[],(function(t){e[t]?delete e[t]:e[t]=!0})),this.scopes.length=0,e)this.scopes.push(n)}}]),t}();t.ContainmentType=void 0,(Ao=t.ContainmentType||(t.ContainmentType={})).notNegative="notNegative",Ao.parent="parent",Ao.parentEnclosed="parentEnclosed";var Io=function(t){s(i,t);var e=c(i);function i(t,o,s){var a;if(n(this,i),r(u(a=e.call(this,t,s)),"_class",void 0),r(u(a),"rightButtonCanDrag",void 0),r(u(a),"consumeStartEvent",void 0),r(u(a),"clone",void 0),r(u(a),"scroll",void 0),r(u(a),"trackScroll",void 0),r(u(a),"_downAt",void 0),r(u(a),"_posAtDown",void 0),r(u(a),"_pagePosAtDown",void 0),r(u(a),"_pageDelta",{x:0,y:0}),r(u(a),"_moving",void 0),r(u(a),"_lastPosition",void 0),r(u(a),"_lastScrollValues",{x:0,y:0}),r(u(a),"_initialScroll",{x:0,y:0}),r(u(a),"_size",void 0),r(u(a),"_currentParentPosition",void 0),r(u(a),"_ghostParentPosition",void 0),r(u(a),"_dragEl",void 0),r(u(a),"_multipleDrop",void 0),r(u(a),"_ghostProxyOffsets",void 0),r(u(a),"_ghostDx",void 0),r(u(a),"_ghostDy",void 0),r(u(a),"_isConstrained",!1),r(u(a),"_ghostProxyParent",void 0),r(u(a),"_useGhostProxy",void 0),r(u(a),"_ghostProxyFunction",void 0),r(u(a),"_activeSelectorParams",void 0),r(u(a),"_availableSelectors",[]),r(u(a),"_canDrag",void 0),r(u(a),"_consumeFilteredEvents",void 0),r(u(a),"_parent",void 0),r(u(a),"_ignoreZoom",void 0),r(u(a),"_filters",{}),r(u(a),"_constrainRect",void 0),r(u(a),"_elementToDrag",void 0),r(u(a),"downListener",void 0),r(u(a),"moveListener",void 0),r(u(a),"upListener",void 0),r(u(a),"scrollTracker",void 0),r(u(a),"listeners",{start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]}),a._class=a.manager.css.draggable,ht(a.el,a._class),a.downListener=a._downListener.bind(u(a)),a.upListener=a._upListener.bind(u(a)),a.moveListener=a._moveListener.bind(u(a)),a.rightButtonCanDrag=!0===o.rightButtonCanDrag,a.consumeStartEvent=!1!==o.consumeStartEvent,a._dragEl=a.el,a.clone=!0===o.clone,a.scroll=!0===o.scroll,a.trackScroll=!1!==o.trackScroll,a._multipleDrop=!1!==o.multipleDrop,a._canDrag=o.canDrag||mo,a._consumeFilteredEvents=o.consumeFilteredEvents,a._parent=o.parent,a._ignoreZoom=!0===o.ignoreZoom,a._ghostProxyParent=o.ghostProxyParent,a.trackScroll&&(a.scrollTracker=a._trackScroll.bind(u(a)),document.addEventListener("scroll",a.scrollTracker)),!0===o.ghostProxy?a._useGhostProxy=mo:o.ghostProxy&&"function"==typeof o.ghostProxy?a._useGhostProxy=o.ghostProxy:a._useGhostProxy=function(t,e){return!(!a._activeSelectorParams||!a._activeSelectorParams.useGhostProxy)&&a._activeSelectorParams.useGhostProxy(t,e)},o.makeGhostProxy?a._ghostProxyFunction=o.makeGhostProxy:a._ghostProxyFunction=function(t){return a._activeSelectorParams&&a._activeSelectorParams.makeGhostProxy?a._activeSelectorParams.makeGhostProxy(t):t.cloneNode(!0)},o.selector){var l=a.el.getAttribute(yo);null==l&&(l=""+(new Date).getTime(),a.el.setAttribute("katavorio-draggable",l)),a._availableSelectors.push(o)}return a.eventManager.on(a.el,pn,a.downListener),a}return o(i,[{key:"_trackScroll",value:function(t){if(this._moving){var e={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},n=e.x-this._lastScrollValues.x,i=e.y-this._lastScrollValues.y,o={x:n+this._lastPosition.x,y:i+this._lastPosition.y},r=o.x-this._downAt.x,s=o.y-this._downAt.y,a=this._ignoreZoom?1:this.manager.getZoom();this._dragEl&&this._dragEl.parentNode&&(r+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,s+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),r/=a,s/=a,this.moveBy(r,s,t),this._lastPosition=o,this._lastScrollValues=e}}},{key:"on",value:function(t,e){this.listeners[t]&&this.listeners[t].push(e)}},{key:"off",value:function(t,e){if(this.listeners[t]){for(var n=[],i=0;i<this.listeners[t].length;i++)this.listeners[t][i]!==e&&n.push(this.listeners[t][i]);this.listeners[t]=n}}},{key:"_upListener",value:function(t){this._downAt&&(this._downAt=null,this.eventManager.off(document,gn,this.moveListener),this.eventManager.off(document,yn,this.upListener),pt(document.body,xo),this.unmark(t),this.stop(t),this._moving=!1,this.clone?(this._dragEl&&this._dragEl.parentNode&&this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=null):this._activeSelectorParams&&this._activeSelectorParams.revertFunction&&!0===this._activeSelectorParams.revertFunction(this._dragEl,this.manager.getPosition(this._dragEl))&&(this.manager.setPosition(this._dragEl,this._posAtDown),this._dispatch(Tn,this._dragEl)))}},{key:"_downListener",value:function(t){if(!t.defaultPrevented&&((this.rightButtonCanDrag||3!==t.which&&2!==t.button)&&this.isEnabled()&&this._canDrag())){var e=this._testFilter(t)&&function(t,e,n){return!it(t.srcElement||t.target,n.getInputFilterSelector(),e)}(t,this.el,this.manager);if(e){this._activeSelectorParams=null,this._elementToDrag=null,0===this._availableSelectors.length&&console.log("JSPLUMB: no available drag selectors");var n=t.target||t.srcElement,i=function(t,e,n){for(var i=null,o=e.getAttribute("katavorio-draggable"),r=null!=o?"[katavorio-draggable='"+o+"'] ":"",s=0;s<t.length;s++)if(null!=(i=ao(e,n,r+t[s].selector))){if(t[s].filter){var a=it(n,t[s].filter,i);if(!0===t[s].filterExclude&&!a||a)return null}return[t[s],i]}return null}(this._availableSelectors,this.el,n);if(null!=i&&(this._activeSelectorParams=i[0],this._elementToDrag=i[1]),null==this._activeSelectorParams||null==this._elementToDrag)return;var o=this._activeSelectorParams.dragInit?this._activeSelectorParams.dragInit(this._elementToDrag,t):null;if(null!=o&&(this._elementToDrag=o),this.clone)if(this._dragEl=this._elementToDrag.cloneNode(!0),ht(this._dragEl,ko),this._dragEl.setAttribute("id",null),this._dragEl.style.position="absolute",null!=this._parent){var r=this.manager.getPosition(this.el);this._dragEl.style.left=r.x+"px",this._dragEl.style.top=r.y+"px",this._parent.appendChild(this._dragEl)}else{var s=yt(this._elementToDrag);this._dragEl.style.left=s.x+"px",this._dragEl.style.top=s.y+"px",document.body.appendChild(this._dragEl)}else this._dragEl=this._elementToDrag;this.consumeStartEvent&&ot(t),this._downAt=wi(t),this._dragEl&&this._dragEl.parentNode&&(this._initialScroll={x:this._dragEl.parentNode.scrollLeft,y:this._dragEl.parentNode.scrollTop}),this._posAtDown=this.manager.getPosition(this._dragEl),this._pagePosAtDown=yt(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=this.manager.getSize(this._dragEl),this.eventManager.on(document,gn,this.moveListener),this.eventManager.on(document,yn,this.upListener),ht(document.body,xo),this._dispatch(ho,{el:this.el,pos:this._posAtDown,e:t,drag:this,size:this._size})}else this._consumeFilteredEvents&&ot(t)}}},{key:"_moveListener",value:function(t){if(this._downAt){if(!this._moving){var e=this._dispatch(co,{el:this.el,pos:this._posAtDown,e:t,drag:this,size:this._size});if(!1!==e){if(!this._downAt)return;this.mark(e),this._moving=!0}else this.abort()}if(this._downAt){var n=wi(t),i=n.x-this._downAt.x,o=n.y-this._downAt.y,r=this._ignoreZoom?1:this.manager.getZoom();this._lastPosition={x:n.x,y:n.y},this._lastScrollValues={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},this._dragEl&&this._dragEl.parentNode&&(i+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,o+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),i/=r,o/=r,this.moveBy(i,o,t)}}}},{key:"getDragDelta",value:function(){return null!=this._posAtDown&&null!=this._downAt?{x:this._downAt.x-this._posAtDown.x,y:this._downAt.y-this._posAtDown.y}:{x:0,y:0}}},{key:"mark",value:function(t){var e;this._posAtDown=this.manager.getPosition(this._dragEl),this._pagePosAtDown=yt(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=this.manager.getSize(this._dragEl),ht(this._dragEl,this.manager.css.drag),this._constrainRect={w:(e=this._dragEl).parentNode.offsetWidth+e.parentNode.scrollLeft,h:e.parentNode.offsetHeight+e.parentNode.scrollTop},this._ghostDx=0,this._ghostDy=0}},{key:"unmark",value:function(t){this._isConstrained&&this._useGhostProxy(this._elementToDrag,this._dragEl)?(this._ghostProxyOffsets={x:this._dragEl.offsetLeft-this._ghostDx,y:this._dragEl.offsetTop-this._ghostDy},this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag):this._ghostProxyOffsets=null,pt(this._dragEl,this.manager.css.drag),this._isConstrained=!1}},{key:"moveBy",value:function(t,e,n){var i=this.toGrid({x:this._posAtDown.x+t,y:this._posAtDown.y+e}),o=this._doConstrain(i,this._dragEl,this._constrainRect,this._size,n);if(null!=o){if(this._useGhostProxy(this.el,this._dragEl))if(i.x!==o.x||i.y!==o.y){if(!this._isConstrained){var r=this._ghostProxyFunction(this._elementToDrag);ht(r,bo),this._ghostProxyParent?(this._ghostProxyParent.appendChild(r),this._currentParentPosition=yt(this._elementToDrag.parentNode),this._ghostParentPosition=yt(this._ghostProxyParent),this._ghostDx=this._currentParentPosition.x-this._ghostParentPosition.x,this._ghostDy=this._currentParentPosition.y-this._ghostParentPosition.y):this._elementToDrag.parentNode.appendChild(r),this._dragEl=r,this._isConstrained=!0}o=i}else this._isConstrained&&(this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag,this._isConstrained=!1,this._currentParentPosition=null,this._ghostParentPosition=null,this._ghostDx=0,this._ghostDy=0);this.manager.setPosition(this._dragEl,{x:o.x+this._ghostDx,y:o.y+this._ghostDy}),this._dispatch(po,{el:this.el,pos:o,e:n,drag:this,size:this._size,originalPos:this._posAtDown})}}},{key:"abort",value:function(){null!=this._downAt&&this._upListener()}},{key:"getDragElement",value:function(t){return t?this._elementToDrag||this.el:this._dragEl||this.el}},{key:"stop",value:function(t,e){if(e||this._moving){var n=[],i=this.manager.getPosition(this._dragEl);n.push([this._dragEl,i,this,this._size]),this._dispatch(go,{el:this._dragEl,pos:this._ghostProxyOffsets||i,finalPos:i,e:t,drag:this,selection:n,size:this._size,originalPos:{x:this._posAtDown.x,y:this._posAtDown.y}})}else this._moving||this._activeSelectorParams.dragAbort&&this._activeSelectorParams.dragAbort(this._elementToDrag)}},{key:"_dispatch",value:function(t,e){var n=null;if(this._activeSelectorParams&&this._activeSelectorParams[t])n=this._activeSelectorParams[t](e);else if(this.listeners[t])for(var i=0;i<this.listeners[t].length;i++)try{var o=this.listeners[t][i](e);null!=o&&(n=o)}catch(t){}return n}},{key:"resolveGrid",value:function(){var t={grid:null,thresholdX:5,thresholdY:5};return null!=this._activeSelectorParams&&null!=this._activeSelectorParams.grid&&(t.grid=this._activeSelectorParams.grid,null!=this._activeSelectorParams.snapThreshold&&(t.thresholdX=this._activeSelectorParams.snapThreshold,t.thresholdY=this._activeSelectorParams.snapThreshold)),t}},{key:"toGrid",value:function(t){var e=this.resolveGrid(),n=e.grid,i=e.thresholdX,o=e.thresholdY;return null==n?t:so(t,n,n?n.w/2:i,n?n.h/2:o)}},{key:"setUseGhostProxy",value:function(t){this._useGhostProxy=t?mo:_o}},{key:"_doConstrain",value:function(t,e,n,i,o){return null!=this._activeSelectorParams&&this._activeSelectorParams.constrainFunction&&"function"==typeof this._activeSelectorParams.constrainFunction?this._activeSelectorParams.constrainFunction(t,e,n,i,o):t}},{key:"_testFilter",value:function(t){for(var e in this._filters){var n=this._filters[e],i=n[0](t);if(n[1]&&(i=!i),!i)return!1}return!0}},{key:"addFilter",value:function(t,e){var n,i=this;if(t){var o="function"==typeof(n=t)?(n._katavorioId=X(),n._katavorioId):n;this._filters[o]=[function(e){var n,o=e.srcElement||e.target;return _(t)?n=it(o,t,i.el):"function"==typeof t&&(n=t(e,i.el)),n},!1!==e]}}},{key:"removeFilter",value:function(t){var e="function"==typeof t?t._katavorioId:t;delete this._filters[e]}},{key:"clearAllFilters",value:function(){this._filters={}}},{key:"addSelector",value:function(t,e){t.selector&&(e?this._availableSelectors.unshift(t):this._availableSelectors.push(t))}},{key:"destroy",value:function(){this.eventManager.off(this.el,pn,this.downListener),this.eventManager.off(document,gn,this.moveListener),this.eventManager.off(document,yn,this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null,null!=this.scrollTracker&&document.removeEventListener("scroll",this.scrollTracker)}}]),i}(Oo),jo=["input","textarea","select","button","option"].join(","),Lo=function(){function e(i){n(this,e),r(this,"eventManager",void 0),r(this,"zoom",1),r(this,"css",{}),r(this,"inputFilterSelector",void 0),r(this,"positioningStrategy",void 0),r(this,"_positionSetter",void 0),r(this,"_positionGetter",void 0),r(this,"_sizeSetter",void 0),r(this,"_sizeGetter",void 0),i=i||{},this.inputFilterSelector=i.inputFilterSelector||jo,this.eventManager=new Xi,this.zoom=i.zoom||1,this.positioningStrategy=i.positioningStrategy||t.PositioningStrategies.absolutePosition,this._positionGetter=So.get(this.positioningStrategy),this._positionSetter=Co.get(this.positioningStrategy),this._sizeGetter=To.get(this.positioningStrategy),this._sizeSetter=Po.get(this.positioningStrategy);var o=i.css||{};y(this.css,o)}return o(e,[{key:"getPosition",value:function(t){return this._positionGetter(t)}},{key:"setPosition",value:function(t,e){this._positionSetter(t,e)}},{key:"getSize",value:function(t){return this._sizeGetter(t)}},{key:"getZoom",value:function(){return this.zoom}},{key:"setZoom",value:function(t){this.zoom=t}},{key:"_prepareParams",value:function(t){t=t||{};var e,n={events:{}};for(e in t)n[e]=t[e];for(e=0;e<Mo.length;e++)n.events[Mo[e]]=t[Mo[e]]||wo;return n}},{key:"getInputFilterSelector",value:function(){return this.inputFilterSelector}},{key:"setInputFilterSelector",value:function(t){return this.inputFilterSelector=t,this}},{key:"draggable",value:function(t,e){if(null==t._katavorioDrag){var n=this._prepareParams(e),i=new Io(t,n,this);return ht(t,Eo),t._katavorioDrag=i,i}return t._katavorioDrag}},{key:"destroyDraggable",value:function(t){t._katavorioDrag&&(t._katavorioDrag.destroy(),delete t._katavorioDrag)}}]),e}(),No="jtk-drag-selected",Go=function(){function t(e){n(this,t),this.instance=e,r(this,"_dragSelection",[]),r(this,"_dragSizes",new Map),r(this,"_dragElements",new Map),r(this,"_dragElementStartPositions",new Map),r(this,"_dragElementPositions",new Map),r(this,"__activeSet",void 0)}return o(t,[{key:"_activeSet",get:function(){return null==this.__activeSet?this._dragSelection:this.__activeSet}},{key:"length",get:function(){return this._dragSelection.length}},{key:"filterActiveSet",value:function(t){var e=this;this.__activeSet=[],D(this._dragSelection,(function(n){t(n)&&e.__activeSet.push(n)}))}},{key:"clear",value:function(){var t=this;this.reset(),D(this._dragSelection,(function(e){return t.instance.removeClass(e.jel,No)})),this._dragSelection.length=0}},{key:"reset",value:function(){this._dragElementStartPositions.clear(),this._dragElementPositions.clear(),this._dragSizes.clear(),this._dragElements.clear(),this.__activeSet=null}},{key:"initialisePositions",value:function(){var t=this;D(this._activeSet,(function(e){var n=t.instance.viewport.getPosition(e.id),i={x:parseInt(""+e.jel.offsetLeft,10),y:parseInt(""+e.jel.offsetTop,10)};t._dragElementStartPositions.set(e.id,i),t._dragElementPositions.set(e.id,i),t._dragSizes.set(e.id,{w:n.w,h:n.h})}))}},{key:"updatePositions",value:function(t,e,n){var i=this,o=t.x-e.x,r=t.y-e.y;D(this._activeSet,(function(t){var e=i._dragElementStartPositions.get(t.id);if(e){var s=e.x+o,a=e.y+r,l=i._dragSizes.get(t.id),u={x:s,y:a,w:l.w,h:l.h};if(t.jel._jsPlumbParentGroup&&t.jel._jsPlumbParentGroup.constrain){var c={w:t.jel.parentNode.offsetWidth+t.jel.parentNode.scrollLeft,h:t.jel.parentNode.offsetHeight+t.jel.parentNode.scrollTop};u.x=Math.max(u.x,0),u.y=Math.max(u.y,0),u.x=Math.min(u.x,c.w-l.w),u.y=Math.min(u.y,c.h-l.h)}i._dragElementPositions.set(t.id,{x:s,y:a}),t.jel.style.left=u.x+"px",t.jel.style.top=u.y+"px",n(t.jel,t.id,l,u)}}))}},{key:"each",value:function(t){var e=this;D(this._activeSet,(function(n){var i=e._dragSizes.get(n.id),o=e._dragElementPositions.get(n.id),r=e._dragElementStartPositions.get(n.id);t(n.jel,n.id,o,i,r)}))}},{key:"add",value:function(t,e){var n=t;e=e||this.instance.getId(n),-1===O(this._dragSelection,(function(t){return t.id===e}))&&(this.instance.addClass(t,No),this._dragSelection.push({id:e,jel:n}))}},{key:"remove",value:function(t){var e=this,n=t;this._dragSelection=this._dragSelection.filter((function(t){var i=t.jel!==n;return i||e.instance.removeClass(t.jel,No),i}))}},{key:"toggle",value:function(t){var e=t;-1!==O(this._dragSelection,(function(t){return t.jel===e}))?this.remove(e):this.add(t)}}]),t}(),Ro="jtk-delegated-draggable",Fo="jtk-draggable",Vo="jtk-drag",Ho="jtk-ghost-proxy",Uo="jtk-drag-active",Bo="jtk-dragged",Yo="jtk-drag-hover",Xo=function(){function e(t,i,o){var s=this;n(this,e),this.instance=t,this.dragSelection=i,r(this,"collicat",void 0),r(this,"drag",void 0),r(this,"_draggables",{}),r(this,"_dlist",[]),r(this,"_elementsWithEndpoints",{}),r(this,"_draggablesForElements",{}),r(this,"handlers",[]),r(this,"_trackScroll",void 0),r(this,"_filtersToAdd",[]),this.collicat=new Lo({zoom:this.instance.currentZoom,css:{noSelect:this.instance.dragSelectClass,delegatedDraggable:Ro,draggable:Fo,drag:Vo,selected:No,active:Uo,hover:Yo,ghostProxy:Ho}}),this.instance.bind(be,(function(t){s.collicat.setZoom(t)})),o=o||{},this._trackScroll=!1!==o.trackScroll}return o(e,[{key:"addHandler",value:function(e,n){var i=this,o=y({selector:e.selector},n||{});o.start=$(o.start,(function(t){return e.onStart(t)}),!1),o.drag=$(o.drag,(function(t){return e.onDrag(t)})),o.stop=$(o.stop,(function(t){return e.onStop(t)}));var r=(e.onBeforeStart||function(t){}).bind(e);if(o.beforeStart=$(o.beforeStart,(function(t){return r(t)})),o.dragInit=function(t,n){return e.onDragInit(t,n)},o.dragAbort=function(t){return e.onDragAbort(t)},e.useGhostProxy&&(o.useGhostProxy=e.useGhostProxy,o.makeGhostProxy=e.makeGhostProxy),null==o.constrainFunction&&null!=o.containment)switch(o.containment){case t.ContainmentType.notNegative:o.constrainFunction=function(t,e,n,i){return{x:Math.max(0,Math.min(t.x)),y:Math.max(0,Math.min(t.y))}};break;case t.ContainmentType.parent:var s=o.containmentPadding||5;o.constrainFunction=function(t,e,n,i){return{x:t.x<0?0:t.x>n.w-s?n.w-s:t.x,y:t.y<0?0:t.y>n.h-s?n.h-s:t.y}};break;case t.ContainmentType.parentEnclosed:o.constrainFunction=function(t,e,n,i){return{x:t.x<0?0:t.x+i.w>n.w?n.w-i.w:t.x,y:t.y<0?0:t.y+i.h>n.h?n.h-i.h:t.y}}}null==this.drag?(o.trackScroll=this._trackScroll,this.drag=this.collicat.draggable(this.instance.getContainer(),o),D(this._filtersToAdd,(function(t){return i.drag.addFilter(t[0],t[1])})),this.drag.on(Tn,(function(t){i.instance.revalidate(t)}))):this.drag.addSelector(o),this.handlers.push({handler:e,options:o}),e.init(this.drag)}},{key:"addSelector",value:function(t,e){this.drag&&this.drag.addSelector(t,e)}},{key:"addFilter",value:function(t,e){null==this.drag?this._filtersToAdd.push([t,!0===e]):this.drag.addFilter(t,e)}},{key:"removeFilter",value:function(t){null!=this.drag&&this.drag.removeFilter(t)}},{key:"setFilters",value:function(t){var e=this;D(t,(function(t){e.drag.addFilter(t[0],t[1])}))}},{key:"reset",value:function(){var t=[];if(D(this.handlers,(function(t){t.handler.reset()})),this.handlers.length=0,null!=this.drag){var e=this.drag._filters;for(var n in e)t.push([n,e[n][1]]);this.collicat.destroyDraggable(this.instance.getContainer())}return delete this.drag,t}},{key:"setOption",value:function(t,e){var n=j(this.handlers,(function(e){return e.handler===t}));null!=n&&y(n.options,e||{})}}]),e}();var zo,Wo,qo,Ko,Zo=function(){function t(e,i){n(this,t),this.instance=e,this._dragSelection=i,r(this,"selector","> "+Ae+":not("+St(ee)+")"),r(this,"_dragOffset",null),r(this,"_groupLocations",[]),r(this,"_intersectingGroups",[]),r(this,"_currentDragParentGroup",null),r(this,"_dragGroupByElementIdMap",{}),r(this,"_dragGroupMap",{}),r(this,"_currentDragGroup",null),r(this,"_currentDragGroupOffsets",new Map),r(this,"_currentDragGroupSizes",new Map),r(this,"_currentDragGroupOriginalPositions",new Map),r(this,"_dragPayload",null),r(this,"drag",void 0),r(this,"originalPosition",void 0)}return o(t,[{key:"onDragInit",value:function(t){return null}},{key:"onDragAbort",value:function(t){return null}},{key:"getDropGroup",value:function(){var t=null;if(this._intersectingGroups.length>0){var e=this._intersectingGroups[0].groupLoc.group,n=this._intersectingGroups[0].intersectingElement,i=n._jsPlumbParentGroup;i!==e&&(null!=i&&i.overrideDrop(n,e)||(t=this._intersectingGroups[0]))}return t}},{key:"onStop",value:function(t){var e,n=this,i=t.drag.getDragElement(),o=this.getDropGroup(),r=[];function s(t,e,n,i,s){var a=n.x,l=n.y;if(t._jsPlumbParentGroup&&t._jsPlumbParentGroup.constrain){var u={w:t.parentNode.offsetWidth+t.parentNode.scrollLeft,h:t.parentNode.offsetHeight+t.parentNode.scrollTop};a=Math.max(a,0),l=Math.max(l,0),a=Math.min(a,u.w-i.w),l=Math.min(l,u.h-i.h),n.x=a,n.y=l}r.push({el:t,id:e,pos:n,originalPos:s,originalGroup:t._jsPlumbParentGroup,redrawResult:null,reverted:!1,dropGroup:null==o?void 0:o.groupLoc.group})}if(r.push({el:i,id:this.instance.getId(i),pos:t.finalPos,originalGroup:i._jsPlumbParentGroup,redrawResult:null,originalPos:t.originalPos,reverted:!1,dropGroup:null!=o?o.groupLoc.group:null}),this._dragSelection.each((function(e,n,i,o,r){e!==t.el&&s(e,n,{x:i.x,y:i.y},o,r)})),null===(e=this._currentDragGroup)||void 0===e||e.members.forEach((function(e){if(e.el!==t.el){var i=n._currentDragGroupOffsets.get(e.elId),o=n._currentDragGroupSizes.get(e.elId),r={x:t.finalPos.x+i[0].x,y:t.finalPos.y+i[0].y};s(e.el,e.elId,r,o,n._currentDragGroupOriginalPositions.get(e.elId))}})),D(r,(function(t){var e=null!=t.originalGroup,i=e&&lo(n.instance,t.el,t.pos),r={x:0,y:0};if(e&&!i){if(null==o){var s=n._pruneOrOrphan(t,!0,!0);null!=s.pos?t.pos=s.pos.pos:!s.pruned&&t.originalGroup.revert&&(t.pos=t.originalPos,t.reverted=!0)}}else e&&i&&(r=n._computeOffsetByParentGroup(t.originalGroup));null==o||i?t.dropGroup=null:n.instance.groupManager.addToGroup(o.groupLoc.group,!1,t.el),t.reverted&&n.instance.setPosition(t.el,t.pos),t.redrawResult=n.instance.setElementPosition(t.el,t.pos.x+r.x,t.pos.y+r.y),n.instance.removeClass(t.el,Bo),n.instance.select({source:t.el}).removeClass(n.instance.elementDraggingClass+" "+n.instance.sourceElementDraggingClass,!0),n.instance.select({target:t.el}).removeClass(n.instance.elementDraggingClass+" "+n.instance.targetElementDraggingClass,!0)})),null!=r[0].originalGroup){var a=i._jsPlumbParentGroup;if(a!==r[0].originalGroup){var l=t.drag.getDragElement(!0);if(r[0].originalGroup.ghost){var u=this.instance.getPosition(this.instance.getGroupContentArea(a)),c=this.instance.getPosition(this.instance.getGroupContentArea(r[0].originalGroup)),h={x:c.x+t.pos.x-u.x,y:c.y+t.pos.y-u.y};l.style.left=h.x+"px",l.style.top=h.y+"px",this.instance.revalidate(l)}}}this.instance.fire(Sn,{elements:r,e:t.e,el:i,payload:this._dragPayload}),this._cleanup()}},{key:"_cleanup",value:function(){var t=this;D(this._groupLocations,(function(e){t.instance.removeClass(e.el,Uo),t.instance.removeClass(e.el,Yo)})),this._currentDragParentGroup=null,this._groupLocations.length=0,this.instance.hoverSuspended=!1,this._dragOffset=null,this._dragSelection.reset(),this._dragPayload=null,this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroupOriginalPositions.clear(),this._currentDragGroup=null}},{key:"reset",value:function(){}},{key:"init",value:function(t){this.drag=t}},{key:"onDrag",value:function(t){var e=this,n=t.drag.getDragElement(),i=this.instance.getId(n),o=t.pos,r=this.instance.viewport.getPosition(i),s={x:o.x,y:o.y};this._intersectingGroups.length=0,null!=this._dragOffset&&(s.x+=this._dragOffset.x,s.y+=this._dragOffset.y);var a=function(n,i,o){if(o){var r=new Set;D(e._groupLocations,(function(n){!r.has(n.group.id)&&to(i,n.r)?(n.group!==e._currentDragParentGroup&&e.instance.addClass(n.el,Yo),e._intersectingGroups.push({groupLoc:n,intersectingElement:t.drag.getDragElement(!0),d:0}),D(e.instance.groupManager.getAncestors(n.group),(function(t){return r.add(t.id)}))):e.instance.removeClass(n.el,Yo)}))}e.instance.setElementPosition(n,i.x,i.y),e.instance.fire(Cn,{el:n,e:t.e,pos:{x:i.x,y:i.y},originalPosition:e.originalPosition,payload:e._dragPayload})},l={x:s.x,y:s.y,w:r.w,h:r.h};a(n,l,!0),this._dragSelection.updatePositions(o,this.originalPosition,(function(t,e,n,i){a(t,i,!1)})),this._currentDragGroupOffsets.forEach((function(t,n){var i=e._currentDragGroupSizes.get(n),o={x:l.x+t[0].x,y:l.y+t[0].y,w:i.w,h:i.h};t[1].style.left=o.x+"px",t[1].style.top=o.y+"px",a(t[1],o,!1)}))}},{key:"_computeOffsetByParentGroup",value:function(t){var e=this.instance.getPosition(t.el),n=t.contentArea;if(n!==t.el){var i=this.instance.getPosition(n);e.x+=i.x,e.y+=i.y}if(t.el._jsPlumbParentGroup){var o=this._computeOffsetByParentGroup(t.el._jsPlumbParentGroup);e.x+=o.x,e.y+=o.y}return e}},{key:"onStart",value:function(t){var e=this,n=t.drag.getDragElement(),i=this.instance.getPosition(n);this.originalPosition={x:t.pos.x,y:t.pos.y},n._jsPlumbParentGroup&&(this._dragOffset=this._computeOffsetByParentGroup(n._jsPlumbParentGroup),this._currentDragParentGroup=n._jsPlumbParentGroup);var o=!0,r=n.getAttribute(Gt);if((!1===this.instance.elementsDraggable||null!=r&&r!==gi)&&(o=!1),o){this._groupLocations.length=0,this._intersectingGroups.length=0,this.instance.hoverSuspended=!0;var s=t.drag.getDragElement(!0),a=s.querySelectorAll(Ae),l=function(t){for(var e=[],n=t._jsPlumbParentGroup;null!=n;)e.push(n.el),n=n.group;return e}(s),u=[];Array.prototype.push.apply(u,a),Array.prototype.push.apply(u,l),this._dragSelection.filterActiveSet((function(t){return-1===u.indexOf(t.jel)})),this._dragSelection.initialisePositions();var c=function(n,i,o){if(!n._isJsPlumbGroup||e.instance.allowNestedGroups){var r=!n._jsPlumbParentGroup,s=r||!0!==n._jsPlumbParentGroup.dropOverride,a=!r&&(n._jsPlumbParentGroup.ghost||!0!==n._jsPlumbParentGroup.constrain);(r||s&&a)&&(D(e.instance.groupManager.getGroups(),(function(t){var i=n._jsPlumbGroup;if(!1!==t.droppable&&!1!==t.enabled&&n._jsPlumbGroup!==t&&!e.instance.groupManager.isDescendant(t,i)){var o=t.el,r=e.instance.getId(o),s=e.instance.viewport.getPosition(r),a={el:o,r:{x:s.x,y:s.y,w:s.w,h:s.h},group:t};e._groupLocations.push(a),t!==e._currentDragParentGroup&&e.instance.addClass(o,Uo)}})),e._groupLocations.sort((function(t,n){return e.instance.groupManager.isDescendant(t.group,n.group)?-1:e.instance.groupManager.isAncestor(n.group,t.group)?1:0})))}return e.instance.select({source:n}).addClass(e.instance.elementDraggingClass+" "+e.instance.sourceElementDraggingClass,!0),e.instance.select({target:n}).addClass(e.instance.elementDraggingClass+" "+e.instance.targetElementDraggingClass,!0),e.instance.fire(Pn,{el:n,e:t.e,originalPosition:e.originalPosition,pos:e.originalPosition,dragGroup:i,dragGroupMemberSpec:o})},h=this.instance.getId(n);this._currentDragGroup=this._dragGroupByElementIdMap[h],this._currentDragGroup&&!function(t,e){var n=N(t.members,(function(t){return t.el===e}));return null!==n&&!0===n.active}(this._currentDragGroup,n)&&(this._currentDragGroup=null);var d=c(n);if(!1===d)return this._cleanup(),!1;this._dragPayload=d,null!=this._currentDragGroup&&(this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup.members.forEach((function(t){var n=e.instance.viewport.getPosition(t.elId);e._currentDragGroupOffsets.set(t.elId,[{x:n.x-i.x,y:n.y-i.y},t.el]),e._currentDragGroupSizes.set(t.elId,n),e._currentDragGroupOriginalPositions.set(t.elId,{x:n.x,y:n.y}),c(t.el,e._currentDragGroup,t)})))}return o}},{key:"addToDragGroup",value:function(t){var e=this,n=function(t,e){return _(e)?{id:e,active:!0}:{id:e.id,active:e.active}}(this.instance,t),i=this._dragGroupMap[n.id];null==i&&(i={id:n.id,members:new Set},this._dragGroupMap[n.id]=i);for(var o=arguments.length,r=new Array(o>1?o-1:0),s=1;s<o;s++)r[s-1]=arguments[s];this.removeFromDragGroup.apply(this,r),D(r,(function(t){var o=e.instance.getId(t);i.members.add({elId:o,el:t,active:n.active}),e._dragGroupByElementIdMap[o]=i}))}},{key:"removeFromDragGroup",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];D(n,(function(e){var n=t.instance.getId(e),i=t._dragGroupByElementIdMap[n];if(null!=i){var o=new Set;i.members.forEach((function(t){t.el!==e&&o.add(t)})),i.members=o,delete t._dragGroupByElementIdMap[n]}}))}},{key:"setDragGroupState",value:function(t){for(var e=this,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];D(i.map((function(t){return e.instance.getId(t)})),(function(n){var i=e._dragGroupByElementIdMap[n];if(null!=i){var o=N(i.members,(function(t){return t.elId===n}));null!=o&&(o.active=t)}}))}},{key:"clearDragGroup",value:function(t){var e=this,n=this._dragGroupMap[t];null!=n&&(n.members.forEach((function(t){delete e._dragGroupByElementIdMap[t.elId]})),n.members.clear())}},{key:"_pruneOrOrphan",value:function(t,e,n){var i=t.el,o={pruned:!1,pos:null};if(n||!lo(this.instance,i,t.pos)){var r=i._jsPlumbParentGroup;r.prune?(i._isJsPlumbGroup?this.instance.removeGroup(i._jsPlumbGroup):r.remove(t.el,!0),o.pruned=!0):r.orphan&&(o.pos=this.instance.groupManager.orphan(t.el,e),i._isJsPlumbGroup?r.removeGroup(i._jsPlumbGroup):r.remove(t.el))}return o}}]),t}(),Jo={},Qo={},$o={},tr={get:function(t,e,n){var i=Jo[e];if(i)return new i(t,n);throw{message:"jsPlumb: unknown endpoint type '"+e+"'"}},clone:function(t){var e=$o[t.type];return tr.get(t.endpoint,t.type,e.getParams(t))},compute:function(t,e,n,i){var o=Qo[t.type];if(null!=o)return o(t,e,n,i);J("jsPlumb: cannot find endpoint calculator for endpoint of type ",t.type)},registerHandler:function(t){$o[t.type]=t,Jo[t.type]=t.cls,Qo[t.type]=t.compute}},er=function(){function t(e,i){n(this,t),this.endpoint=e,r(this,"typeId",void 0),r(this,"x",void 0),r(this,"y",void 0),r(this,"w",void 0),r(this,"h",void 0),r(this,"computedValue",void 0),r(this,"bounds",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),r(this,"classes",[]),r(this,"instance",void 0),r(this,"type",void 0),i=i||{},this.instance=e.instance,e.cssClass&&this.classes.push(e.cssClass),i.cssClass&&this.classes.push(i.cssClass)}return o(t,[{key:"addClass",value:function(t){this.classes.push(t),this.instance.addEndpointClass(this.endpoint,t)}},{key:"removeClass",value:function(t){this.classes=this.classes.filter((function(e){return e!==t})),this.instance.removeEndpointClass(this.endpoint,t)}},{key:"compute",value:function(t,e,n){this.computedValue=tr.compute(this,t,e,n),this.bounds.xmin=this.x,this.bounds.ymin=this.y,this.bounds.xmax=this.x+this.w,this.bounds.ymax=this.y+this.h}},{key:"setVisible",value:function(t){this.instance.setEndpointVisible(this.endpoint,t)}}]),t}();!function(t){t.top="top",t.left="left",t.right="right",t.bottom="bottom"}(Ko||(Ko={}));var nr=Ko.top,ir=Ko.left,or=Ko.right,rr=Ko.bottom,sr=[ir,or],ar=[nr,rr],lr=function(){function t(e,i,o){n(this,t),this.instance=e,this.element=i,r(this,"isFloating",!0),r(this,"isContinuous",void 0),r(this,"isDynamic",void 0),r(this,"locations",[]),r(this,"currentLocation",0),r(this,"locked",!1),r(this,"cssClass",""),r(this,"timestamp",null),r(this,"type","Floating"),r(this,"id",X()),r(this,"orientation",[0,0]),r(this,"size",void 0),this.size=e.viewport.getPosition(o),this.locations.push({x:.5,y:.5,ox:this.orientation[0],oy:this.orientation[1],offx:0,offy:0,iox:this.orientation[0],ioy:this.orientation[1],cls:""})}return o(t,[{key:"_updateOrientationInRouter",value:function(){this.instance.router.setAnchorOrientation(this,[this.locations[0].ox,this.locations[0].oy])}},{key:"over",value:function(t){this.orientation=this.instance.router.getEndpointOrientation(t),this.locations[0].ox=this.orientation[0],this.locations[0].oy=this.orientation[1],this._updateOrientationInRouter()}},{key:"out",value:function(){this.orientation=null,this.locations[0].ox=this.locations[0].iox,this.locations[0].oy=this.locations[0].ioy,this._updateOrientationInRouter()}}]),t}(),ur=(r(zo={},nr,rr),r(zo,or,ir),r(zo,ir,or),r(zo,rr,nr),zo),cr=(r(Wo={},nr,or),r(Wo,or,rr),r(Wo,ir,nr),r(Wo,rr,ir),Wo),hr=(r(qo={},nr,ir),r(qo,or,nr),r(qo,ir,rr),r(qo,rr,or),qo);function dr(t){return 0===t.faces.length?nr:t.faces[0]}function pr(t,e){return-1!==t.faces.indexOf(e)}function fr(t,e){return null==t.lockedAxis?null==t.lockedFace?!0===pr(t,e):t.lockedFace===e:-1!==t.lockedAxis.indexOf(e)}function vr(t,e){if(pr(t,e))return e;if(pr(t,ur[e]))return ur[e];var n=function(t,e){return(t.clockwise?cr:hr)[e]}(t,e);if(pr(t,n))return n;var i=function(t,e){return(t.clockwise?hr:cr)[e]}(t,e);return pr(t,i)?i:e}var gr={x:.5,y:0,ox:0,oy:-1,offx:0,offy:0},yr={x:.5,y:1,ox:0,oy:1,offx:0,offy:0},mr={x:0,y:.5,ox:-1,oy:0,offx:0,offy:0},_r={x:1,y:.5,ox:1,oy:0,offx:0,offy:0},Er={Top:[gr],Bottom:[yr],Left:[mr],Right:[_r],TopLeft:[{x:0,y:0,ox:0,oy:-1,offx:0,offy:0}],TopRight:[{x:1,y:0,ox:1,oy:-1,offx:0,offy:0}],BottomLeft:[{x:0,y:1,ox:0,oy:1,offx:0,offy:0}],BottomRight:[{x:1,y:1,ox:0,oy:1,offx:0,offy:0}],Center:[{x:.5,y:.5,ox:0,oy:0,offx:0,offy:0}],AutoDefault:[gr,mr,yr,_r]},xr={Continuous:{faces:[nr,ir,rr,or]},ContinuousTop:{faces:[nr]},ContinuousRight:{faces:[or]},ContinuousBottom:{faces:[rr]},ContinuousLeft:{faces:[ir]},ContinuousLeftRight:{faces:[ir,or]},ContinuousTopBottom:{faces:[nr,rr]}};function br(e,n){if(n=n||{},e===t.AnchorLocations.Perimeter)return Or(n);var i=Er[e];if(null!=i)return kr(e,K(i,(function(t){return y({iox:t.ox,ioy:t.oy},t)})),n);if(null!=(i=xr[e]))return function(t,e,n){var i={type:t,locations:[],currentLocation:0,locked:!1,id:X(),cssClass:n.cssClass||"",isFloating:!1,isContinuous:!0,timestamp:null,faces:n.faces||e,lockedFace:null,lockedAxis:null,clockwise:!(!1===n.clockwise),__currentFace:null};return Object.defineProperty(i,Sr,{get:function(){return this.__currentFace},set:function(t){this.__currentFace=vr(this,t)}}),i}(e,i.faces,n);throw{message:"jsPlumb: unknown anchor type '"+e+"'"}}function kr(t,e,n){return{type:t,locations:e,currentLocation:0,locked:!1,id:X(),isFloating:!1,isContinuous:!1,isDynamic:e.length>1,timestamp:null,cssClass:n.cssClass||""}}function Cr(t,e,n){return new lr(t,e,n)}var Sr="currentFace";function Pr(t){return t.length<7&&t.every(m)||7===t.length&&t.slice(0,5).every(m)&&_(t[6])}function Tr(t){if(_(t))return br(t,null);if(Array.isArray(t)){if(Pr(t)){var e=t;return kr(null,[{x:e[0],y:e[1],ox:e[2],oy:e[3],offx:null==e[4]?0:e[4],offy:null==e[5]?0:e[5],iox:e[2],ioy:e[3],cls:e[6]||""}],{cssClass:e[6]||""})}return kr("Dynamic",K(t,(function(t){if(_(t)){var e=Er[t];return null!=e?y({iox:e[0].ox,ioy:e[0].oy,cls:""},e[0]):null}if(Pr(t))return{x:t[0],y:t[1],ox:t[2],oy:t[3],offx:null==t[4]?0:t[4],offy:null==t[5]?0:t[5],iox:t[2],ioy:t[3],cls:t[6]||""}})).filter((function(t){return null!=t})),{})}var n=t;return br(n.type,n.options)}function Ar(t){for(var e=.5,n=2*Math.PI/t,i=[],o=0,r=0;r<t;r++){var s=e+e*Math.sin(o),a=e+e*Math.cos(o);i.push({x:s,y:a,ox:0,oy:0,offx:0,offy:0,iox:0,ioy:0,cls:""}),o+=n}return i}function Mr(t,e){for(var n=[],i=0;i<t.length;i++)n.push([t[i][0],t[i][1],t[i][2],t[i][3],1/t.length,t[i][4],t[i][5]]);return function(t,e){for(var n=e/t.length,i=[],o=function(t,o,r,s,a,l,u){for(var c=(r-t)/(n=e*a),h=(s-o)/n,d=0;d<n;d++)i.push({x:t+c*d,y:o+h*d,ox:null==l?0:l,oy:null==u?0:u,offx:0,offy:0,iox:0,ioy:0,cls:""})},r=0;r<t.length;r++)o.apply(null,t[r]);return i}(n,e)}function wr(t){return Mr([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]],t)}var Dr=new Map;function Or(e){var n=(e=e||{}).anchorCount||60,i=e.shape;if(!i)throw new Error("no shape supplied to Perimeter Anchor type");if(!Dr.has(i))throw new Error("Shape ["+i+"] is unknown by Perimeter Anchor type");var o=Dr.get(i)(n);return e.rotation&&(o=function(t,e){for(var n=[],i=e/180*Math.PI,o=0;o<t.length;o++){var r=t[o].x-.5,s=t[o].y-.5;n.push({x:r*Math.cos(i)-s*Math.sin(i)+.5,y:r*Math.sin(i)+s*Math.cos(i)+.5,ox:t[o].ox,oy:t[o].oy,offx:0,offy:0,iox:0,ioy:0,cls:""})}return n}(o,e.rotation)),y(kr(t.AnchorLocations.Perimeter,o,e),{shape:i})}Dr.set(t.PerimeterAnchorShapes.Circle,Ar),Dr.set(t.PerimeterAnchorShapes.Ellipse,Ar),Dr.set(t.PerimeterAnchorShapes.Rectangle,wr),Dr.set(t.PerimeterAnchorShapes.Square,wr),Dr.set(t.PerimeterAnchorShapes.Diamond,(function(t){return Mr([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]],t)})),Dr.set(t.PerimeterAnchorShapes.Triangle,(function(t){return Mr([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]],t)}));var Ir=function(){function t(e,i){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n(this,t),this.selector=e,this.def=i,this.exclude=o,r(this,"id",void 0),r(this,"redrop",void 0),this.id=X(),this.redrop=i.def.redrop||jr}return o(t,[{key:"setEnabled",value:function(t){this.def.enabled=t}},{key:"isEnabled",value:function(){return!1!==this.def.enabled}}]),t}(),jr="strict",Lr="anySource",Nr="anyTarget",Gr="anySourceOrTarget";function Rr(t,e,n,i,o){for(var r=t.target||t.srcElement,s=!1,a=i.getSelector(e,n),l=0;l<a.length;l++)if(a[l]===r){s=!0;break}return o?!s:s}var Fr=St(Uo,Yo),Vr="sourceSelectorEndpoint",Hr=function(){function t(e){n(this,t),this.instance=e,r(this,"jpc",void 0),r(this,"existingJpc",void 0),r(this,"_originalAnchorSpec",void 0),r(this,"ep",void 0),r(this,"endpointRepresentation",void 0),r(this,"canvasElement",void 0),r(this,"_activeDefinition",void 0),r(this,"placeholderInfo",{id:null,element:null}),r(this,"floatingIndex",void 0),r(this,"floatingId",void 0),r(this,"floatingElement",void 0),r(this,"floatingEndpoint",void 0),r(this,"floatingAnchor",void 0),r(this,"_stopped",void 0),r(this,"inPlaceCopy",void 0),r(this,"endpointDropTargets",[]),r(this,"currentDropTarget",null),r(this,"payload",void 0),r(this,"floatingConnections",{}),r(this,"_forceReattach",void 0),r(this,"_forceDetach",void 0),r(this,"mousedownHandler",void 0),r(this,"mouseupHandler",void 0),r(this,"selector",St(zt));var i=e.getContainer();this.mousedownHandler=this._mousedownHandler.bind(this),this.mouseupHandler=this._mouseupHandler.bind(this),e.on(i,pn,Ae,this.mousedownHandler),e.on(i,yn,[Ae,St(zt)].join(","),this.mouseupHandler)}return o(t,[{key:"_resolveDragParent",value:function(t,e){var n=this.instance.getContainer(),i=rt(e,Ae,n,!0);if(null!=t.parentSelector){var o=rt(e,t.parentSelector,n,!0);return null!=o&&(i=rt(o.parentNode,Ae,n,!1)),o||i}return i}},{key:"_mousedownHandler",value:function(t){var e,n;if(3!==t.which&&2!==t.button){var i=t.target||t.srcElement;if((null==(n=this._getSourceDefinition(t))||null!=(e=this._resolveDragParent(n.def.def,i))&&e.getAttribute(en)!==gi)&&n){var o,r=t.currentTarget;if(i.getAttribute(en)!==gi){if(ot(t),this._activeDefinition=n,null!=(o=n.def.def).canAcceptNewConnection&&!o.canAcceptNewConnection(e,t))return!1;var s=ca(t,e,this.instance.currentZoom),a={element:e};if(y(a,o),a.isTemporarySource=!0,o.scope)a.scope=o.scope;else{var l=i.getAttribute(nn);null!=l&&(a.scope=l)}if(null!=(a=S(a,o.parameterExtractor?o.parameterExtractor(e,i,t):{})).maxConnections&&a.maxConnections>=0)if(this.instance.select({source:e}).length>=a.maxConnections)return ot(t),o.onMaxConnections&&o.onMaxConnections({element:e,maxConnections:a.maxConnections},t),t.stopImmediatePropagation&&t.stopImmediatePropagation(),!1;if(o.anchorPositionFinder){var u=o.anchorPositionFinder(e,s,o,t);null!=u&&(a.anchor=u)}this._originalAnchorSpec=a.anchor||(this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors[0]:this.instance.defaults.anchor);var c=this.instance.router.prepareAnchor(this._originalAnchorSpec),h=[s.x,s.y,0,0];if(c.locations.length>0)h[2]=c.locations[0].ox,h[3]=c.locations[0].oy;else if(c.isContinuous){var d=s.x<.5?s.x:1-s.x,p=s.y<.5?s.y:1-s.y;h[2]=d<p?s.x<.5?-1:1:0,h[3]=p<d?s.y<.5?-1:1:0}a.anchor=h,a.deleteOnEmpty=!0,this.ep=this.instance._internal_newEndpoint(a);var f={};if(o.extract){for(var v in o.extract){var g=i.getAttribute(v);g&&(f[o.extract[v]]=g)}this.ep.mergeParameters(f)}if(a.uniqueEndpoint){var m=this.ep.elementId,_=this.instance.getManagedData(m,Vr,n.id);null==_?(this.instance.setManagedData(m,Vr,n.id,this.ep),this.ep.deleteOnEmpty=!1):this.ep.finalEndpoint=_}r._jsPlumbOrphanedEndpoints=r._jsPlumbOrphanedEndpoints||[],r._jsPlumbOrphanedEndpoints.push(this.ep),this.instance.trigger(this.ep.endpoint.canvas,pn,t,f)}}}}},{key:"_mouseupHandler",value:function(t){var e=t.currentTarget||t.srcElement;e._jsPlumbOrphanedEndpoints&&(q(e._jsPlumbOrphanedEndpoints,this.instance._maybePruneEndpoint.bind(this.instance)),e._jsPlumbOrphanedEndpoints.length=0),this._activeDefinition=null}},{key:"onDragInit",value:function(t){var e=xt(t,this.instance),n=bt(t,this.instance);return this._makeDraggablePlaceholder(e,n),this.placeholderInfo.element.jtk=t.jtk,this.placeholderInfo.element}},{key:"onDragAbort",value:function(t){this._cleanupDraggablePlaceholder()}},{key:"_makeDraggablePlaceholder",value:function(t,e){this.placeholderInfo=this.placeholderInfo||{};var n=vt(an,{position:"absolute"});this.instance._appendElementToContainer(n);var i=this.instance.getId(n);return this.instance.setPosition(n,t),n.style.width=e.w+"px",n.style.height=e.h+"px",this.instance.manage(n),this.placeholderInfo.id=i,this.placeholderInfo.element=n,n}},{key:"_cleanupDraggablePlaceholder",value:function(){this.placeholderInfo.element&&(this.instance.unmanage(this.placeholderInfo.element,!0),delete this.placeholderInfo.element,delete this.placeholderInfo.id)}},{key:"reset",value:function(){var t=this.instance.getContainer();this.instance.off(t,yn,this.mouseupHandler),this.instance.off(t,pn,this.mousedownHandler)}},{key:"init",value:function(t){}},{key:"startNewConnectionDrag",value:function(t,e){this.jpc=this.instance._newConnection({sourceEndpoint:this.ep,targetEndpoint:this.floatingEndpoint,source:this.ep.element,target:this.placeholderInfo.element,paintStyle:this.ep.connectorStyle,hoverPaintStyle:this.ep.connectorHoverStyle,connector:this.ep.connector,overlays:this.ep.connectorOverlays,type:this.ep.edgeType,cssClass:this.ep.connectorClass,hoverClass:this.ep.connectorHoverClass,scope:t,data:e}),this.jpc.pending=!0,this.jpc.addClass(this.instance.draggingClass),this.ep.addClass(this.instance.draggingClass),this.instance.fire(Mn,this.jpc)}},{key:"startExistingConnectionDrag",value:function(){this.existingJpc=!0,this.instance.setHover(this.jpc,!1);var t=this.jpc.endpoints[0].id===this.ep.id?0:1;this.ep.detachFromConnection(this.jpc,null,!0),this.floatingEndpoint.addConnection(this.jpc),this.instance.fire(Mn,this.jpc),this.instance.sourceOrTargetChanged(this.jpc.endpoints[t].elementId,this.placeholderInfo.id,this.jpc,this.placeholderInfo.element,t),this.jpc.suspendedEndpoint=this.jpc.endpoints[t],this.jpc.suspendedElement=this.jpc.endpoints[t].element,this.jpc.suspendedElementId=this.jpc.endpoints[t].elementId,this.jpc.suspendedElementType=0===t?At:Mt,this.instance.setHover(this.jpc.suspendedEndpoint,!1),this.floatingEndpoint.referenceEndpoint=this.jpc.suspendedEndpoint,this.floatingEndpoint.mergeParameters(this.jpc.suspendedEndpoint.parameters),this.jpc.endpoints[t]=this.floatingEndpoint,this.jpc.addClass(this.instance.draggingClass),this.floatingId=this.placeholderInfo.id,this.floatingIndex=t,this.instance._refreshEndpoint(this.ep)}},{key:"_shouldStartDrag",value:function(){var t=!0;this.ep.enabled||(t=!1),null!=this.jpc||this.ep.isSource||this.ep.isTemporarySource||(t=!1),!this.ep.isSource||!this.ep.isFull()||null!=this.jpc&&this.ep.dragAllowedWhenFull||(t=!1),null==this.jpc||this.jpc.isDetachable(this.ep)||(this.ep.isFull()?t=!1:this.jpc=null);var n={},i=this.instance.checkCondition(null==this.jpc?Ce:Te,{endpoint:this.ep,source:this.ep.element,sourceId:this.ep.elementId,connection:this.jpc});return!1===i?t=!1:"object"===e(i)?y(n=i,this.payload||{}):n=this.payload||{},[t,n]}},{key:"_createFloatingEndpoint",value:function(t){var e=this.ep.endpoint;null!=this.ep.edgeType&&(e=this.instance._deriveEndpointAndAnchorSpec(this.ep.edgeType).endpoints[1]);this.floatingEndpoint=function(t,e,n,i,o,r){var s=Cr(r,i,o),a={paintStyle:t.getPaintStyle(),preparedAnchor:s,element:i,scope:t.scope,cssClass:[Kt,t.cssClass].join(" ")};null!=e&&(et(e,er)?a.existingEndpoint=e:a.endpoint=e);var l=r._internal_newEndpoint(a);return r._paintEndpoint(l,{}),l}(this.ep,e,0,this.placeholderInfo.element,this.placeholderInfo.id,this.instance),this.floatingAnchor=this.floatingEndpoint._anchor,this.floatingEndpoint.deleteOnEmpty=!0,this.floatingElement=this.floatingEndpoint.endpoint.canvas,this.floatingId=this.instance.getId(this.floatingElement)}},{key:"_populateTargets",value:function(t,e){var n,i=this,o=this.jpc&&this.jpc.endpoints[0]===this.ep;if(D(this.instance.getContainer().querySelectorAll([".",zt,"[",Vt,this.ep.scope,"]:not(.",Kt,")"].join("")),(function(e){if(!(null==i.jpc&&e===t||e===i.floatingElement||null==i.jpc&&e.jtk.endpoint.isFull())&&(o&&e.jtk.endpoint.isSource||!o&&e.jtk.endpoint.isTarget)){var r=xt(e,i.instance),s=bt(e,i.instance);n={x:r.x,y:r.y,w:s.w,h:s.h},i.endpointDropTargets.push({el:e,targetEl:e,r:n,endpoint:e.jtk.endpoint,def:null}),i.instance.addClass(e,Uo)}})),o){var r=j(this.instance.sourceSelectors,(function(t){return t.isEnabled()&&(null==t.def.def.scope||t.def.def.scope===i.ep.scope)}));if(null!=r)D(this._findTargetZones(r),(function(t){if(t.getAttribute(en)!==gi){var e=t.getAttribute(nn);if(null!=e&&e!==i.ep.scope)return;var n={r:null,el:t};n.targetEl=rt(t,Ae,i.instance.getContainer(),!0);var o=xt(n.el,i.instance),s=bt(n.el,i.instance);n.r={x:o.x,y:o.y,w:s.w,h:s.h},null!=r.def.def.rank&&(n.rank=r.def.def.rank),n.def=r.def,i.endpointDropTargets.push(n),i.instance.addClass(n.targetEl,Uo)}}))}else{L(this.instance.targetSelectors,(function(t){return t.isEnabled()})).forEach((function(t){D(i._findTargetZones(t),(function(n){if(n.getAttribute(en)!==gi){var o=n.getAttribute(nn);if(null!=o&&o!==i.ep.scope)return;var r={r:null,el:n};if(null!=t.def.def.parentSelector&&(r.targetEl=rt(n,t.def.def.parentSelector,i.instance.getContainer(),!0)),null==r.targetEl&&(r.targetEl=rt(n,Ae,i.instance.getContainer(),!0)),(!1===t.def.def.allowLoopback||i._activeDefinition&&!1===i._activeDefinition.def.def.allowLoopback)&&r.targetEl===i.ep.element)return;if(null!=t.def.def.canAcceptNewConnection&&!t.def.def.canAcceptNewConnection(r.targetEl,e))return;var s=t.def.def.maxConnections;if(null!=s&&-1!==s&&i.instance.select({target:r.targetEl}).length>=s)return;var a=xt(n,i.instance),l=bt(n,i.instance);r.r={x:a.x,y:a.y,w:l.w,h:l.h},r.def=t.def,null!=t.def.def.rank&&(r.rank=t.def.def.rank),i.endpointDropTargets.push(r),i.instance.addClass(r.targetEl,Uo)}}))}))}this.endpointDropTargets.sort((function(t,e){if(t.targetEl._isJsPlumbGroup&&!e.targetEl._isJsPlumbGroup)return 1;if(!t.targetEl._isJsPlumbGroup&&e.targetEl._isJsPlumbGroup)return-1;if(t.targetEl._isJsPlumbGroup&&e.targetEl._isJsPlumbGroup){if(i.instance.groupManager.isAncestor(t.targetEl._jsPlumbGroup,e.targetEl._jsPlumbGroup))return-1;if(i.instance.groupManager.isAncestor(e.targetEl._jsPlumbGroup,t.targetEl._jsPlumbGroup))return 1}else{if(null==t.rank||null==e.rank)return 0;if(t.rank>e.rank)return-1;if(t.rank<e.rank)return 1}}))}},{key:"_findTargetZones",value:function(t){var e;if("any"===t.redrop){var n=this.instance.targetSelectors.map((function(t){return t.selector}));n.push.apply(n,p(this.instance.sourceSelectors.map((function(t){return t.selector})))),n.push(Ae),e=n.join(",")}else if(t.redrop===jr)e=t.selector;else if(t.redrop===Lr)e=this.instance.sourceSelectors.map((function(t){return t.selector})).join(",");else if(t.redrop===Nr)e=this.instance.targetSelectors.map((function(t){return t.selector})).join(",");else if(t.redrop===Gr){var i=this.instance.targetSelectors.map((function(t){return t.selector}));i.push.apply(i,p(this.instance.sourceSelectors.map((function(t){return t.selector})))),e=i.join(",")}return this.instance.getContainer().querySelectorAll(e)}},{key:"onStart",value:function(t){this.endpointDropTargets.length=0,this.currentDropTarget=null,this._stopped=!1;var e=t.drag.getDragElement();if(this.ep=e.jtk.endpoint,!this.ep)return!1;this.endpointRepresentation=this.ep.endpoint,this.canvasElement=this.endpointRepresentation.canvas,this.jpc=this.ep.connectorSelector();var n=d(this._shouldStartDrag(),2),i=n[0],o=n[1];if(!1===i)return this._stopped=!0,!1;this.instance.setHover(this.ep,!1),this.instance.isConnectionBeingDragged=!0,this.jpc&&!this.ep.isFull()&&this.ep.isSource&&(this.jpc=null),this._createFloatingEndpoint(this.canvasElement),this._populateTargets(this.canvasElement,t.e),null==this.jpc?this.startNewConnectionDrag(this.ep.scope,o):this.startExistingConnectionDrag(),this._registerFloatingConnection(this.placeholderInfo,this.jpc),this.instance.currentlyDragging=!0}},{key:"onBeforeStart",value:function(t){this.payload=t.e.payload||{}}},{key:"onDrag",value:function(t){if(this._stopped)return!0;if(this.placeholderInfo.element){var e=bt(this.floatingElement,this.instance);this.instance.setElementPosition(this.placeholderInfo.element,t.pos.x,t.pos.y);for(var n,i,o={x:t.pos.x,y:t.pos.y,w:e.w,h:e.h},r=0;r<this.endpointDropTargets.length;r++)if(to(o,this.endpointDropTargets[r].r)){n=this.endpointDropTargets[r];break}if(n!==this.currentDropTarget&&null!=this.currentDropTarget&&(i=this._getFloatingAnchorIndex(),this.instance.removeClass(this.currentDropTarget.el,Yo),this.currentDropTarget.endpoint&&(this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.out()),null!=n)if(this.instance.addClass(n.el,Yo),i=this._getFloatingAnchorIndex(),null!=n.endpoint)if(n.endpoint.isSource&&0===i||n.endpoint.isTarget&&0!==i||this.jpc.suspendedEndpoint&&n.endpoint.referenceEndpoint&&n.endpoint.referenceEndpoint.id===this.jpc.suspendedEndpoint.id)this.instance.checkCondition(Ut,{sourceEndpoint:this.jpc.endpoints[i],targetEndpoint:n.endpoint.endpoint,connection:this.jpc})?(n.endpoint.endpoint.addClass(this.instance.endpointDropAllowedClass),n.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)):(n.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),n.endpoint.endpoint.addClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.over(n.endpoint),this.instance._paintConnection(this.jpc);else n=null;this.currentDropTarget=n}}},{key:"_maybeCleanup",value:function(t){t._mtNew&&0===t.connections.length?this.instance.deleteEndpoint(t):delete t._mtNew}},{key:"_reattachOrDiscard",value:function(t){var e=null!=this.jpc.suspendedEndpoint,n=this._getFloatingAnchorIndex();return e&&this._shouldReattach()?(0===n?(this.jpc.source=this.jpc.suspendedElement,this.jpc.sourceId=this.jpc.suspendedElementId):(this.jpc.target=this.jpc.suspendedElement,this.jpc.targetId=this.jpc.suspendedElementId),this._doForceReattach(n),!0):(this._discard(n,t),!1)}},{key:"onStop",value:function(t){var e=this,n=t.e;this.instance.isConnectionBeingDragged=!1,this.instance.currentlyDragging=!1;var i=Pt(Yo,Uo);if(D(this.instance.getContainer().querySelectorAll(Fr),(function(t){e.instance.removeClass(t,i)})),this.jpc&&null!=this.jpc.endpoints){var o,r=null!=this.jpc.suspendedEndpoint,s=this._getFloatingAnchorIndex(),a=this.jpc.suspendedEndpoint;if(null!=this.currentDropTarget)if(null==(o=this._getDropEndpoint(t,this.jpc)))this._reattachOrDiscard(t.e);else if(a&&a.id===o.id)this._doForceReattach(s);else if(o.enabled)if(o.isFull())o.fire(me,{endpoint:this,connection:this.jpc,maxConnections:this.instance.defaults.maxConnections},n),this._reattachOrDiscard(t.e);else{0===s?(this.jpc.source=o.element,this.jpc.sourceId=o.elementId):(this.jpc.target=o.element,this.jpc.targetId=o.elementId);var l=!0;r&&this.jpc.suspendedEndpoint.id!==o.id&&(this.jpc.isDetachAllowed(this.jpc)&&this.jpc.endpoints[s].isDetachAllowed(this.jpc)&&this.jpc.suspendedEndpoint.isDetachAllowed(this.jpc)&&this.instance.checkCondition("beforeDetach",this.jpc)||(l=!1)),(l=l&&o.isDropAllowed(this.jpc.sourceId,this.jpc.targetId,this.jpc.scope,this.jpc,o))?this._drop(o,s,n,l):this._reattachOrDiscard(t.e)}else this._reattachOrDiscard(t.e);else this._reattachOrDiscard(t.e);this.instance._refreshEndpoint(this.ep),this.ep.removeClass(this.instance.draggingClass),this._cleanupDraggablePlaceholder(),this.jpc.removeClass(this.instance.draggingClass),delete this.jpc.suspendedEndpoint,delete this.jpc.suspendedElement,delete this.jpc.suspendedElementType,delete this.jpc.suspendedElementId,delete this.jpc.suspendedIndex,delete this.floatingId,delete this.floatingIndex,delete this.floatingElement,delete this.floatingEndpoint,delete this.floatingAnchor,delete this.jpc.pending,null!=o&&this._maybeCleanup(o)}}},{key:"_getSourceDefinition",value:function(t){for(var e,n=this.instance.getContainer(),i=0;i<this.instance.sourceSelectors.length;i++){if((e=this.instance.sourceSelectors[i]).isEnabled())if(!1!==Rr(t,n,e.selector,this.instance,e.exclude))return e}}},{key:"_getDropEndpoint",value:function(t,e){var n;if(null==this.currentDropTarget.endpoint){var i=this.currentDropTarget.def,o=t.e.target||t.e.srcElement;if(null==i)return null;var r=this.currentDropTarget.targetEl,s=ca(t.e,r,this.instance.currentZoom),a=this.instance._deriveEndpointAndAnchorSpec(e.getType().join(" "),!0),l=a.endpoints?y(t,{endpoint:i.def.endpoint||a.endpoints[1],cssClass:i.def.cssClass||"",source:!0===i.def.source,target:!0===i.def.target}):t,u=this.instance.validAnchorsSpec(a.anchors)?a.anchors:this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors:null,c=i.def.anchor,h=i.def.anchorPositionFinder?i.def.anchorPositionFinder(r,s,i.def,t.e):null,d=null!=h?h:null!=c?c:null!=u&&null!=u[1]?u[1]:null;if(null!=d&&(l=y(l,{anchor:d})),null!=i.def.portId&&(l.portId=i.def.portId),(l=S(l,i.def.parameterExtractor?i.def.parameterExtractor(this.currentDropTarget.el,o,t.e):{})).element=r,(n=this.instance._internal_newEndpoint(l))._mtNew=!0,n.deleteOnEmpty=!0,i.def.parameters&&n.mergeParameters(i.def.parameters),i.def.extract){var p={};for(var f in i.def.extract){var v=this.currentDropTarget.el.getAttribute(f);v&&(p[i.def.extract[f]]=v)}n.mergeParameters(p)}}else n=this.currentDropTarget.endpoint;return n&&(n.removeClass(this.instance.endpointDropAllowedClass),n.removeClass(this.instance.endpointDropForbiddenClass)),n}},{key:"_doForceReattach",value:function(t){this.floatingEndpoint.detachFromConnection(this.jpc,null,!0),this.jpc.endpoints[t]=this.jpc.suspendedEndpoint,this.instance.setHover(this.jpc,!1),this.jpc._forceDetach=!0,this.jpc.suspendedEndpoint.addConnection(this.jpc),this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.suspendedEndpoint.elementId,this.jpc,this.jpc.suspendedEndpoint.element,t),this.instance.deleteEndpoint(this.floatingEndpoint),this.instance.repaint(this.jpc.source),delete this.jpc._forceDetach}},{key:"_shouldReattach",value:function(){if(this.jpc.isReattach()||this.jpc._forceReattach)return!0;var t=this.jpc.suspendedEndpoint,e=this.jpc.suspendedElementType==At?1:0,n=this.jpc.endpoints[e];return!M(!0,!1,[[t,ke,[this.jpc]],[n,ke,[this.jpc]],[this.jpc,ke,[this.jpc]],[this.instance,Ht,[Pe,this.jpc]]])}},{key:"_discard",value:function(t,e){this.jpc.pending?this.instance.fire(An,this.jpc,e):(0===t?(this.jpc.source=this.jpc.suspendedEndpoint.element,this.jpc.sourceId=this.jpc.suspendedEndpoint.elementId):(this.jpc.target=this.jpc.suspendedEndpoint.element,this.jpc.targetId=this.jpc.suspendedEndpoint.elementId),this.jpc.endpoints[t]=this.jpc.suspendedEndpoint),this.floatingEndpoint&&this.floatingEndpoint.detachFromConnection(this.jpc),this.instance.deleteConnection(this.jpc,{originalEvent:e,force:!0})}},{key:"_drop",value:function(t,e,n,i){if(this.jpc.endpoints[e].detachFromConnection(this.jpc),this.jpc.suspendedEndpoint&&this.jpc.suspendedEndpoint.detachFromConnection(this.jpc),this.jpc.endpoints[e]=t,t.addConnection(this.jpc),this.jpc.suspendedEndpoint){var o=this.jpc.suspendedEndpoint.elementId;this.instance.fireMoveEvent({index:e,originalSourceId:0===e?o:this.jpc.sourceId,newSourceId:0===e?t.elementId:this.jpc.sourceId,originalTargetId:1===e?o:this.jpc.targetId,newTargetId:1===e?t.elementId:this.jpc.targetId,originalEndpoint:this.jpc.suspendedEndpoint,connection:this.jpc,newEndpoint:t},n)}(1===e?this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.targetId,this.jpc,this.jpc.target,1):this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.sourceId,this.jpc,this.jpc.source,0),this.jpc.endpoints[0].finalEndpoint)&&(this.jpc.endpoints[0].detachFromConnection(this.jpc),this.jpc.endpoints[0]=this.jpc.endpoints[0].finalEndpoint,this.jpc.endpoints[0].addConnection(this.jpc));x(i)&&this.jpc.mergeData(i),this._originalAnchorSpec&&(this.jpc.endpoints[0].setAnchor(this._originalAnchorSpec),this._originalAnchorSpec=null),this.instance._finaliseConnection(this.jpc,null,n),this.instance.setHover(this.jpc,!1),this.instance.revalidate(this.jpc.endpoints[0].element)}},{key:"_registerFloatingConnection",value:function(t,e){this.floatingConnections[t.id]=e}},{key:"_getFloatingAnchorIndex",value:function(){return null==this.floatingIndex?1:this.floatingIndex}}]),t}(),Ur=function(t){s(i,t);var e=c(i);function i(t,o){var s;return n(this,i),(s=e.call(this,t,o)).instance=t,s.dragSelection=o,r(u(s),"selector",[">",si,Ae].join(" ")),r(u(s),"doRevalidate",void 0),s.doRevalidate=s._revalidate.bind(u(s)),s}return o(i,[{key:"reset",value:function(){this.drag.off(Tn,this.doRevalidate)}},{key:"_revalidate",value:function(t){this.instance.revalidate(t)}},{key:"init",value:function(t){this.drag=t,t.on(Tn,this.doRevalidate)}},{key:"useGhostProxy",value:function(t,e){var n=e._jsPlumbParentGroup;return null!=n&&!0===n.ghost}},{key:"makeGhostProxy",value:function(t){var e=t,n=e.cloneNode(!0);return n._jsPlumbParentGroup=e._jsPlumbParentGroup,n}}]),i}(Zo),Br=function(){function t(e,i){n(this,t),this.instance=e,this.overlay=i,r(this,"htmlElementOverlay",void 0),this.htmlElementOverlay=i}return o(t,null,[{key:"getElement",value:function(t,e,n){if(null==t.canvas){if(n&&e){t.canvas=n(e);var i=t.instance.overlayClass+" "+(t.cssClass?t.cssClass:"");t.instance.addClass(t.canvas,i)}else t.canvas=vt(an,{},t.instance.overlayClass+" "+(t.cssClass?t.cssClass:""));for(var o in t.instance.setAttribute(t.canvas,"jtk-overlay-id",t.id),t.attributes)t.instance.setAttribute(t.canvas,o,t.attributes[o]);t.canvas.style.position=Ot,t.instance._appendElement(t.canvas,t.instance.getContainer()),t.instance.getId(t.canvas);var r="translate(-50%, -50%)";t.canvas.style.webkitTransform=r,t.canvas.style.mozTransform=r,t.canvas.style.msTransform=r,t.canvas.style.oTransform=r,t.canvas.style.transform=r,t.isVisible()||(t.canvas.style.display=Dt),t.canvas.jtk={overlay:t}}return t.canvas}},{key:"destroy",value:function(t){t.canvas&&t.canvas.parentNode&&t.canvas.parentNode.removeChild(t.canvas),delete t.canvas,delete t.cachedDimensions}},{key:"_getDimensions",value:function(t,e){return(null==t.cachedDimensions||e)&&(t.cachedDimensions={w:1,h:1}),t.cachedDimensions}}]),t}(),Yr=function(){function t(){n(this,t),r(this,"_listeners",{}),r(this,"eventsSuspended",!1),r(this,"tick",!1),r(this,"eventsToDieOn",{ready:!0}),r(this,"queue",[])}return o(t,[{key:"fire",value:function(t,e,n){var i=null;if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[t]){var o=this._listeners[t].length,r=0,s=!1;if(!this.shouldFireEvent||this.shouldFireEvent(t,e,n))for(;!s&&r<o&&!1!==i;){if(this.eventsToDieOn[t])this._listeners[t][r](e,n);else try{i=this._listeners[t][r](e,n)}catch(e){J("jsPlumb: fire failed for event "+t+" : "+(e.message||e))}r++,null!=this._listeners&&null!=this._listeners[t]||(s=!0)}}this.tick=!1,this._drain()}return i}},{key:"_drain",value:function(){var t=this.queue.pop();t&&this.fire.apply(this,t)}},{key:"unbind",value:function(t,e){if(0===arguments.length)this._listeners={};else if(1===arguments.length){if("string"==typeof t)delete this._listeners[t];else if(t.__jsPlumb){var n;for(var i in t.__jsPlumb)n=t.__jsPlumb[i],V(this._listeners[n]||[],t)}}else 2===arguments.length&&V(this._listeners[t]||[],e);return this}},{key:"getListener",value:function(t){return this._listeners[t]||[]}},{key:"isSuspendEvents",value:function(){return this.eventsSuspended}},{key:"setSuspendEvents",value:function(t){this.eventsSuspended=t}},{key:"bind",value:function(t,e,n){var i=this,o=function(t){H(i._listeners,t,e,n),e.__jsPlumb=e.__jsPlumb||{},e.__jsPlumb[X()]=t};if("string"==typeof t)o(t);else if(null!=t.length)for(var r=0;r<t.length;r++)o(t[r]);return this}},{key:"silently",value:function(t){this.setSuspendEvents(!0);try{t()}catch(t){J("Cannot execute silent function "+t)}this.setSuspendEvents(!1)}}]),t}(),Xr=function(t){s(i,t);var e=c(i);function i(){return n(this,i),e.apply(this,arguments)}return o(i,[{key:"shouldFireEvent",value:function(t,e,n){return!0}}]),i}(Yr);function zr(t){var e=null;return(e=_(t)?{type:t,options:{}}:t).options.id=e.options.id||X(),e}var Wr=function(t){s(i,t);var e=c(i);function i(t,o,s){var a;for(var l in n(this,i),(a=e.call(this)).instance=t,a.component=o,r(u(a),"id",void 0),r(u(a),"type",void 0),r(u(a),"cssClass",void 0),r(u(a),"visible",!0),r(u(a),"location",void 0),r(u(a),"events",void 0),r(u(a),"attributes",void 0),s=s||{},a.id=s.id||X(),a.cssClass=s.cssClass||"",a.setLocation(s.location),a.events=s.events||{},a.attributes=s.attributes||{},a.events)a.bind(l,a.events[l]);return a}return o(i,[{key:"setLocation",value:function(t){var e=null==this.location?.5:this.location;if(null!=t)try{var n="string"==typeof t?parseFloat(t):t;isNaN(n)||(e=n)}catch(t){}this.location=e}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"setVisible",value:function(t){this.visible=t,this.instance.setOverlayVisible(this,t)}},{key:"isVisible",value:function(){return this.visible}}]),i}(Yr),qr={},Kr={get:function(t,e,n,i){var o=qr[e];if(o)return new o(t,n,i);throw{message:"jsPlumb: unknown overlay type '"+e+"'"}},register:function(t,e){qr[t]=e}},Zr=function(t){s(i,t);var e=c(i);function i(t,o,s){var a;return n(this,i),(a=e.call(this,t,o,s)).instance=t,a.component=o,r(u(a),"label",void 0),r(u(a),"labelText",void 0),r(u(a),"type",i.type),r(u(a),"cachedDimensions",void 0),s=s||{label:""},a.setLabel(s.label),a}return o(i,[{key:"getLabel",value:function(){return k(this.label)?this.label(this):this.labelText}},{key:"setLabel",value:function(t){this.label=t,this.labelText=null,this.instance.updateLabel(this)}},{key:"getDimensions",value:function(){return{w:1,h:1}}},{key:"updateFrom",value:function(t){null!=t.label&&this.setLabel(t.label),null!=t.location&&(this.setLocation(t.location),this.instance.updateLabel(this))}}]),i}(Wr);function Jr(t){return t.type===Zr.type}function Qr(t){return null==t?null:t.split(" ").filter((function(t){return null!=t&&t.length>0}))}function $r(t,e,n){for(var i in e)t[i]=n}r(Zr,"type","Label"),Kr.register(Zr.type,Zr);var ts="__default",es="__label",ns="overlay",is="remove";function os(t,e){if(t.getDefaultType){var n=t.getTypeDescriptor(),i={},o=t.getDefaultType(),r=y({},o);$r(i,o,ts),t._types.forEach((function(e){if(e!==ts){var o=t.instance.getType(e,n);if(null!=o){var s=new Set(["connector","anchor","anchors"]);if("override"===o.mergeStrategy)for(var a in o)s.add(a);r=S(r,o,["cssClass"],G(s)),$r(i,o,e)}}})),e&&(r=w(r,e,"_")),t.applyType(r,i)}}function rs(t,e){var n=t.instance.getType(e,t.getTypeDescriptor());null!=n&&n.cssClass&&t.removeClass(n.cssClass)}function ss(t){if(t.paintStyle&&t.hoverPaintStyle){var e={};y(e,t.paintStyle),y(e,t.hoverPaintStyle),t.hoverPaintStyle=e}}var as=function(t){s(i,t);var e=c(i);function i(t,o){var s;if(n(this,i),(s=e.call(this)).instance=t,r(u(s),"defaultLabelLocation",.5),r(u(s),"overlays",{}),r(u(s),"overlayPositions",{}),r(u(s),"overlayPlacements",{}),r(u(s),"clone",void 0),r(u(s),"deleted",void 0),r(u(s),"segment",void 0),r(u(s),"x",void 0),r(u(s),"y",void 0),r(u(s),"w",void 0),r(u(s),"h",void 0),r(u(s),"id",void 0),r(u(s),"visible",!0),r(u(s),"typeId",void 0),r(u(s),"params",{}),r(u(s),"paintStyle",void 0),r(u(s),"hoverPaintStyle",void 0),r(u(s),"paintStyleInUse",void 0),r(u(s),"_hover",!1),r(u(s),"lastPaintedAt",void 0),r(u(s),"data",void 0),r(u(s),"_defaultType",void 0),r(u(s),"events",void 0),r(u(s),"parameters",void 0),r(u(s),"_types",void 0),r(u(s),"_typeCache",void 0),r(u(s),"cssClass",void 0),r(u(s),"hoverClass",void 0),r(u(s),"beforeDetach",void 0),r(u(s),"beforeDrop",void 0),o=o||{},s.cssClass=o.cssClass||"",s.hoverClass=o.hoverClass||t.defaults.hoverClass,s.beforeDetach=o.beforeDetach,s.beforeDrop=o.beforeDrop,s._types=new Set,s._typeCache={},s.parameters=C(o.parameters||{}),s.id=o.id||s.getIdPrefix()+(new Date).getTime(),s._defaultType={parameters:s.parameters,scope:o.scope||s.instance.defaultScope,overlays:{}},o.events)for(var a in o.events)s.bind(a,o.events[a]);s.clone=function(){var e=Object.create(s.constructor.prototype);return s.constructor.apply(e,[t,o]),e},s.overlays={},s.overlayPositions={};var l=o.overlays||[],c={},h=s.getDefaultOverlayKey();if(h){var d=s.instance.defaults[h];d&&l.push.apply(l,p(d));for(var f=0;f<l.length;f++){var v=zr(l[f]);c[v.options.id]=v}}return s._defaultType.overlays=c,o.label&&(s.getDefaultType().overlays[es]={type:Zr.type,options:{label:o.label,location:o.labelLocation||s.defaultLabelLocation,id:es,cssClass:"jtk-default-label"}}),s}return o(i,[{key:"isDetachAllowed",value:function(t){var e=!0;if(this.beforeDetach)try{e=this.beforeDetach(t)}catch(t){J("jsPlumb: beforeDetach callback failed",t)}return e}},{key:"isDropAllowed",value:function(t,e,n,i,o){var r,s={sourceId:t,targetId:e,scope:n,connection:i,dropEndpoint:o};if(this.beforeDrop)try{r=this.beforeDrop(s)}catch(t){J("jsPlumb: beforeDrop callback failed",t)}else r=this.instance.checkCondition(Se,s);return r}},{key:"getDefaultType",value:function(){return this._defaultType}},{key:"appendToDefaultType",value:function(t){for(var e in t)this._defaultType[e]=t[e]}},{key:"getId",value:function(){return this.id}},{key:"cacheTypeItem",value:function(t,e,n){this._typeCache[n]=this._typeCache[n]||{},this._typeCache[n][t]=e}},{key:"getCachedTypeItem",value:function(t,e){return this._typeCache[e]?this._typeCache[e][t]:null}},{key:"setType",value:function(t,e){this.clearTypes(),(Qr(t)||[]).forEach(this._types.add,this._types),os(this,e)}},{key:"getType",value:function(){return Array.from(this._types.keys())}},{key:"reapplyTypes",value:function(t){os(this,t)}},{key:"hasType",value:function(t){return this._types.has(t)}},{key:"addType",value:function(t,e){var n=Qr(t),i=!1;if(null!=n){for(var o=0,r=n.length;o<r;o++)this._types.has(n[o])||(this._types.add(n[o]),i=!0);i&&os(this,e)}}},{key:"removeType",value:function(t,e){var n,i=this,o=Qr(t),r=!1;if(null!=o){for(var s=0,a=o.length;s<a;s++)n=o[s],r=!!i._types.has(n)&&(rs(i,n),i._types.delete(n),!0)||r;r&&os(this,e)}}},{key:"clearTypes",value:function(t){var e=this;this._types.forEach((function(t){rs(e,t)})),this._types.clear(),os(this,t)}},{key:"toggleType",value:function(t,e){var n=Qr(t);if(null!=n){for(var i=0,o=n.length;i<o;i++)this._types.has(n[i])?(rs(this,n[i]),this._types.delete(n[i])):this._types.add(n[i]);os(this,e)}}},{key:"applyType",value:function(t,e){if(this.setPaintStyle(t.paintStyle),this.setHoverPaintStyle(t.hoverPaintStyle),this.mergeParameters(t.parameters),this.paintStyleInUse=this.getPaintStyle(),t.overlays){var n,i={};for(n in t.overlays){var o=this.overlays[t.overlays[n].options.id];if(o)o.updateFrom(t.overlays[n].options),i[t.overlays[n].options.id]=!0,this.instance.reattachOverlay(o,this);else{var r=this.getCachedTypeItem(ns,t.overlays[n].options.id);null!=r?(this.instance.reattachOverlay(r,this),r.setVisible(!0),r.updateFrom(t.overlays[n].options),this.overlays[r.id]=r):r=this.addOverlay(t.overlays[n]),i[r.id]=!0}}for(n in this.overlays)null==i[this.overlays[n].id]&&this.removeOverlay(this.overlays[n].id,!0)}}},{key:"setPaintStyle",value:function(t){this.paintStyle=t,this.paintStyleInUse=this.paintStyle,ss(this)}},{key:"getPaintStyle",value:function(){return this.paintStyle}},{key:"setHoverPaintStyle",value:function(t){this.hoverPaintStyle=t,ss(this)}},{key:"getHoverPaintStyle",value:function(){return this.hoverPaintStyle}},{key:"destroy",value:function(){for(var t in this.overlays)this.instance.destroyOverlay(this.overlays[t]);this.overlays={},this.overlayPositions={},this.unbind(),this.clone=null}},{key:"isHover",value:function(){return this._hover}},{key:"mergeParameters",value:function(t){null!=t&&y(this.parameters,t)}},{key:"setVisible",value:function(t){this.visible=t,t?this.showOverlays():this.hideOverlays()}},{key:"isVisible",value:function(){return this.visible}},{key:"setAbsoluteOverlayPosition",value:function(t,e){this.overlayPositions[t.id]=e}},{key:"getAbsoluteOverlayPosition",value:function(t){return this.overlayPositions?this.overlayPositions[t.id]:null}},{key:"_clazzManip",value:function(t,e){for(var n in this.overlays)"add"===t?this.instance.addOverlayClass(this.overlays[n],e):t===is&&this.instance.removeOverlayClass(this.overlays[n],e)}},{key:"addClass",value:function(t,e){var n=(this.cssClass||"").split(" ");n.push(t),this.cssClass=n.join(" "),this._clazzManip("add",t)}},{key:"removeClass",value:function(t,e){var n=(this.cssClass||"").split(" ");this.cssClass=n.filter((function(e){return e!==t})).join(" "),this._clazzManip(is,t)}},{key:"getClass",value:function(){return this.cssClass}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"getData",value:function(){return this.data}},{key:"setData",value:function(t){this.data=t||{}}},{key:"mergeData",value:function(t){this.data=y(this.data,t)}},{key:"addOverlay",value:function(t){var e=function(t,e){var n=null;if(_(e))n=Kr.get(t.instance,e,t,{});else if(null!=e.type&&null!=e.options){var i=e,o=y({},i.options);n=Kr.get(t.instance,i.type,t,o)}else n=e;return n.id=n.id||X(),t.cacheTypeItem(ns,n,n.id),t.overlays[n.id]=n,n}(this,t);if(this.getData&&e.type===Zr.type&&!_(t)){var n=this.getData(),i=t.options;if(n){var o=n[i.labelLocationAttribute||"labelLocation"];o&&(e.location=o)}}return e}},{key:"getOverlay",value:function(t){return this.overlays[t]}},{key:"getOverlays",value:function(){return this.overlays}},{key:"hideOverlay",value:function(t){var e=this.getOverlay(t);e&&e.setVisible(!1)}},{key:"hideOverlays",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i in e=e||[],this.overlays)0!==e.length&&-1===e.indexOf(i)||this.overlays[i].setVisible(!1)}},{key:"showOverlay",value:function(t){var e=this.getOverlay(t);e&&e.setVisible(!0)}},{key:"showOverlays",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i in e=e||[],this.overlays)0!==e.length&&-1===e.indexOf(i)||this.overlays[i].setVisible(!0)}},{key:"removeAllOverlays",value:function(){for(var t in this.overlays)this.instance.destroyOverlay(this.overlays[t]);this.overlays={},this.overlayPositions=null,this.overlayPlacements={}}},{key:"removeOverlay",value:function(t,e){var n=this.overlays[t];n&&(n.setVisible(!1),e||this.instance.destroyOverlay(n),delete this.overlays[t],this.overlayPositions&&delete this.overlayPositions[t],this.overlayPlacements&&delete this.overlayPlacements[t])}},{key:"removeOverlays",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,o=e.length;i<o;i++)this.removeOverlay(arguments[i])}},{key:"getLabel",value:function(){var t=this.getLabelOverlay();return null!=t?t.getLabel():null}},{key:"getLabelOverlay",value:function(){return this.getOverlay(es)}},{key:"setLabel",value:function(t){var e,n,i,o=this.getLabelOverlay();if(o)if(_(t)||k(t))o.setLabel(t);else{var r=t;r.label&&o.setLabel(r.label),r.location&&(o.location=r.location)}else{var s=_(t)||k(t)?{label:t}:t;e=this,i=y({cssClass:(n=s).cssClass,id:es,component:e},n),o=new Zr(e.instance,e,i),this.overlays[es]=o}}}]),i}(Yr),ls=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],us=function(e){s(l,e);var i=c(l);function l(e,o){var s;n(this,l),(s=i.call(this,e,o)).instance=e,r(u(s),"connections",[]),r(u(s),"endpoint",void 0),r(u(s),"element",void 0),r(u(s),"elementId",void 0),r(u(s),"dragAllowedWhenFull",!0),r(u(s),"timestamp",void 0),r(u(s),"portId",void 0),r(u(s),"maxConnections",void 0),r(u(s),"proxiedBy",void 0),r(u(s),"connectorClass",void 0),r(u(s),"connectorHoverClass",void 0),r(u(s),"finalEndpoint",void 0),r(u(s),"enabled",!0),r(u(s),"isSource",void 0),r(u(s),"isTarget",void 0),r(u(s),"isTemporarySource",void 0),r(u(s),"connectionCost",1),r(u(s),"connectionsDirected",void 0),r(u(s),"connectionsDetachable",void 0),r(u(s),"reattachConnections",void 0),r(u(s),"currentAnchorClass",void 0),r(u(s),"referenceEndpoint",void 0),r(u(s),"edgeType",void 0),r(u(s),"connector",void 0),r(u(s),"connectorOverlays",void 0),r(u(s),"connectorStyle",void 0),r(u(s),"connectorHoverStyle",void 0),r(u(s),"deleteOnEmpty",void 0),r(u(s),"uuid",void 0),r(u(s),"scope",void 0),r(u(s),"_anchor",void 0),r(u(s),"defaultLabelLocation",[.5,.5]),s.appendToDefaultType({edgeType:o.edgeType,maxConnections:null==o.maxConnections?s.instance.defaults.maxConnections:o.maxConnections,paintStyle:o.paintStyle||s.instance.defaults.endpointStyle,hoverPaintStyle:o.hoverPaintStyle||s.instance.defaults.endpointHoverStyle,connectorStyle:o.connectorStyle,connectorHoverStyle:o.connectorHoverStyle,connectorClass:o.connectorClass,connectorHoverClass:o.connectorHoverClass,connectorOverlays:o.connectorOverlays,connector:o.connector}),s.enabled=!(!1===o.enabled),s.visible=!0,s.element=o.element,s.uuid=o.uuid,s.portId=o.portId,s.elementId=o.elementId,s.connectionCost=null==o.connectionCost?1:o.connectionCost,s.connectionsDirected=o.connectionsDirected,s.currentAnchorClass="",s.events={},s.connectorOverlays=o.connectorOverlays,s.connectorStyle=o.connectorStyle,s.connectorHoverStyle=o.connectorHoverStyle,s.connector=o.connector,s.edgeType=o.edgeType,s.connectorClass=o.connectorClass,s.connectorHoverClass=o.connectorHoverClass,s.deleteOnEmpty=!0===o.deleteOnEmpty,s.isSource=o.source||!1,s.isTemporarySource=o.isTemporarySource||!1,s.isTarget=o.target||!1,s.connections=o.connections||[],s.scope=o.scope||e.defaultScope,s.timestamp=null,s.reattachConnections=o.reattachConnections||e.defaults.reattachConnections,s.connectionsDetachable=e.defaults.connectionsDetachable,!1===o.connectionsDetachable&&(s.connectionsDetachable=!1),s.dragAllowedWhenFull=!1!==o.dragAllowedWhenFull,o.onMaxConnections&&s.bind(me,o.onMaxConnections);var a=o.endpoint||o.existingEndpoint||e.defaults.endpoint;if(s.setEndpoint(a),null!=o.preparedAnchor)s.setPreparedAnchor(o.preparedAnchor);else{var c=o.anchor?o.anchor:o.anchors?o.anchors:e.defaults.anchor||t.AnchorLocations.Top;s.setAnchor(c)}var h=[fi,o.type||""].join(" ");return s.addType(h,o.data),s}return o(l,[{key:"getIdPrefix",value:function(){return"_jsplumb_e"}},{key:"getTypeDescriptor",value:function(){return"endpoint"}},{key:"getXY",value:function(){return{x:this.endpoint.x,y:this.endpoint.y}}},{key:"getDefaultOverlayKey",value:function(){return"endpointOverlays"}},{key:"_updateAnchorClass",value:function(){var t=this._anchor&&this._anchor.cssClass;if(null!=t&&t.length>0){var e=this.instance.endpointAnchorClassPrefix+"-"+this.currentAnchorClass;this.currentAnchorClass=t;var n=this.instance.endpointAnchorClassPrefix+(this.currentAnchorClass?"-"+this.currentAnchorClass:"");e!==n&&(this.removeClass(e),this.addClass(n),this.instance.removeClass(this.element,e),this.instance.addClass(this.element,n))}}},{key:"setPreparedAnchor",value:function(t){return this.instance.router.setAnchor(this,t),this._updateAnchorClass(),this}},{key:"_anchorLocationChanged",value:function(t){this.fire(ne,{endpoint:this,anchor:t}),this._updateAnchorClass()}},{key:"setAnchor",value:function(t){var e=this.instance.router.prepareAnchor(t);return this.setPreparedAnchor(e),this}},{key:"addConnection",value:function(t){this.connections.push(t),this.instance._refreshEndpoint(this)}},{key:"detachFromConnection",value:function(t,e,n){(e=null==e?this.connections.indexOf(t):e)>=0&&(this.connections.splice(e,1),this.instance._refreshEndpoint(this)),!n&&this.deleteOnEmpty&&0===this.connections.length&&this.instance.deleteEndpoint(this)}},{key:"deleteEveryConnection",value:function(t){for(var e=this.connections.length,n=0;n<e;n++)this.instance.deleteConnection(this.connections[0],t)}},{key:"detachFrom",value:function(t){for(var e=[],n=0;n<this.connections.length;n++)this.connections[n].endpoints[1]!==t&&this.connections[n].endpoints[0]!==t||e.push(this.connections[n]);for(var i=0,o=e.length;i<o;i++)this.instance.deleteConnection(e[0]);return this}},{key:"setVisible",value:function(t,e,n){if(h(a(l.prototype),"setVisible",this).call(this,t),this.endpoint.setVisible(t),t?this.showOverlays():this.hideOverlays(),!e)for(var i=0;i<this.connections.length;i++)if(this.connections[i].setVisible(t),!n){var o=this===this.connections[i].endpoints[0]?1:0;1===this.connections[i].endpoints[o].connections.length&&this.connections[i].endpoints[o].setVisible(t,!0,!0)}}},{key:"applyType",value:function(t,e){h(a(l.prototype),"applyType",this).call(this,t,e),this.setPaintStyle(t.endpointStyle||t.paintStyle),this.setHoverPaintStyle(t.endpointHoverStyle||t.hoverPaintStyle),this.connectorStyle=t.connectorStyle,this.connectorHoverStyle=t.connectorHoverStyle,this.connector=t.connector,this.connectorOverlays=t.connectorOverlays,this.edgeType=t.edgeType,null!=t.maxConnections&&(this.maxConnections=t.maxConnections),t.scope&&(this.scope=t.scope),y(t,ls),this.instance.applyEndpointType(this,t)}},{key:"destroy",value:function(){h(a(l.prototype),"destroy",this).call(this),this.deleted=!0,null!=this.endpoint&&this.instance.destroyEndpoint(this)}},{key:"isFull",value:function(){return 0===this.maxConnections||!(this.isFloating()||this.maxConnections<0||this.connections.length<this.maxConnections)}},{key:"isFloating",value:function(){return this.instance.router.isFloating(this)}},{key:"isConnectedTo",value:function(t){var e=!1;if(t)for(var n=0;n<this.connections.length;n++)if(this.connections[n].endpoints[1]===t||this.connections[n].endpoints[0]===t){e=!0;break}return e}},{key:"setDragAllowedWhenFull",value:function(t){this.dragAllowedWhenFull=t}},{key:"getUuid",value:function(){return this.uuid}},{key:"connectorSelector",value:function(){return this.connections[0]}},{key:"prepareEndpoint",value:function(t,e){var n,i={cssClass:this.cssClass,endpoint:this};if(et(t,er)){var o=t;(n=tr.clone(o)).classes=i.cssClass.split(" ")}else if(_(t))n=tr.get(this,t,i);else{var r=t;y(i,r.options||{}),n=tr.get(this,r.type,i)}return n.typeId=e,n}},{key:"setEndpoint",value:function(t){var e=this.prepareEndpoint(t);this.setPreparedEndpoint(e)}},{key:"setPreparedEndpoint",value:function(t){null!=this.endpoint&&this.instance.destroyEndpoint(this),this.endpoint=t}},{key:"addClass",value:function(t,e){h(a(l.prototype),"addClass",this).call(this,t,e),null!=this.endpoint&&this.endpoint.addClass(t)}},{key:"removeClass",value:function(t,e){h(a(l.prototype),"removeClass",this).call(this,t,e),null!=this.endpoint&&this.endpoint.removeClass(t)}}]),l}(as),cs="anchors",hs="connector";function ds(t,e,n,i,o,r,s){var a;if(e)t.endpoints[n]=e,e.addConnection(t);else{var l=s||t.endpointSpec||t.endpointsSpec[n]||t.instance.defaults.endpoints[n]||t.instance.defaults.endpoint,u=t.endpointStyles[n]||t.endpointStyle||t.instance.defaults.endpointStyles[n]||t.instance.defaults.endpointStyle;null==u.fill&&null!=t.paintStyle&&(u.fill=t.paintStyle.stroke),null==u.outlineStroke&&null!=t.paintStyle&&(u.outlineStroke=t.paintStyle.outlineStroke),null==u.outlineWidth&&null!=t.paintStyle&&(u.outlineWidth=t.paintStyle.outlineWidth);var c=t.endpointHoverStyles[n]||t.endpointHoverStyle||t.endpointHoverStyle||t.instance.defaults.endpointHoverStyles[n]||t.instance.defaults.endpointHoverStyle;null!=t.hoverPaintStyle&&(null==c&&(c={}),null==c.fill&&(c.fill=t.hoverPaintStyle.stroke));var h=t.uuids?t.uuids[n]:null;i=null!=i?i:null!=t.instance.defaults.anchors?t.instance.defaults.anchors[n]:t.instance.defaults.anchor,a=t.instance._internal_newEndpoint({paintStyle:u,hoverPaintStyle:c,endpoint:l,connections:[t],uuid:h,element:o,scope:t.scope,anchor:i,reattachConnections:t.reattach||t.instance.defaults.reattachConnections,connectionsDetachable:t.detachable||t.instance.defaults.connectionsDetachable}),t.instance._refreshEndpoint(a),null==e&&(a.deleteOnEmpty=!0),t.endpoints[n]=a}return a}var ps=function(t){s(i,t);var e=c(i);function i(t,o){var s;n(this,i),(s=e.call(this,t,o)).instance=t,r(u(s),"connector",void 0),r(u(s),"defaultLabelLocation",.5),r(u(s),"scope",void 0),r(u(s),"typeId","_jsplumb_connection"),r(u(s),"previousConnection",void 0),r(u(s),"sourceId",void 0),r(u(s),"targetId",void 0),r(u(s),"source",void 0),r(u(s),"target",void 0),r(u(s),"detachable",!0),r(u(s),"reattach",!1),r(u(s),"uuids",void 0),r(u(s),"cost",1),r(u(s),"directed",void 0),r(u(s),"endpoints",[null,null]),r(u(s),"endpointStyles",void 0),r(u(s),"endpointSpec",void 0),r(u(s),"endpointsSpec",void 0),r(u(s),"endpointStyle",{}),r(u(s),"endpointHoverStyle",{}),r(u(s),"endpointHoverStyles",void 0),r(u(s),"suspendedEndpoint",void 0),r(u(s),"suspendedIndex",void 0),r(u(s),"suspendedElement",void 0),r(u(s),"suspendedElementId",void 0),r(u(s),"suspendedElementType",void 0),r(u(s),"_forceReattach",void 0),r(u(s),"_forceDetach",void 0),r(u(s),"proxies",[]),r(u(s),"pending",!1),s.id=o.id,s.previousConnection=o.previousConnection,s.source=o.source,s.target=o.target,o.sourceEndpoint?(s.source=o.sourceEndpoint.element,s.sourceId=o.sourceEndpoint.elementId):s.sourceId=t.getId(s.source),o.targetEndpoint?(s.target=o.targetEndpoint.element,s.targetId=o.targetEndpoint.elementId):s.targetId=t.getId(s.target),s.scope=o.scope;var a=o.anchors?o.anchors[0]:o.anchor,l=o.anchors?o.anchors[1]:o.anchor;t.manage(s.source),t.manage(s.target),s.visible=!0,s.params={cssClass:o.cssClass,hoverClass:o.hoverClass,"pointer-events":o["pointer-events"],overlays:o.overlays},s.lastPaintedAt=null,o.type&&(o.endpoints=o.endpoints||s.instance._deriveEndpointAndAnchorSpec(o.type).endpoints),s.endpointSpec=o.endpoint,s.endpointsSpec=o.endpoints||[null,null],s.endpointStyle=o.endpointStyle,s.endpointHoverStyle=o.endpointHoverStyle,s.endpointStyles=o.endpointStyles||[null,null],s.endpointHoverStyles=o.endpointHoverStyles||[null,null],s.paintStyle=o.paintStyle,s.hoverPaintStyle=o.hoverPaintStyle,s.uuids=o.uuids,s.makeEndpoint(!0,s.source,s.sourceId,a,o.sourceEndpoint),s.makeEndpoint(!1,s.target,s.targetId,l,o.targetEndpoint),s.scope||(s.scope=s.endpoints[0].scope),null!=o.deleteEndpointsOnEmpty&&(s.endpoints[0].deleteOnEmpty=o.deleteEndpointsOnEmpty,s.endpoints[1].deleteOnEmpty=o.deleteEndpointsOnEmpty);var c=s.instance.defaults.connectionsDetachable;!1===o.detachable&&(c=!1),!1===s.endpoints[0].connectionsDetachable&&(c=!1),!1===s.endpoints[1].connectionsDetachable&&(c=!1),s.endpointsSpec=o.endpoints||[null,null],s.endpointSpec=o.endpoint||null;var h=o.reattach||s.endpoints[0].reattachConnections||s.endpoints[1].reattachConnections||s.instance.defaults.reattachConnections,d=y({},s.endpoints[0].connectorStyle||s.endpoints[1].connectorStyle||o.paintStyle||s.instance.defaults.paintStyle);if(s.appendToDefaultType({detachable:c,reattach:h,paintStyle:d,hoverPaintStyle:y({},s.endpoints[0].connectorHoverStyle||s.endpoints[1].connectorHoverStyle||o.hoverPaintStyle||s.instance.defaults.hoverPaintStyle)}),o.outlineWidth&&(d.outlineWidth=o.outlineWidth),o.outlineColor&&(d.outlineStroke=o.outlineColor),o.lineWidth&&(d.strokeWidth=o.lineWidth),o.color&&(d.stroke=o.color),!s.instance._suspendDrawing){var p=s.instance._suspendedAt||X();s.instance._paintEndpoint(s.endpoints[0],{timestamp:p}),s.instance._paintEndpoint(s.endpoints[1],{timestamp:p})}s.cost=o.cost||s.endpoints[0].connectionCost,s.directed=o.directed,null==o.directed&&(s.directed=s.endpoints[0].connectionsDirected);var f=y({},s.endpoints[1].parameters);y(f,s.endpoints[0].parameters),y(f,s.parameters),s.parameters=f,s.paintStyleInUse=s.getPaintStyle()||{},s._setConnector(s.endpoints[0].connector||s.endpoints[1].connector||o.connector||s.instance.defaults.connector,!0);var v=null!=o.data&&x(o.data)?o.data:{};s.setData(v);var g=[fi,s.endpoints[0].edgeType,s.endpoints[1].edgeType,o.type].join(" ");return/[^\s]/.test(g)&&s.addType(g,o.data),s}return o(i,[{key:"getIdPrefix",value:function(){return"_jsPlumb_c"}},{key:"getDefaultOverlayKey",value:function(){return Ie}},{key:"getXY",value:function(){return{x:this.connector.x,y:this.connector.y}}},{key:"makeEndpoint",value:function(t,e,n,i,o){return n=n||this.instance.getId(e),ds(this,o,t?0:1,i,e)}},{key:"getTypeDescriptor",value:function(){return i.type}},{key:"isDetachable",value:function(t){return!1!==this.detachable&&(null!=t?!0===t.connectionsDetachable:!0===this.detachable)}},{key:"setDetachable",value:function(t){this.detachable=!0===t}},{key:"isReattach",value:function(){return!0===this.reattach||!0===this.endpoints[0].reattachConnections||!0===this.endpoints[1].reattachConnections}},{key:"setReattach",value:function(t){this.reattach=!0===t}},{key:"applyType",value:function(t,e){var n=null;null!=t.connector&&(null==(n=this.getCachedTypeItem(hs,e.connector))&&(n=this.prepareConnector(t.connector,e.connector),this.cacheTypeItem(hs,n,e.connector)),this.setPreparedConnector(n)),h(a(i.prototype),"applyType",this).call(this,t,e),null!=t.detachable&&this.setDetachable(t.detachable),null!=t.reattach&&this.setReattach(t.reattach),t.scope&&(this.scope=t.scope);var o=null;t.anchor?null==(o=this.getCachedTypeItem(cs,e.anchor))&&(o=[Tr(t.anchor),Tr(t.anchor)],this.cacheTypeItem(cs,o,e.anchor)):t.anchors&&null==(o=this.getCachedTypeItem(cs,e.anchors))&&(o=[Tr(t.anchors[0]),Tr(t.anchors[1])],this.cacheTypeItem(cs,o,e.anchors)),null!=o&&(this.instance.router.setConnectionAnchors(this,o),this.instance.router.isDynamicAnchor(this.endpoints[1])&&this.instance.repaint(this.endpoints[1].element)),this.instance.applyConnectorType(this.connector,t)}},{key:"addClass",value:function(t,e){h(a(i.prototype),"addClass",this).call(this,t),e&&(this.endpoints[0].addClass(t),this.endpoints[1].addClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(t)),this.connector&&this.instance.addConnectorClass(this.connector,t)}},{key:"removeClass",value:function(t,e){h(a(i.prototype),"removeClass",this).call(this,t),e&&(this.endpoints[0].removeClass(t),this.endpoints[1].removeClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(t)),this.connector&&this.instance.removeConnectorClass(this.connector,t)}},{key:"setVisible",value:function(t){h(a(i.prototype),"setVisible",this).call(this,t),this.connector&&this.instance.setConnectorVisible(this.connector,t),this.instance._paintConnection(this)}},{key:"destroy",value:function(){h(a(i.prototype),"destroy",this).call(this),this.endpoints=null,this.endpointStyles=null,this.source=null,this.target=null,this.instance.destroyConnector(this),this.connector=null,this.deleted=!0}},{key:"getUuids",value:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]}},{key:"prepareConnector",value:function(t,e){var n,i={cssClass:this.params.cssClass,hoverClass:this.params.hoverClass,"pointer-events":this.params["pointer-events"]};if(_(t))n=this.instance._makeConnector(this,t,i);else{var o=t;n=this.instance._makeConnector(this,o.type,S(o.options||{},i))}return null!=e&&(n.typeId=e),n}},{key:"setPreparedConnector",value:function(t,e,n,i){if(this.connector!==t){var o,r="";if(null!=this.connector&&(o=this.connector,r=this.instance.getConnectorClass(this.connector),this.instance.destroyConnector(this)),this.connector=t,i&&this.cacheTypeItem(hs,t,i),this.addClass(r),null!=o){var s=this.getOverlays();for(var a in s)this.instance.reattachOverlay(s[a],this)}e||this.instance._paintConnection(this)}}},{key:"_setConnector",value:function(t,e,n,i){var o=this.prepareConnector(t,i);this.setPreparedConnector(o,e,n,i)}},{key:"replaceEndpoint",value:function(t,e){var n=this.endpoints[t],i=(n.elementId,this.instance.getEndpoints(n.element)),o=i.indexOf(n),r=ds(this,null,t,null,n.element,0,e);this.endpoints[t]=r,i.splice(o,1,r),n.detachFromConnection(this),this.instance.deleteEndpoint(n),this.instance.fire(le,{previous:n,current:r})}}]),i}(as);function fs(t){if(null==t.path){var e=y({"jtk-overlay-id":t.id},t.attributes);t.path=Xe(Ue,e);var n=t.instance.overlayClass+" "+(t.cssClass?t.cssClass:"");t.instance.addClass(t.path,n),t.path.jtk={overlay:t}}var i=t.path.parentNode;if(null==i){if(t.component instanceof ps){var o=t.component.connector;i=null!=o?o.canvas:null}else if(t.component instanceof us){var r=t.component.endpoint;i=null!=r?r.canvas:r}null!=i&&qe(i,t.path,1)}return t.path}r(ps,"type","connection"),function(t){s(i,t);var e=c(i);function i(){var t;n(this,i);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return r(u(t=e.call.apply(e,[this].concat(s))),"path",void 0),t}}(Wr);var vs=function(){function e(){n(this,e)}return o(e,null,[{key:"paint",value:function(e,n,i,o){if(null!=i){var r=[e.x,e.y],s=[e.w,e.h];if(null!=o&&(o.xmin<0&&(r[0]+=o.xmin),o.ymin<0&&(r[1]+=o.ymin),s[0]=o.xmax+(o.xmin<0?-o.xmin:0),s[1]=o.ymax+(o.ymin<0?-o.ymin:0)),isFinite(s[0])&&isFinite(s[1])){var a={width:""+(s[0]||0),height:""+(s[1]||0)};n.containerType===t.ElementTypes.HTML?Ye(e.canvas,y(a,{style:ze([r[0],r[1]])})):Ye(e.canvas,y(a,{x:r[0],y:r[1]}))}}}}]),e}();function gs(t,e,n,i){!function(t,e){if(null!=e.canvas)return e.canvas;var n=Xe(He,{style:"",width:"0",height:"0","pointer-events":Dt,position:Ot});e.canvas=n,t._appendElement(e.canvas,t.getContainer()),null!=e.cssClass&&t.addClass(n,e.cssClass),t.addClass(n,t.connectorClass),n.jtk=n.jtk||{},n.jtk.connector=e}(t,e),vs.paint(e,t,n,i);var o=[0,0];if(i.xmin<0&&(o[0]=-i.xmin),i.ymin<0&&(o[1]=-i.ymin),e.segments.length>0){var r={d:t.getPathData(e),transform:"translate("+o[0]+","+o[1]+")","pointer-events":"visibleStroke"},s=null;if(n.outlineStroke){var a=n.outlineWidth||1,l=n.strokeWidth+2*a;(s=y({},n)).stroke=n.outlineStroke,s.strokeWidth=l,null==e.bgPath?(e.bgPath=Xe(Ue,r),t.addClass(e.bgPath,t.connectorOutlineClass),qe(e.canvas,e.bgPath,0)):Ye(e.bgPath,r),We(e.canvas,e.bgPath,s)}var u=e;null==u.path?(u.path=Xe(Ue,r),qe(u.canvas,u.path,n.outlineStroke?1:0)):(u.path.parentNode!==u.canvas&&qe(u.canvas,u.path,n.outlineStroke?1:0),Ye(e.path,r)),We(e.canvas,e.path,n)}}var ys=function(){function t(){n(this,t)}return o(t,null,[{key:"getEndpointElement",value:function(t){if(null!=t.canvas)return t.canvas;var e=Xe(He,{style:"",width:"0",height:"0","pointer-events":"all",position:Ot});t.canvas=e;var n=t.classes.join(" ");t.instance.addClass(e,n);for(var i=t.endpoint.scope.split(/\s/),o=0;o<i.length;o++)t.instance.setAttribute(e,Vt+i[o],vi);return t.instance._appendElementToContainer(e),null!=t.cssClass&&t.instance.addClass(e,t.cssClass),t.instance.addClass(e,t.instance.endpointClass),e.jtk=e.jtk||{},e.jtk.endpoint=t.endpoint,e.style.display=!1!==t.endpoint.visible?wt:Dt,e}},{key:"paint",value:function(t,e,n){if(!0!==t.endpoint.deleted){this.getEndpointElement(t),vs.paint(t,t.instance,n);var i=y({},n);i.outlineStroke&&(i.stroke=i.outlineStroke),null==t.node?(t.node=e.makeNode(t,i),t.canvas.appendChild(t.node)):null!=e.updateNode&&e.updateNode(t,t.node),We(t.canvas,t.node,i)}}}]),t}(),ms=function(){function t(e,i){n(this,t),this.connection=e,r(this,"type",void 0),r(this,"edited",!1),r(this,"stub",void 0),r(this,"sourceStub",void 0),r(this,"targetStub",void 0),r(this,"maxStub",void 0),r(this,"typeId",void 0),r(this,"gap",void 0),r(this,"sourceGap",void 0),r(this,"targetGap",void 0),r(this,"segments",[]),r(this,"totalLength",0),r(this,"segmentProportions",[]),r(this,"segmentProportionalLengths",[]),r(this,"paintInfo",null),r(this,"strokeWidth",void 0),r(this,"x",void 0),r(this,"y",void 0),r(this,"w",void 0),r(this,"h",void 0),r(this,"segment",void 0),r(this,"bounds",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),r(this,"cssClass",void 0),r(this,"hoverClass",void 0),r(this,"geometry",void 0),this.stub=i.stub||this.getDefaultStubs(),this.sourceStub=Array.isArray(this.stub)?this.stub[0]:this.stub,this.targetStub=Array.isArray(this.stub)?this.stub[1]:this.stub,this.gap=i.gap||0,this.sourceGap=Array.isArray(this.gap)?this.gap[0]:this.gap,this.targetGap=Array.isArray(this.gap)?this.gap[1]:this.gap,this.maxStub=Math.max(this.sourceStub,this.targetStub),this.cssClass=i.cssClass||"",this.hoverClass=i.hoverClass||""}return o(t,[{key:"getTypeDescriptor",value:function(){return"connector"}},{key:"getIdPrefix",value:function(){return"_jsplumb_connector"}},{key:"setGeometry",value:function(t,e){this.geometry=t,this.edited=null!=t&&!e}},{key:"exportGeometry",value:function(){return this.geometry}},{key:"importGeometry",value:function(t){return this.geometry=t,!0}},{key:"resetGeometry",value:function(){this.geometry=null,this.edited=!1}},{key:"transformAnchorPlacement",value:function(t,e,n){return{x:t.x,y:t.y,ox:t.ox,oy:t.oy,curX:t.curX+e,curY:t.curY+n}}},{key:"resetBounds",value:function(){this.bounds={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}}},{key:"findSegmentForPoint",value:function(t,e){for(var n={d:1/0,s:null,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null,index:null,connectorLocation:null},i=0;i<this.segments.length;i++){var o=this.segments[i].findClosestPointOnPath(t,e);o.d<n.d&&(n.d=o.d,n.l=o.l,n.x=o.x,n.y=o.y,n.s=this.segments[i],n.x1=o.x1,n.x2=o.x2,n.y1=o.y1,n.y2=o.y2,n.index=i,n.connectorLocation=this.segmentProportions[i][0]+o.l*(this.segmentProportions[i][1]-this.segmentProportions[i][0]))}return n}},{key:"lineIntersection",value:function(t,e,n,i){for(var o=[],r=0;r<this.segments.length;r++)o.push.apply(o,this.segments[r].lineIntersection(t,e,n,i));return o}},{key:"boxIntersection",value:function(t,e,n,i){for(var o=[],r=0;r<this.segments.length;r++)o.push.apply(o,this.segments[r].boxIntersection(t,e,n,i));return o}},{key:"boundingBoxIntersection",value:function(t){for(var e=[],n=0;n<this.segments.length;n++)e.push.apply(e,this.segments[n].boundingBoxIntersection(t));return e}},{key:"_updateSegmentProportions",value:function(){for(var t=0,e=0;e<this.segments.length;e++){var n=this.segments[e].getLength();this.segmentProportionalLengths[e]=n/this.totalLength,this.segmentProportions[e]=[t,t+=n/this.totalLength]}}},{key:"_findSegmentForLocation",value:function(t,e){var n,i,o;if(e&&(t=t>0?t/this.totalLength:(this.totalLength+t)/this.totalLength),1===t)n=this.segments.length-1,o=1;else if(0===t)o=0,n=0;else if(t>=.5){for(n=0,o=0,i=this.segmentProportions.length-1;i>-1;i--)if(this.segmentProportions[i][1]>=t&&this.segmentProportions[i][0]<=t){n=i,o=(t-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}}else for(n=this.segmentProportions.length-1,o=1,i=0;i<this.segmentProportions.length;i++)if(this.segmentProportions[i][1]>=t){n=i,o=(t-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}return{segment:this.segments[n],proportion:o,index:n}}},{key:"_addSegment",value:function(t,e){if(e.x1!==e.x2||e.y1!==e.y2){var n=new t(e);this.segments.push(n),this.totalLength+=n.getLength(),this.updateBounds(n)}}},{key:"_clearSegments",value:function(){this.totalLength=0,this.segments.length=0,this.segmentProportions.length=0,this.segmentProportionalLengths.length=0}},{key:"getLength",value:function(){return this.totalLength}},{key:"_prepareCompute",value:function(t){this.strokeWidth=t.strokeWidth;var e=t.sourcePos.curX,n=t.targetPos.curX,i=t.sourcePos.curY,o=t.targetPos.curY,r=Qi({x:e,y:i},{x:n,y:o}),s=n<e,a=o<i,l=[t.sourcePos.ox,t.sourcePos.oy],u=[t.targetPos.ox,t.targetPos.oy],c=s?n:e,h=a?o:i,d=Math.abs(n-e),p=Math.abs(o-i),f=0===l[0]&&0===l[1],v=0===u[0]&&0===u[1];if(f||v){var g=d>p?0:1,y=[1,0][g],m=0===g?e:i,_=0===g?n:o;f&&(l[g]=m>_?-1:1,l[y]=0),v&&(u[g]=m>_?1:-1,u[y]=0)}var E=s?d+this.sourceGap*l[0]:this.sourceGap*l[0],x=a?p+this.sourceGap*l[1]:this.sourceGap*l[1],b=s?this.targetGap*u[0]:d+this.targetGap*u[0],k=a?this.targetGap*u[1]:p+this.targetGap*u[1],C=l[0]*u[0]+l[1]*u[1],S={sx:E,sy:x,tx:b,ty:k,xSpan:Math.abs(b-E),ySpan:Math.abs(k-x),mx:(E+b)/2,my:(x+k)/2,so:l,to:u,x:c,y:h,w:d,h:p,segment:r,startStubX:E+l[0]*this.sourceStub,startStubY:x+l[1]*this.sourceStub,endStubX:b+u[0]*this.targetStub,endStubY:k+u[1]*this.targetStub,isXGreaterThanStubTimes2:Math.abs(E-b)>this.sourceStub+this.targetStub,isYGreaterThanStubTimes2:Math.abs(x-k)>this.sourceStub+this.targetStub,opposite:-1===C,perpendicular:0===C,orthogonal:1===C,sourceAxis:0===l[0]?"y":"x",points:[c,h,d,p,E,x,b,k],stubs:[this.sourceStub,this.targetStub]};return S.anchorOrientation=S.opposite?"opposite":S.orthogonal?"orthogonal":"perpendicular",S}},{key:"updateBounds",value:function(t){var e=t.extents;this.bounds.xmin=Math.min(this.bounds.xmin,e.xmin),this.bounds.xmax=Math.max(this.bounds.xmax,e.xmax),this.bounds.ymin=Math.min(this.bounds.ymin,e.ymin),this.bounds.ymax=Math.max(this.bounds.ymax,e.ymax)}},{key:"dumpSegmentsToConsole",value:function(){J("SEGMENTS:");for(var t=0;t<this.segments.length;t++)J(this.segments[t].type,""+this.segments[t].getLength(),""+this.segmentProportions[t])}},{key:"pointOnPath",value:function(t,e){var n=this._findSegmentForLocation(t,e);return n.segment&&n.segment.pointOnPath(n.proportion,!1)||{x:0,y:0}}},{key:"gradientAtPoint",value:function(t,e){var n=this._findSegmentForLocation(t,e);return n.segment&&n.segment.gradientAtPoint(n.proportion,!1)||0}},{key:"pointAlongPathFrom",value:function(t,e,n){var i=this._findSegmentForLocation(t,n);return i.segment&&i.segment.pointAlongPathFrom(i.proportion,e,!1)||{x:0,y:0}}},{key:"compute",value:function(t){this.paintInfo=this._prepareCompute(t),this._clearSegments(),this._compute(this.paintInfo,t),this.x=this.paintInfo.points[0],this.y=this.paintInfo.points[1],this.w=this.paintInfo.points[2],this.h=this.paintInfo.points[3],this.segment=this.paintInfo.segment,this._updateSegmentProportions()}},{key:"setAnchorOrientation",value:function(t,e){}}]),t}(),_s=function(t){s(i,t);var e=c(i);function i(t,o,s){var a;return n(this,i),(a=e.call(this,t,o,s)).instance=t,a.component=o,r(u(a),"width",void 0),r(u(a),"length",void 0),r(u(a),"foldback",void 0),r(u(a),"direction",void 0),r(u(a),"location",.5),r(u(a),"paintStyle",void 0),r(u(a),"type",i.type),r(u(a),"cachedDimensions",void 0),s=s||{},a.width=s.width||20,a.length=s.length||20,a.direction=(s.direction||1)<0?-1:1,a.foldback=s.foldback||.623,a.paintStyle=s.paintStyle||{strokeWidth:1},a.location=null==s.location?a.location:Array.isArray(s.location)?s.location[0]:s.location,a}return o(i,[{key:"draw",value:function(t,e,n){if(t instanceof ms){var i,o,r,s=t;if(this.location>1||this.location<0){var a=this.location<0?1:0;o=oo(i=s.pointAlongPathFrom(a,this.location,!1),s.pointAlongPathFrom(a,this.location-this.direction*this.length/2,!1),this.length)}else if(1===this.location){if(o=oo(i=s.pointOnPath(this.location),s.pointAlongPathFrom(this.location,-this.length),this.length),-1===this.direction){var l=o;o=i,i=l}}else if(0===this.location){if(i=oo(o=s.pointOnPath(this.location),s.pointAlongPathFrom(this.location,this.length),this.length),-1===this.direction){var u=o;o=i,i=u}}else o=oo(i=s.pointAlongPathFrom(this.location,this.direction*this.length/2),s.pointOnPath(this.location),this.length);var c={hxy:i,tail:r=ro(i,o,this.width),cxy:oo(i,o,this.foldback*this.length)},h=this.paintStyle.stroke||e.stroke,d=this.paintStyle.fill||e.stroke;return{component:t,d:c,"stroke-width":this.paintStyle.strokeWidth||e.strokeWidth,stroke:h,fill:d,xmin:Math.min(i.x,r[0].x,r[1].x),xmax:Math.max(i.x,r[0].x,r[1].x),ymin:Math.min(i.y,r[0].y,r[1].y),ymax:Math.max(i.y,r[0].y,r[1].y)}}}},{key:"updateFrom",value:function(t){}}]),i}(Wr);function Es(t){return t.type===_s.type}r(_s,"type","Arrow"),Kr.register(_s.type,_s);var xs=function(t){s(i,t);var e=c(i);function i(t,o,s){var a;return n(this,i),(a=e.call(this,t,o,s)).instance=t,r(u(a),"type",i.type),a.length=a.length/2,a.foldback=2,a}return i}(_s);function bs(t){return t.type===xs.type}r(xs,"type","Diamond"),Kr.register(xs.type,xs);var ks=function(t){s(i,t);var e=c(i);function i(t,o,s){var a;return n(this,i),(a=e.call(this,t,o,s)).instance=t,r(u(a),"type",i.type),a.foldback=1,a}return i}(_s);function Cs(t){return t.type===ks.type}r(ks,"type","PlainArrow"),Kr.register("PlainArrow",ks);var Ss=function(t){s(i,t);var e=c(i);function i(t,o,s){var a;return n(this,i),(a=e.call(this,t,o,s)).instance=t,a.component=o,r(u(a),"create",void 0),r(u(a),"type",i.type),a.create=s.create,a}return o(i,[{key:"updateFrom",value:function(t){}}]),i}(Wr);function Ps(t){return t.type===Ss.type}r(Ss,"type","Custom"),Kr.register(Ss.type,Ss);var Ts="allowNestedGroups",As="paintStyle",Ms="scope",ws=function(t){s(i,t);var e=c(i);function i(t,o){var s;return n(this,i),r(u(s=e.call(this,t,o)),"radius",void 0),r(u(s),"defaultOffset",void 0),r(u(s),"defaultInnerRadius",void 0),r(u(s),"type",i.type),o=o||{},s.radius=o.radius||5,s.defaultOffset=.5*s.radius,s.defaultInnerRadius=s.radius/3,s}return i}(er);r(ws,"type","Dot");var Ds={type:ws.type,cls:ws,compute:function(t,e,n,i){var o=e.curX-t.radius,r=e.curY-t.radius,s=2*t.radius,a=2*t.radius;if(i&&i.stroke){var l=i.strokeWidth||1;o-=l,r-=l,s+=2*l,a+=2*l}return t.x=o,t.y=r,t.w=s,t.h=a,[o,r,s,a,t.radius]},getParams:function(t){return{radius:t.radius}}},Os=function t(e,i){n(this,t),this.instance=e,this.el=i,r(this,"group",void 0)},Is=function(t){s(i,t);var e=c(i);function i(t,o,s){var a;n(this,i),(a=e.call(this,t,o)).instance=t,r(u(a),"children",[]),r(u(a),"collapsed",!1),r(u(a),"droppable",void 0),r(u(a),"enabled",void 0),r(u(a),"orphan",void 0),r(u(a),"constrain",void 0),r(u(a),"proxied",void 0),r(u(a),"ghost",void 0),r(u(a),"revert",void 0),r(u(a),"prune",void 0),r(u(a),"dropOverride",void 0),r(u(a),"anchor",void 0),r(u(a),"endpoint",void 0),r(u(a),"connections",{source:[],target:[],internal:[]}),r(u(a),"manager",void 0),r(u(a),"id",void 0),r(u(a),"elId",void 0);var l=a.el;return l._isJsPlumbGroup=!0,l._jsPlumbGroup=u(a),a.elId=t.getId(o),a.orphan=!0===s.orphan,a.revert=!0!==a.orphan&&!1!==s.revert,a.droppable=!1!==s.droppable,a.ghost=!0===s.ghost,a.enabled=!1!==s.enabled,a.prune=!0!==a.orphan&&!0===s.prune,a.constrain=a.ghost||!0===s.constrain,a.proxied=!1!==s.proxied,a.id=s.id||X(),a.dropOverride=!0===s.dropOverride,a.anchor=s.anchor,a.endpoint=s.endpoint,a.anchor=s.anchor,t.setAttribute(o,Lt,""),a}return o(i,[{key:"contentArea",get:function(){return this.instance.getGroupContentArea(this)}},{key:"overrideDrop",value:function(t,e){return this.dropOverride&&(this.revert||this.prune||this.orphan)}},{key:"getAnchor",value:function(t,e){return this.anchor||"Continuous"}},{key:"getEndpoint",value:function(t,e){return this.endpoint||{type:ws.type,options:{radius:10}}}},{key:"add",value:function(t,e){var n=this.instance.getGroupContentArea(this),i=t;if(null!=i._jsPlumbParentGroup){if(i._jsPlumbParentGroup===this)return;i._jsPlumbParentGroup.remove(t,!0,e,!1)}i._jsPlumbParentGroup=this,this.children.push(new Os(this.instance,t)),this.instance._appendElement(i,n),this.manager._updateConnectionsForGroup(this)}},{key:"resolveNode",value:function(t){return null==t?null:j(this.children,(function(e){return e.el===t}))}},{key:"remove",value:function(t,e,n,i,o){var r=this.resolveNode(t);null!=r&&this._doRemove(r,e,n,i,o)}},{key:"_doRemove",value:function(t,e,n,i,o){var r=t.el;if(delete r._jsPlumbParentGroup,R(this.children,(function(e){return e===t})),e)try{this.instance.getGroupContentArea(this).removeChild(r)}catch(t){J("Could not remove element from Group "+t)}if(!n){var s={group:this,el:r};o&&(s.targetGroup=o),this.instance.fire(ge,s)}i||this.manager._updateConnectionsForGroup(this)}},{key:"removeAll",value:function(t,e){for(var n=0,i=this.children.length;n<i;n++){var o=this.children[0];this._doRemove(o,t,e,!0),this.instance.unmanage(o.el,!0)}this.children.length=0,this.manager._updateConnectionsForGroup(this)}},{key:"orphanAll",value:function(){for(var t={},e=0;e<this.children.length;e++){var n=this.manager.orphan(this.children[e].el,!1);t[n.id]=n.pos}return this.children.length=0,t}},{key:"addGroup",value:function(t){if(this.instance.allowNestedGroups&&t!==this){if(this.instance.groupManager.isAncestor(this,t))return!1;null!=t.group&&t.group.removeGroup(t);var e=this.instance.getId(t.el);this.instance.getManagedElements()[e].group=this.elId;var n=this.instance.getOffsetRelativeToRoot(t.el),i=this.collapsed?this.instance.getOffsetRelativeToRoot(this.el):this.instance.getOffsetRelativeToRoot(this.instance.getGroupContentArea(this));t.el._jsPlumbParentGroup=this,this.children.push(t),this.instance._appendElementToGroup(this,t.el),t.group=this;var o={x:n.x-i.x,y:n.y-i.y};return this.instance.setPosition(t.el,o),this.instance.fire(_e,{parent:this,child:t}),!0}return!1}},{key:"removeGroup",value:function(t){if(t.group===this){var e=t.el,n=this.instance.getGroupContentArea(this);n===e.parentNode&&n.removeChild(t.el);var i=this.instance.getId(t.el),o=this.instance.getManagedElements()[i];o&&delete o.group,this.children=this.children.filter((function(e){return e.id!==t.id})),delete t.group,delete e._jsPlumbParentGroup,this.instance.fire(Ee,{parent:this,child:t})}}},{key:"getGroups",value:function(){return this.children.filter((function(t){return t.constructor===i}))}},{key:"getNodes",value:function(){return this.children.filter((function(t){return t.constructor===Os}))}},{key:"collapseParent",get:function(){var t=null;if(null==this.group)return null;for(var e=this.group;null!=e;)e.collapsed&&(t=e),e=e.group;return t}}]),i}(Os),js=function(){function t(e){var i=this;n(this,t),this.instance=e,r(this,"groupMap",{}),r(this,"_connectionSourceMap",{}),r(this,"_connectionTargetMap",{}),e.bind(oe,(function(t){var e=i.getGroupFor(t.source),n=i.getGroupFor(t.target);null!=e&&null!=n&&e===n?(i._connectionSourceMap[t.connection.id]=e,i._connectionTargetMap[t.connection.id]=e,U(e.connections.internal,t.connection)):(null!=e&&(t.target._jsPlumbGroup===e?U(e.connections.internal,t.connection):U(e.connections.source,t.connection),i._connectionSourceMap[t.connection.id]=e),null!=n&&(t.source._jsPlumbGroup===n?U(n.connections.internal,t.connection):U(n.connections.target,t.connection),i._connectionTargetMap[t.connection.id]=n))})),e.bind(ce,(function(t){i._cleanupDetachedConnection(t.connection)})),e.bind(se,(function(t){var e=t.originalEndpoint.element,n=i.getGroupFor(e),o=t.connection.endpoints[t.index].element,r=i.getGroupFor(o),s=0===t.index?i._connectionSourceMap:i._connectionTargetMap,a=0===t.index?i._connectionTargetMap:i._connectionSourceMap;null!=r?(s[t.connection.id]=r,t.connection.source===t.connection.target&&(a[t.connection.id]=r)):(delete s[t.connection.id],t.connection.source===t.connection.target&&delete a[t.connection.id]),null!=n&&i._updateConnectionsForGroup(n),null!=r&&i._updateConnectionsForGroup(r)}))}return o(t,[{key:"_cleanupDetachedConnection",value:function(t){t.proxies.length=0;var e,n=this._connectionSourceMap[t.id];null!=n&&(e=function(e){return e.id===t.id},R(n.connections.source,e),R(n.connections.target,e),R(n.connections.internal,e),delete this._connectionSourceMap[t.id]),null!=(n=this._connectionTargetMap[t.id])&&(e=function(e){return e.id===t.id},R(n.connections.source,e),R(n.connections.target,e),R(n.connections.internal,e),delete this._connectionTargetMap[t.id])}},{key:"addGroup",value:function(t){var e=t.el;if(null!=this.groupMap[t.id])throw new Error("cannot create Group ["+t.id+"]; a Group with that ID exists");if(null!=e._isJsPlumbGroup)throw new Error("cannot create Group ["+t.id+"]; the given element is already a Group");var n=new Is(this.instance,t.el,t);return this.groupMap[n.id]=n,t.collapsed&&this.collapseGroup(n),this.instance.manage(n.el),this.instance.addClass(n.el,te),n.manager=this,this._updateConnectionsForGroup(n),this.instance.fire(de,{group:n}),n}},{key:"getGroup",value:function(t){var e=t;if(_(t)&&null==(e=this.groupMap[t]))throw new Error("No such group ["+t+"]");return e}},{key:"getGroupFor",value:function(t){for(var e=t,n=this.instance.getContainer(),i=!1,o=null;!i;)null==e||e===n?i=!0:e._jsPlumbParentGroup?(o=e._jsPlumbParentGroup,i=!0):e=e.parentNode;return o}},{key:"getGroups",value:function(){var t=[];for(var e in this.groupMap)t.push(this.groupMap[e]);return t}},{key:"removeGroup",value:function(t,e,n,i){var o=this,r=this.getGroup(t);this.expandGroup(r,!0);var s={};return D(r.children,(function(t){var e=o.instance.getManagedElements()[o.instance.getId(t.el)];e&&delete e.group})),e?(D(r.getGroups(),(function(t){return o.removeGroup(t,e,n)})),r.removeAll(n,i)):(r.group&&D(r.children,(function(t){return r.group.add(t.el)})),s=r.orphanAll()),r.group&&r.group.removeGroup(r),this.instance.unmanage(r.el,!0),delete this.groupMap[r.id],this.instance.fire(ye,{group:r}),s}},{key:"removeAllGroups",value:function(t,e,n){for(var i in this.groupMap)this.removeGroup(this.groupMap[i],t,e,n)}},{key:"forEach",value:function(t){for(var e in this.groupMap)t(this.groupMap[e])}},{key:"orphan",value:function(t,e){var n=t;if(n._jsPlumbParentGroup){var i=n._jsPlumbParentGroup,o=this.instance.getId(n),r=this.instance.getOffset(t);return!0!==e&&i.group?this.instance._appendElementToGroup(i.group,t):this.instance._appendElementToContainer(t),this.instance.setPosition(t,r),delete n._jsPlumbParentGroup,{id:o,pos:r}}}},{key:"_updateConnectionsForGroup",value:function(t){var e=this;t.connections.source.length=0,t.connections.target.length=0,t.connections.internal.length=0;var n=t.children.slice().map((function(t){return t.el})),i=[];if(D(n,(function(t){Array.prototype.push.apply(i,e.instance.getSelector(t,Ae))})),Array.prototype.push.apply(n,i),n.length>0){var o,r,s=this.instance.getConnections({source:n,scope:yi},!0),a=this.instance.getConnections({target:n,scope:yi},!0),l={},u=function(n){for(var i=0;i<n.length;i++)l[n[i].id]||(l[n[i].id]=!0,o=e.getGroupFor(n[i].source),r=e.getGroupFor(n[i].target),n[i].source===t.el&&r===t||n[i].target===t.el&&o===t?t.connections.internal.push(n[i]):o===t?(r!==t?t.connections.source.push(n[i]):t.connections.internal.push(n[i]),e._connectionSourceMap[n[i].id]=t):r===t&&(t.connections.target.push(n[i]),e._connectionTargetMap[n[i].id]=t))};u(s),u(a)}}},{key:"_collapseConnection",value:function(t,e,n){var i=t.endpoints[0===e?1:0].element;if(i._jsPlumbParentGroup&&!i._jsPlumbParentGroup.proxied&&i._jsPlumbParentGroup.collapsed)return!1;var o=t.endpoints[0].element._jsPlumbParentGroup,r=null!=o?o.collapseParent||o:null,s=t.endpoints[1].element._jsPlumbParentGroup,a=null!=s?s.collapseParent||s:null;if(null==r||null==a||r.id!==a.id){var l=n.el;return this.instance.getId(l),this.instance.proxyConnection(t,e,l,(function(t,e){return n.getEndpoint(t,e)}),(function(t,e){return n.getAnchor(t,e)})),!0}return!1}},{key:"_expandConnection",value:function(t,e,n){this.instance.unproxyConnection(t,e)}},{key:"isElementDescendant",value:function(t,e){for(var n=this.instance.getContainer();;){if(null==t||t===n)return!1;if(t===e)return!0;t=t.parentNode}}},{key:"collapseGroup",value:function(t){var e=this,n=this.getGroup(t);if(null!=n&&!n.collapsed){var i=n.el;if(null==n.collapseParent){if(this.instance.setGroupVisible(n,!1),n.collapsed=!0,this.instance.removeClass(i,te),this.instance.addClass(i,$t),n.proxied){var o=new Set,r=function(t,i){for(var r=0;r<t.length;r++){var s=t[r];!0===e._collapseConnection(s,i,n)&&o.add(s.id)}};r(n.connections.source,0),r(n.connections.target,1),D(n.getGroups(),(function(t){e.cascadeCollapse(n,t,o)}))}this.instance.revalidate(i),this.repaintGroup(n),this.instance.fire(pe,{group:n})}else n.collapsed=!0,this.instance.removeClass(i,te),this.instance.addClass(i,$t)}}},{key:"cascadeCollapse",value:function(t,e,n){var i=this;if(t.proxied){var o=function(e,o){for(var r=0;r<e.length;r++){var s=e[r];n.has(s.id)||!0===i._collapseConnection(s,o,t)&&n.add(s.id)}};o(e.connections.source,0),o(e.connections.target,1)}D(e.getGroups(),(function(e){i.cascadeCollapse(t,e,n)}))}},{key:"expandGroup",value:function(t,e){var n=this,i=this.getGroup(t);if(null!=i){var o=i.el;if(null==i.collapseParent){if(this.instance.setGroupVisible(i,!0),i.collapsed=!1,this.instance.addClass(o,te),this.instance.removeClass(o,$t),i.proxied){var r=function(t,e){for(var o=0;o<t.length;o++){var r=t[o];n._expandConnection(r,e,i)}};r(i.connections.source,0),r(i.connections.target,1);D(i.getGroups(),(function t(e,i){if(i||e.collapsed){var o=function(t,i){for(var o=0;o<t.length;o++){var r=t[o];n._collapseConnection(r,i,e.collapseParent||e)}};o(e.connections.source,0),o(e.connections.target,1),D(e.connections.internal,(function(t){return t.setVisible(!1)})),D(e.getGroups(),(function(e){return t(e,!0)}))}else n.expandGroup(e,!0)}))}this.instance.revalidate(o),this.repaintGroup(i),e||this.instance.fire(fe,{group:i})}else i.collapsed=!1,this.instance.addClass(o,te),this.instance.removeClass(o,$t)}}},{key:"toggleGroup",value:function(t){null!=(t=this.getGroup(t))&&(t.collapsed?this.expandGroup(t):this.collapseGroup(t))}},{key:"repaintGroup",value:function(t){for(var e=this.getGroup(t).children,n=0;n<e.length;n++)this.instance.revalidate(e[n].el)}},{key:"addToGroup",value:function(t,e){var n=this,i=this.getGroup(t);if(i){for(var o=i.el,r=arguments.length,s=new Array(r>2?r-2:0),a=2;a<r;a++)s[a-2]=arguments[a];D(s,(function(t){var r=t,s=null!=r._isJsPlumbGroup,a=r._jsPlumbGroup,l=r._jsPlumbParentGroup;if(l!==i){var u=n.instance.manage(t),c=n.instance.getOffset(t),h=i.collapsed?n.instance.getOffsetRelativeToRoot(o):n.instance.getOffset(n.instance.getGroupContentArea(i));u.group=i.elId,null!=l&&(l.remove(t,!1,e,!1,i),n._updateConnectionsForGroup(l)),s?i.addGroup(a):i.add(t,e);var d=function(t,e){var o=0===e?1:0;t.each((function(t){t.setVisible(!1),t.endpoints[o].element._jsPlumbGroup===i?(t.endpoints[o].setVisible(!1),n._expandConnection(t,o,i)):(t.endpoints[e].setVisible(!1),n._collapseConnection(t,e,i))}))};i.collapsed&&(d(n.instance.select({source:t}),0),d(n.instance.select({target:t}),1)),n.instance.getId(t);var p={x:c.x-h.x,y:c.y-h.y};if(n.instance.setPosition(t,p),n._updateConnectionsForGroup(i),n.instance.revalidate(t),!e){var f={group:i,el:t,pos:p};l&&(f.sourceGroup=l),n.instance.fire(ve,f)}}}))}}},{key:"removeFromGroup",value:function(t,e){var n=this,i=this.getGroup(t);if(i){for(var o=arguments.length,r=new Array(o>2?o-2:0),s=2;s<o;s++)r[s-2]=arguments[s];D(r,(function(t){if(i.collapsed){var o=function(e,o){for(var r=0;r<e.length;r++){var s=e[r];if(s.proxies)for(var a=0;a<s.proxies.length;a++)if(null!=s.proxies[a]){var l=s.proxies[a].originalEp.element;(l===t||n.isElementDescendant(l,t))&&n._expandConnection(s,o,i)}}};o(i.connections.source.slice(),0),o(i.connections.target.slice(),1)}i.remove(t,null,e);var r=n.instance.getManagedElements()[n.instance.getId(t)];r&&delete r.group}))}}},{key:"getAncestors",value:function(t){for(var e=[],n=t.group;null!=n;)e.push(n),n=n.group;return e}},{key:"isAncestor",value:function(t,e){return null!=t&&null!=e&&-1!==this.getAncestors(t).indexOf(e)}},{key:"getDescendants",value:function(t){var e=[];return function t(n){var i=n.getGroups();e.push.apply(e,p(i)),D(i,t)}(t),e}},{key:"isDescendant",value:function(t,e){return null!=t&&null!=e&&-1!==this.getDescendants(e).indexOf(t)}},{key:"reset",value:function(){this._connectionSourceMap={},this._connectionTargetMap={},this.groupMap={}}}]),t}(),Ls=function(){function t(e,i){n(this,t),this.instance=e,this.entries=i}return o(t,[{key:"length",get:function(){return this.entries.length}},{key:"each",value:function(t){return D(this.entries,(function(e){return t(e)})),this}},{key:"get",value:function(t){return this.entries[t]}},{key:"addClass",value:function(t,e){return this.each((function(n){return n.addClass(t,e)})),this}},{key:"removeClass",value:function(t,e){return this.each((function(n){return n.removeClass(t,e)})),this}},{key:"removeAllOverlays",value:function(){return this.each((function(t){return t.removeAllOverlays()})),this}},{key:"setLabel",value:function(t){return this.each((function(e){return e.setLabel(t)})),this}},{key:"clear",value:function(){return this.entries.length=0,this}},{key:"map",value:function(t){var e=[];return this.each((function(n){return e.push(t(n))})),e}},{key:"addOverlay",value:function(t){return this.each((function(e){return e.addOverlay(t)})),this}},{key:"removeOverlay",value:function(t){return this.each((function(e){return e.removeOverlay(t)})),this}},{key:"removeOverlays",value:function(){return this.each((function(t){return t.removeOverlays()})),this}},{key:"showOverlay",value:function(t){return this.each((function(e){return e.showOverlay(t)})),this}},{key:"hideOverlay",value:function(t){return this.each((function(e){return e.hideOverlay(t)})),this}},{key:"setPaintStyle",value:function(t){return this.each((function(e){return e.setPaintStyle(t)})),this}},{key:"setHoverPaintStyle",value:function(t){return this.each((function(e){return e.setHoverPaintStyle(t)})),this}},{key:"setSuspendEvents",value:function(t){return this.each((function(e){return e.setSuspendEvents(t)})),this}},{key:"setParameter",value:function(t,e){return this.each((function(n){return n.parameters[t]=e})),this}},{key:"setParameters",value:function(t){return this.each((function(e){return e.parameters=t})),this}},{key:"setVisible",value:function(t){return this.each((function(e){return e.setVisible(t)})),this}},{key:"addType",value:function(t){return this.each((function(e){return e.addType(t)})),this}},{key:"toggleType",value:function(t){return this.each((function(e){return e.toggleType(t)})),this}},{key:"removeType",value:function(t){return this.each((function(e){return e.removeType(t)})),this}},{key:"bind",value:function(t,e){return this.each((function(n){return n.bind(t,e)})),this}},{key:"unbind",value:function(t,e){return this.each((function(n){return n.unbind(t,e)})),this}},{key:"setHover",value:function(t){var e=this;return this.each((function(n){return e.instance.setHover(n,t)})),this}}]),t}(),Ns=function(t){s(i,t);var e=c(i);function i(){return n(this,i),e.apply(this,arguments)}return o(i,[{key:"setEnabled",value:function(t){return this.each((function(e){return e.enabled=t})),this}},{key:"setAnchor",value:function(t){return this.each((function(e){return e.setAnchor(t)})),this}},{key:"deleteEveryConnection",value:function(){return this.each((function(t){return t.deleteEveryConnection()})),this}},{key:"deleteAll",value:function(){var t=this;return this.each((function(e){return t.instance.deleteEndpoint(e)})),this.clear(),this}}]),i}(Ls),Gs=function(t){s(i,t);var e=c(i);function i(){return n(this,i),e.apply(this,arguments)}return o(i,[{key:"setDetachable",value:function(t){return this.each((function(e){return e.setDetachable(t)})),this}},{key:"setReattach",value:function(t){return this.each((function(e){return e.setReattach(t)})),this}},{key:"setConnector",value:function(t){return this.each((function(e){return e._setConnector(t)})),this}},{key:"deleteAll",value:function(){var t=this;this.each((function(e){return t.instance.deleteConnection(e)})),this.clear()}},{key:"repaint",value:function(){var t=this;return this.each((function(e){return t.instance._paintConnection(e)})),this}}]),i}(Ls),Rs=function t(){n(this,t),r(this,"affectedElements",new Set)};function Fs(){return{x:0,y:0,w:0,h:0,r:0,c:{x:0,y:0},x2:0,y2:0,t:{x:0,y:0,c:{x:0,y:0},w:0,h:0,r:0,x2:0,y2:0,cr:0,sr:0},dirty:!0}}var Vs=function(t,e){var n=0;return e[1]>t[1]?n=-1:e[1]<t[1]&&(n=1),n},Hs=function(t,e){return-1*Vs(t,e)};function Us(t,e,n,i){nt([t,e],n,Vs,i)}function Bs(t,e){var n=O(e,(function(e){return e[0]===t}));n>-1&&e.splice(n,1)}var Ys,Xs=function(t){s(i,t);var e=c(i);function i(t){var o;return n(this,i),(o=e.call(this)).instance=t,r(u(o),"_currentTransaction",null),r(u(o),"_sortedElements",{xmin:[],xmax:[],ymin:[],ymax:[]}),r(u(o),"_elementMap",new Map),r(u(o),"_transformedElementMap",new Map),r(u(o),"_bounds",{minx:0,maxx:0,miny:0,maxy:0}),o}return o(i,[{key:"_updateBounds",value:function(t,e,n){null!=e&&(Bs(t,this._sortedElements.xmin),Bs(t,this._sortedElements.xmax),Bs(t,this._sortedElements.ymin),Bs(t,this._sortedElements.ymax),Us(t,e.t.x,this._sortedElements.xmin,!1),Us(t,e.t.x+e.t.w,this._sortedElements.xmax,!0),Us(t,e.t.y,this._sortedElements.ymin,!1),Us(t,e.t.y+e.t.h,this._sortedElements.ymax,!0),!0!==n&&this._recalculateBounds())}},{key:"_recalculateBounds",value:function(){this._bounds.minx=this._sortedElements.xmin.length>0?this._sortedElements.xmin[0][1]:0,this._bounds.maxx=this._sortedElements.xmax.length>0?this._sortedElements.xmax[0][1]:0,this._bounds.miny=this._sortedElements.ymin.length>0?this._sortedElements.ymin[0][1]:0,this._bounds.maxy=this._sortedElements.ymax.length>0?this._sortedElements.ymax[0][1]:0}},{key:"recomputeBounds",value:function(){var t=this;this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.forEach((function(e,n){t._sortedElements.xmin.push([n,e.t.x]),t._sortedElements.xmax.push([n,e.t.x+e.t.w]),t._sortedElements.ymin.push([n,e.t.y]),t._sortedElements.ymax.push([n,e.t.y+e.t.h])})),this._sortedElements.xmin.sort(Vs),this._sortedElements.ymin.sort(Vs),this._sortedElements.xmax.sort(Hs),this._sortedElements.ymax.sort(Hs),this._recalculateBounds()}},{key:"_finaliseUpdate",value:function(t,e,n){var i,o,r,s,a,l,u,c,h,d,p,f,v,g,y,m,_,E,x;e.t=(i=e.x,o=e.y,r=e.w,s=e.h,a=e.r,l=i+r/2,u=o+s/2,c=Math.cos(a/360*Math.PI*2),h=Math.sin(a/360*Math.PI*2),d=function(t,e){return{x:l+Math.round((t-l)*c-(e-u)*h),y:u+Math.round((e-u)*c-(t-l)*h)}},p=d(i,o),f=d(i+r,o),v=d(i+r,o+s),g=d(i,o+s),y=d(i+r/2,o+s/2),m=Math.min(p.x,f.x,v.x,g.x),_=Math.max(p.x,f.x,v.x,g.x),E=Math.min(p.y,f.y,v.y,g.y),x=Math.max(p.y,f.y,v.y,g.y),{x:m,y:E,w:_-m,h:x-E,c:y,r:a,x2:_,y2:x,cr:c,sr:h}),this._transformedElementMap.set(t,e.t),!0!==n&&this._updateBounds(t,e,n)}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"startTransaction",value:function(){if(null!=this._currentTransaction)throw new Error("Viewport: cannot start transaction; a transaction is currently active.");this._currentTransaction=new Rs}},{key:"endTransaction",value:function(){var t=this;null!=this._currentTransaction&&(this._currentTransaction.affectedElements.forEach((function(e){var n=t.getPosition(e);t._finaliseUpdate(e,n,!0)})),this.recomputeBounds(),this._currentTransaction=null)}},{key:"updateElements",value:function(t){var e=this;D(t,(function(t){return e.updateElement(t.id,t.x,t.y,t.width,t.height,t.rotation)}))}},{key:"updateElement",value:function(t,e,n,i,o,r,s){var a=tt(this._elementMap,t,Fs);return a.dirty=null==e&&null==a.x||null==n&&null==a.y||null==i&&null==a.w||null==o&&null==a.h,null!=e&&(a.x=e),null!=n&&(a.y=n),null!=i&&(a.w=i),null!=o&&(a.h=o),null!=r&&(a.r=r||0),a.c.x=a.x+a.w/2,a.c.y=a.y+a.h/2,a.x2=a.x+a.w,a.y2=a.y+a.h,null==this._currentTransaction?this._finaliseUpdate(t,a,s):this._currentTransaction.affectedElements.add(t),a}},{key:"refreshElement",value:function(t,e){var n=this.instance.getManagedElements(),i=n[t]?n[t].el:null;if(null!=i){var o=this.getSize(i),r=this.getOffset(i);return this.updateElement(t,r.x,r.y,o.w,o.h,null,e)}return null}},{key:"getSize",value:function(t){return this.instance.getSize(t)}},{key:"getOffset",value:function(t){return this.instance.getOffset(t)}},{key:"registerElement",value:function(t,e){return this.updateElement(t,0,0,0,0,0,e)}},{key:"addElement",value:function(t,e,n,i,o,r){return this.updateElement(t,e,n,i,o,r)}},{key:"rotateElement",value:function(t,e){var n=tt(this._elementMap,t,Fs);return n.r=e||0,this._finaliseUpdate(t,n),n}},{key:"getBoundsWidth",value:function(){return this._bounds.maxx-this._bounds.minx}},{key:"getBoundsHeight",value:function(){return this._bounds.maxy-this._bounds.miny}},{key:"getX",value:function(){return this._bounds.minx}},{key:"getY",value:function(){return this._bounds.miny}},{key:"setSize",value:function(t,e,n){if(this._elementMap.has(t))return this.updateElement(t,null,null,e,n,null)}},{key:"setPosition",value:function(t,e,n){if(this._elementMap.has(t))return this.updateElement(t,e,n,null,null,null)}},{key:"reset",value:function(){this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.clear(),this._transformedElementMap.clear(),this._recalculateBounds()}},{key:"remove",value:function(t){Bs(t,this._sortedElements.xmin),Bs(t,this._sortedElements.xmax),Bs(t,this._sortedElements.ymin),Bs(t,this._sortedElements.ymax),this._elementMap.delete(t),this._transformedElementMap.delete(t),this._recalculateBounds()}},{key:"getPosition",value:function(t){return this._elementMap.get(t)}},{key:"getElements",value:function(){return this._elementMap}},{key:"isEmpty",value:function(){return 0===this._elementMap.size}}]),i}(Yr);function zs(t,e){return e.theta-t.theta}function Ws(t,e){return(t.theta<0?-Math.PI-t.theta:Math.PI-t.theta)-(e.theta<0?-Math.PI-e.theta:Math.PI-e.theta)}var qs=(r(Ys={},nr,Ws),r(Ys,or,zs),r(Ys,rr,zs),r(Ys,ir,Ws),Ys);function Ks(t){return!0===t.isContinuous}function Zs(t){return!0===t.isContinuous}function Js(t){return t.locations.length>1}function Qs(t){return[t.currentLocation,t.locations[t.currentLocation]]}var $s=function(){function t(e){var i=this;n(this,t),this.instance=e,r(this,"anchorLists",new Map),r(this,"anchorLocations",new Map),e.bind(ce,(function(t){t.sourceEndpoint._anchor.isContinuous&&i._removeEndpointFromAnchorLists(t.sourceEndpoint),t.targetEndpoint._anchor.isContinuous&&i._removeEndpointFromAnchorLists(t.targetEndpoint)})),e.bind(ue,(function(t){i._removeEndpointFromAnchorLists(t)}))}return o(t,[{key:"getAnchorOrientation",value:function(t){var e=this.anchorLocations.get(t.id);return e?[e.ox,e.oy]:[0,0]}},{key:"_distance",value:function(t,e,n,i,o,r,s){var a=i.x+t.x*o.w,l=i.y+t.y*o.h,u=i.x+o.w/2,c=i.y+o.h/2;if(null!=r&&r.length>0){var h=this.instance._applyRotations([a,l,0,0],r);a=h.x,l=h.y}return Math.sqrt(Math.pow(e-a,2)+Math.pow(n-l,2))+Math.sqrt(Math.pow(u-a,2)+Math.pow(c-l,2))}},{key:"_anchorSelector",value:function(t,e,n,i,o,r,s){for(var a=n.x+i.w/2,l=n.y+i.h/2,u=-1,c=1/0,h=0;h<s.length;h++){var d=this._distance(s[h],a,l,t,e,o,r);d<c&&(u=h+0,c=d)}return[u,s[u]]}},{key:"_floatingAnchorCompute",value:function(t,e){var n=e.xy,i={curX:n.x+t.size.w/2,curY:n.y+t.size.h/2,x:0,y:0,ox:0,oy:0};return this._setComputedPosition(t,i)}},{key:"_setComputedPosition",value:function(t,e,n){return this.anchorLocations.set(t.id,e),t.computedPosition=e,n&&(t.timestamp=n),e}},{key:"_computeSingleLocation",value:function(t,e,n,i){var o,r=i.rotation,s={curX:e.x+t.x*n.w+t.offx,curY:e.y+t.y*n.h+t.offy,x:t.x,y:t.y,ox:0,oy:0};if(null!=r&&r.length>0){var a=[t.iox,t.ioy],l={x:s.curX,y:s.curY,cr:0,sr:0};D(r,(function(t){l=z(l,t.c,t.r);var e=[Math.round(a[0]*l.cr-a[1]*l.sr),Math.round(a[1]*l.cr+a[0]*l.sr)];a=e.slice()})),t.ox=a[0],t.oy=a[1],o={curX:l.x,curY:l.y,x:t.x,y:t.y,ox:a[0],oy:a[1]}}else t.ox=t.iox,t.oy=t.ioy,o=y({ox:t.iox,oy:t.ioy},s);return o}},{key:"_singleAnchorCompute",value:function(t,e){var n=e.xy,i=e.wh,o=e.timestamp,r=this.anchorLocations.get(t.id);if(null!=r&&o&&o===t.timestamp)return r;var s=d(Qs(t),2);s[0];var a=s[1];return r=this._computeSingleLocation(a,n,i,e),this._setComputedPosition(t,r,o)}},{key:"_defaultAnchorCompute",value:function(t,e){var n;if(1===t.locations.length)return this._singleAnchorCompute(t,e);var i=e.xy,o=e.wh,r=e.txy,s=e.twh,a=d(Qs(t),2),l=a[0],u=a[1];if(t.locked||null==r||null==s)n=this._computeSingleLocation(u,i,o,e);else{var c=d(this._anchorSelector(i,o,r,s,e.rotation,e.tRotation,t.locations),2),h=c[0],p=c[1];t.currentLocation=h,h!==l&&(t.cssClass=p.cls||t.cssClass,e.element._anchorLocationChanged(t)),n=this._computeSingleLocation(p,i,o,e)}return this._setComputedPosition(t,n,e.timestamp)}},{key:"_placeAnchors",value:function(t,e){var n=this,i=this.instance.viewport.getPosition(t),o=function(e,o,r,s,a,l){if(r.length>0)for(var u=r.sort(qs[e]),c=function(t,e,n,i,o){for(var r=n?t.w:t.h,s=n?t.h:t.w,a=[],l=r/(e.length+1),u=0;u<e.length;u++){var c=(u+1)*l,h=i*s;o&&(c=r-c);var d=n?c:h,p=t.x+d,f=d/t.w,v=n?h:c,g=t.y+v,y=v/t.h;if(0!==t.r&&null!=t.r){var m=z({x:p,y:g},t.c,t.r);p=m.x,g=m.y}a.push({x:p,y:g,xLoc:f,yLoc:y,c:e[u].c})}return a}(i,u,s,a,e===or||e===nr),h=0;h<c.length;h++){var d=c[h].c,p=d.endpoints[0].elementId===t?d.endpoints[0]:d.endpoints[1];n._setComputedPosition(p._anchor,{curX:c[h].x,curY:c[h].y,x:c[h].xLoc,y:c[h].yLoc,ox:l[0],oy:l[1]})}};o(rr,0,e.bottom,!0,1,[0,1]),o(nr,0,e.top,!0,0,[0,-1]),o(ir,0,e.left,!1,0,[-1,0]),o(or,0,e.right,!1,1,[1,0])}},{key:"_updateAnchorList",value:function(t,e,n,i,o,r,s,a,l,u,c){var h,d=i.endpoints[s],p=d.id,f=[1,0][s],v={theta:e,order:n,c:i,b:o,elId:r,epId:p},g=t[l],y=d._continuousAnchorEdge?t[d._continuousAnchorEdge]:null;if(y){var m=O(y,(function(t){return t.epId===p}));if(-1!==m){y.splice(m,1);for(var _=0;_<y.length;_++)!0!==(h=y[_].c).placeholder&&u.add(h),c.add(y[_].c.endpoints[s]),c.add(y[_].c.endpoints[f])}}for(var E=0;E<g.length;E++)!0!==(h=g[E].c).placeholder&&u.add(h),c.add(g[E].c.endpoints[s]),c.add(g[E].c.endpoints[f]);var x=a?0:g.length;g.splice(x,0,v),d._continuousAnchorEdge=l}},{key:"_removeEndpointFromAnchorLists",value:function(t){var e=this.anchorLists.get(t.elementId),n=0;!function(t,e){if(t){var i=function(t){return t.epId===e};R(t.top,i),R(t.left,i),R(t.bottom,i),R(t.right,i),n+=t.top.length,n+=t.left.length,n+=t.bottom.length,n+=t.right.length}}(e,t.id),0===n&&this.anchorLists.delete(t.elementId),this.anchorLocations.delete(t._anchor.id)}},{key:"computeAnchorLocation",value:function(t,e){var n;return n=Ks(t)?this.anchorLocations.get(t.id)||{curX:0,curY:0,x:0,y:0,ox:0,oy:0}:Zs(t)?this._floatingAnchorCompute(t,e):this._defaultAnchorCompute(t,e),t.timestamp=e.timestamp,n}},{key:"computePath",value:function(t,e){var n=this.instance.viewport.getPosition(t.sourceId),i=this.instance.viewport.getPosition(t.targetId),o=t.endpoints[0],r=t.endpoints[1],s=this.getEndpointLocation(o,{xy:n,wh:n,element:o,timestamp:e,rotation:this.instance._getRotations(t.sourceId)}),a=this.getEndpointLocation(r,{xy:i,wh:i,element:r,timestamp:e,rotation:this.instance._getRotations(t.targetId)});t.connector.resetBounds(),t.connector.compute({sourcePos:s,targetPos:a,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1],strokeWidth:t.paintStyleInUse.strokeWidth,sourceInfo:n,targetInfo:i})}},{key:"getEndpointLocation",value:function(t,e){e=e||{};var n=t._anchor,i=this.anchorLocations.get(n.id);return(null==i||null!=e.timestamp&&n.timestamp!==e.timestamp)&&(i=this.computeAnchorLocation(n,e),this._setComputedPosition(n,i,e.timestamp)),i}},{key:"getEndpointOrientation",value:function(t){return t._anchor?this.getAnchorOrientation(t._anchor):[0,0]}},{key:"setAnchorOrientation",value:function(t,e){var n=this.anchorLocations.get(t.id);null!=n&&(n.ox=e[0],n.oy=e[1])}},{key:"isDynamicAnchor",value:function(t){return!!t._anchor&&(!Ks(t._anchor)&&t._anchor.locations.length>1)}},{key:"isFloating",value:function(t){return!!t._anchor&&Zs(t._anchor)}},{key:"prepareAnchor",value:function(t){return Tr(t)}},{key:"redraw",value:function(t,e,n){var i=this,o=new Set,r=new Set,s=new Set;if(!this.instance._suspendDrawing){var a=this.instance.endpointsByElement[t]||[];e=e||X();for(var l,u,c={},h=0;h<a.length;h++)if(!1!==(u=a[h]).visible)if(r.add(u),l=u._anchor,0===u.connections.length)Ks(l)&&(this.anchorLists.has(t)||this.anchorLists.set(t,{top:[],right:[],bottom:[],left:[]}),this._updateAnchorList(this.anchorLists.get(t),-Math.PI/2,0,{endpoints:[u,u],placeholder:!0},!1,t,0,!1,dr(l),o,r),s.add(t));else for(var d=0;d<u.connections.length;d++){var p=u.connections[d],f=p.sourceId,v=p.targetId,g=Ks(p.endpoints[0]._anchor),y=Ks(p.endpoints[1]._anchor);if(g||y){var m=[f,(p.endpoints[0]._anchor.faces||[]).join("-"),v,(p.endpoints[1]._anchor.faces||[]).join("-")].join("-"),_=c[m],E=p.sourceId===t?1:0;g&&!this.anchorLists.has(f)&&this.anchorLists.set(f,{top:[],right:[],bottom:[],left:[]}),y&&!this.anchorLists.has(v)&&this.anchorLists.set(v,{top:[],right:[],bottom:[],left:[]});var x=this.instance.viewport.getPosition(v),b=this.instance.viewport.getPosition(f);if(v===f&&(g||y))this._updateAnchorList(this.anchorLists.get(f),-Math.PI/2,0,p,!1,v,0,!1,nr,o,r),this._updateAnchorList(this.anchorLists.get(v),-Math.PI/2,0,p,!1,f,1,!1,nr,o,r);else{var k=this.instance._getRotations(f),C=this.instance._getRotations(v);_||(_=this._calculateOrientation(f,v,b,x,p.endpoints[0]._anchor,p.endpoints[1]._anchor,k,C),c[m]=_),g&&this._updateAnchorList(this.anchorLists.get(f),_.theta,0,p,!1,v,0,!1,_.a[0],o,r),y&&this._updateAnchorList(this.anchorLists.get(v),_.theta2,-1,p,!0,f,1,!0,_.a[1],o,r)}g&&s.add(f),y&&s.add(v),o.add(p),(g&&0===E||y&&1===E)&&r.add(p.endpoints[E])}else{var S=u.connections[d].endpoints[p.sourceId===t?1:0];if(Js(S._anchor)){this.instance._paintEndpoint(S,{elementWithPrecedence:t,timestamp:e}),o.add(u.connections[d]);for(var P=0;P<S.connections.length;P++)S.connections[P]!==u.connections[d]&&o.add(S.connections[P])}else o.add(u.connections[d])}}s.forEach((function(t){i._placeAnchors(t,i.anchorLists.get(t))})),r.forEach((function(t){var n=i.instance.viewport.getPosition(t.elementId);i.instance._paintEndpoint(t,{timestamp:e,offset:n})})),o.forEach((function(t){i.instance._paintConnection(t,{timestamp:e})}))}return{c:o,e:r}}},{key:"reset",value:function(){this.anchorLocations.clear(),this.anchorLists.clear()}},{key:"setAnchor",value:function(t,e){null!=e&&(t._anchor=e)}},{key:"setConnectionAnchors",value:function(t,e){t.endpoints[0]._anchor=e[0],t.endpoints[1]._anchor=e[1]}},{key:"_calculateOrientation",value:function(t,e,n,i,o,s,a,l){var u=this;if(t===e)return{orientation:"identity",a:[nr,nr]};var c=Math.atan2(i.c.y-n.c.y,i.c.x-n.c.x),h=Math.atan2(n.c.y-i.c.y,n.c.x-i.c.x),d=[],p={};!function(t,e){for(var n=0;n<t.length;n++){var i;if(p[t[n]]=(r(i={},ir,{x:e[n][0].x,y:e[n][0].c.y}),r(i,or,{x:e[n][0].x+e[n][0].w,y:e[n][0].c.y}),r(i,nr,{x:e[n][0].c.x,y:e[n][0].y}),r(i,rr,{x:e[n][0].c.x,y:e[n][0].y+e[n][0].h}),i),null!=e[n][1]&&e[n][1].length>0)for(var o in p[t[n]])p[t[n]][o]=u.instance._applyRotationsXY(p[t[n]][o],e[n][1])}}([At,Mt],[[n,a],[i,l]]);for(var f=[nr,ir,or,rr],v=0;v<f.length;v++)for(var g=0;g<f.length;g++)d.push({source:f[v],target:f[g],dist:Ji(p.source[f[v]],p.target[f[g]])});d.sort((function(t,e){if(t.dist<e.dist)return-1;if(e.dist<t.dist)return 1;var n,i=(r(n={},ir,0),r(n,nr,1),r(n,or,2),r(n,rr,3),n),o=i[t.source],s=i[e.source],a=i[t.target],l=i[e.target];return o<s?-1:s<o?1:a<l?-1:l<a?1:0}));for(var y=d[0].source,m=d[0].target,_=0;_<d.length&&(y=Ks(o)&&o.locked?o.currentFace:!o.isContinuous||fr(o,d[_].source)?d[_].source:null,m=s.isContinuous&&s.locked?s.currentFace:!s.isContinuous||fr(s,d[_].target)?d[_].target:null,null==y||null==m);_++);return o.isContinuous&&this.setCurrentFace(o,y),s.isContinuous&&this.setCurrentFace(s,m),{a:[y,m],theta:c,theta2:h}}},{key:"setCurrentFace",value:function(t,e,n){t.currentFace=e,n&&null!=t.lockedFace&&(t.lockedFace=t.currentFace)}},{key:"lock",value:function(t){t.locked=!0,Ks(t)&&(t.lockedFace=t.currentFace)}},{key:"unlock",value:function(t){t.locked=!1,Ks(t)&&(t.lockedFace=null)}},{key:"selectAnchorLocation",value:function(t,e){var n=O(t.locations,(function(t){return t.x===e.x&&t.y===e.y}));return-1!==n&&(t.currentLocation=n,!0)}},{key:"lockCurrentAxis",value:function(t){null!=t.currentFace&&(t.lockedAxis=t.currentFace===ir||t.currentFace===or?sr:ar)}},{key:"unlockCurrentAxis",value:function(t){t.lockedAxis=null}},{key:"anchorsEqual",value:function(t,e){if(!t||!e)return!1;var n=t.locations[t.currentLocation],i=e.locations[e.currentLocation];return n.x===i.x&&n.y===i.y&&n.offx===i.offx&&n.offy===i.offy&&n.ox===i.ox&&n.oy===i.oy}}]),t}(),ta={},ea={get:function(t,e,n){var i=ta[e];if(i)return new i(t,n);throw{message:"jsPlumb: unknown connector type '"+e+"'"}},register:function(t,e){ta[t]=e}},na=function(t){s(i,t);var e=c(i);function i(t){var o;return n(this,i),r(u(o=e.call(this,t)),"length",void 0),r(u(o),"m",void 0),r(u(o),"m2",void 0),r(u(o),"type",i.segmentType),o._setCoordinates({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}),o}return o(i,[{key:"getPath",value:function(t){return(t?"M "+this.x1+" "+this.y1+" ":"")+"L "+this.x2+" "+this.y2}},{key:"_recalc",value:function(){this.length=Math.sqrt(Math.pow(this.x2-this.x1,2)+Math.pow(this.y2-this.y1,2)),this.m=Ki({x:this.x1,y:this.y1},{x:this.x2,y:this.y2}),this.m2=-1/this.m,this.extents={xmin:Math.min(this.x1,this.x2),ymin:Math.min(this.y1,this.y2),xmax:Math.max(this.x1,this.x2),ymax:Math.max(this.y1,this.y2)}}},{key:"getLength",value:function(){return this.length}},{key:"getGradient",value:function(){return this.m}},{key:"_setCoordinates",value:function(t){this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this._recalc()}},{key:"pointOnPath",value:function(t,e){if(0!==t||e){if(1!==t||e){var n=e?t>0?t:this.length+t:t*this.length;return oo({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},n)}return{x:this.x2,y:this.y2}}return{x:this.x1,y:this.y1}}},{key:"gradientAtPoint",value:function(t,e){return this.m}},{key:"pointAlongPathFrom",value:function(t,e,n){var i=this.pointOnPath(t,n),o=e<=0?{x:this.x1,y:this.y1}:{x:this.x2,y:this.y2};return e<=0&&Math.abs(e)>1&&(e*=-1),oo(i,o,e)}},{key:"within",value:function(t,e,n){return n>=Math.min(t,e)&&n<=Math.max(t,e)}},{key:"closest",value:function(t,e,n){return Math.abs(n-t)<Math.abs(n-e)?t:e}},{key:"findClosestPointOnPath",value:function(t,e){var n={d:1/0,x:null,y:null,l:null,x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};if(0===this.m)n.y=this.y1,n.x=this.within(this.x1,this.x2,t)?t:this.closest(this.x1,this.x2,t);else if(this.m===1/0||this.m===-1/0)n.x=this.x1,n.y=this.within(this.y1,this.y2,e)?e:this.closest(this.y1,this.y2,e);else{var i=this.y1-this.m*this.x1,o=(e-this.m2*t-i)/(this.m-this.m2),r=this.m*o+i;n.x=this.within(this.x1,this.x2,o)?o:this.closest(this.x1,this.x2,o),n.y=this.within(this.y1,this.y2,r)?r:this.closest(this.y1,this.y2,r)}var s=Ji({x:n.x,y:n.y},{x:this.x1,y:this.y1});return n.d=Ji({x:t,y:e},n),n.l=s/length,n}},{key:"_pointLiesBetween",value:function(t,e,n){return n>e?e<=t&&t<=n:e>=t&&t>=n}},{key:"lineIntersection",value:function(t,e,n,i){var o=Math.abs(Ki({x:t,y:e},{x:n,y:i})),r=Math.abs(this.m),s=r===1/0?this.x1:this.y1-r*this.x1,a=[],l=o===1/0?t:e-o*t;if(o!==r)if(o===1/0&&0===r)this._pointLiesBetween(t,this.x1,this.x2)&&this._pointLiesBetween(this.y1,e,i)&&a.push({x:t,y:this.y1});else if(0===o&&r===1/0)this._pointLiesBetween(e,this.y1,this.y2)&&this._pointLiesBetween(this.x1,t,n)&&a.push({x:this.x1,y:e});else{var u,c;o===1/0?(u=t,this._pointLiesBetween(u,this.x1,this.x2)&&(c=r*t+s,this._pointLiesBetween(c,e,i)&&a.push({x:u,y:c}))):0===o?(c=e,this._pointLiesBetween(c,this.y1,this.y2)&&(u=(e-s)/r,this._pointLiesBetween(u,t,n)&&a.push({x:u,y:c}))):(c=r*(u=(l-s)/(r-o))+s,this._pointLiesBetween(u,this.x1,this.x2)&&this._pointLiesBetween(c,this.y1,this.y2)&&a.push({x:u,y:c}))}return a}},{key:"boxIntersection",value:function(t,e,n,i){var o=[];return o.push.apply(o,this.lineIntersection(t,e,t+n,e)),o.push.apply(o,this.lineIntersection(t+n,e,t+n,e+i)),o.push.apply(o,this.lineIntersection(t+n,e+i,t,e+i)),o.push.apply(o,this.lineIntersection(t,e+i,t,e)),o}}]),i}(di);r(na,"segmentType","Straight");var ia=function(t){s(i,t);var e=c(i);function i(){var t;n(this,i);for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return r(u(t=e.call.apply(e,[this].concat(s))),"type",i.type),t}return o(i,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(t,e){this._addSegment(na,{x1:t.sx,y1:t.sy,x2:t.startStubX,y2:t.startStubY}),this._addSegment(na,{x1:t.startStubX,y1:t.startStubY,x2:t.endStubX,y2:t.endStubY}),this._addSegment(na,{x1:t.endStubX,y1:t.endStubY,x2:t.tx,y2:t.ty}),this.geometry={source:e.sourcePos,target:e.targetPos}}},{key:"transformGeometry",value:function(t,e,n){return{source:this.transformAnchorPlacement(t.source,e,n),target:this.transformAnchorPlacement(t.target,e,n)}}}]),i}(ms);function oa(t,e,n){var i=[],o=function(e){return _(e)?e:t.getId(e)};if(e)if("string"==typeof e){if("*"===e)return e;i.push(e)}else{var r;if(n)i=e;else if(null!=e.length)(r=i).push.apply(r,p(p(e).map(o)));else i.push(o(e))}return i}function ra(t,e,n){null!=e&&(e.connections.push(t),1===e.connections.length&&t.instance.addClass(t.source,t.instance.connectedClass)),null!=n&&(null!=e&&t.sourceId===t.targetId||(n.connections.push(t),1===n.connections.length&&t.instance.addClass(t.target,t.instance.connectedClass)))}function sa(t,e,n){if(null!=e){var i=e.connections.length;R(e.connections,(function(e){return t.id===e.id})),i>0&&0===e.connections.length&&t.instance.removeClass(t.source,t.instance.connectedClass)}if(null!=n){var o=n.connections.length;null!=e&&t.sourceId===t.targetId||R(n.connections,(function(e){return t.id===e.id})),o>0&&0===n.connections.length&&t.instance.removeClass(t.target,t.instance.connectedClass)}}r(ia,"type","Straight");var aa=function(e){s(a,e);var i=c(a);function a(e,o){var s;return n(this,a),(s=i.call(this))._instanceIndex=e,r(u(s),"defaults",void 0),r(u(s),"_initialDefaults",{}),r(u(s),"isConnectionBeingDragged",!1),r(u(s),"currentlyDragging",!1),r(u(s),"hoverSuspended",!1),r(u(s),"_suspendDrawing",!1),r(u(s),"_suspendedAt",null),r(u(s),"connectorClass",Bt),r(u(s),"connectorOutlineClass",Yt),r(u(s),"connectedClass",Xt),r(u(s),"endpointClass",zt),r(u(s),"endpointConnectedClass",Wt),r(u(s),"endpointFullClass",qt),r(u(s),"endpointFloatingClass",Kt),r(u(s),"endpointDropAllowedClass",Zt),r(u(s),"endpointDropForbiddenClass",Jt),r(u(s),"endpointAnchorClassPrefix",Qt),r(u(s),"overlayClass",ee),r(u(s),"connections",[]),r(u(s),"endpointsByElement",{}),r(u(s),"endpointsByUUID",new Map),r(u(s),"sourceSelectors",[]),r(u(s),"targetSelectors",[]),r(u(s),"allowNestedGroups",void 0),r(u(s),"_curIdStamp",1),r(u(s),"viewport",new Xs(u(s))),r(u(s),"router",void 0),r(u(s),"groupManager",void 0),r(u(s),"_connectionTypes",new Map),r(u(s),"_endpointTypes",new Map),r(u(s),"_container",void 0),r(u(s),"_managedElements",{}),r(u(s),"DEFAULT_SCOPE",void 0),r(u(s),"_zoom",1),s.defaults={anchor:t.AnchorLocations.Bottom,anchors:[null,null],connectionsDetachable:!0,connectionOverlays:[],connector:ia.type,container:null,endpoint:ws.type,endpointOverlays:[],endpoints:[null,null],endpointStyle:{fill:"#456"},endpointStyles:[null,null],endpointHoverStyle:null,endpointHoverStyles:[null,null],hoverPaintStyle:null,listStyle:{},maxConnections:1,paintStyle:{strokeWidth:2,stroke:"#456"},reattachConnections:!1,scope:"jsplumb_defaultscope",allowNestedGroups:!0},o&&y(s.defaults,o),y(s._initialDefaults,s.defaults),null!=s._initialDefaults[As]&&(s._initialDefaults[As].strokeWidth=s._initialDefaults[As].strokeWidth||2),s.DEFAULT_SCOPE=s.defaults[Ms],s.allowNestedGroups=!1!==s._initialDefaults[Ts],s.router=new $s(u(s)),s.groupManager=new js(u(s)),s.setContainer(s._initialDefaults.container),s}return o(a,[{key:"defaultScope",get:function(){return this.DEFAULT_SCOPE}},{key:"currentZoom",get:function(){return this._zoom}},{key:"areDefaultAnchorsSet",value:function(){return this.validAnchorsSpec(this.defaults.anchors)}},{key:"validAnchorsSpec",value:function(t){return null!=t&&null!=t[0]&&null!=t[1]}},{key:"getContainer",value:function(){return this._container}},{key:"setZoom",value:function(t,e){return this._zoom=t,this.fire(be,this._zoom),e&&this.repaintEverything(),!0}},{key:"_idstamp",value:function(){return""+this._curIdStamp++}},{key:"checkCondition",value:function(t,e){var n=this.getListener(t),i=!0;if(n&&n.length>0){var o=Array.prototype.slice.call(arguments,1);try{for(var r=0,s=n.length;r<s;r++)i=i&&n[r].apply(n[r],o)}catch(e){J("cannot check condition ["+t+"]"+e)}}return i}},{key:"getId",value:function(t,e){if(null==t)return null;var n=this.getAttribute(t,Nt);return n&&"undefined"!==n||(2===arguments.length&&void 0!==arguments[1]?n=e:(1===arguments.length||3===arguments.length&&!arguments[2])&&(n="jsplumb-"+this._instanceIndex+"-"+this._idstamp()),this.setAttribute(t,Nt,n)),n}},{key:"getConnections",value:function(t,e){t?t.constructor===String&&(t={scope:t}):t={};for(var n=oa(this,t.scope||this.defaultScope,!0),i=oa(this,t.source),o=oa(this,t.target),r=!e&&n.length>1?{}:[],s=function(t,i){if(!e&&n.length>1){var o=r[t];null==o&&(o=r[t]=[]),o.push(i)}else r.push(i)},a=0,l=this.connections.length;a<l;a++){var u=this.connections[a],c=u.proxies&&u.proxies[0]?u.proxies[0].originalEp.elementId:u.sourceId,h=u.proxies&&u.proxies[1]?u.proxies[1].originalEp.elementId:u.targetId;g(n,u.scope)&&g(i,c)&&g(o,h)&&s(u.scope,u)}return r}},{key:"select",value:function(t){return(t=t||{}).scope=t.scope||"*",new Gs(this,t.connections||this.getConnections(t,!0))}},{key:"selectEndpoints",value:function(t){(t=t||{}).scope=t.scope||yi;var e=!t.element&&!t.source&&!t.target,n=e?yi:oa(this,t.element),i=e?yi:oa(this,t.source),o=e?yi:oa(this,t.target),r=oa(this,t.scope,!0),s=[];for(var a in this.endpointsByElement){var l=g(n,a,!0),u=g(i,a,!0),c="*"!==i,h=g(o,a,!0),d="*"!==o;if(l||u||h)t:for(var p=0,f=this.endpointsByElement[a].length;p<f;p++){var v=this.endpointsByElement[a][p];if(g(r,v.scope,!0)){var y=c&&i.length>0&&!v.isSource,m=d&&o.length>0&&!v.isTarget;if(y||m)continue t;s.push(v)}}}return new Ns(this,s)}},{key:"setContainer",value:function(t){this._container=t,this.fire(ae,this._container)}},{key:"_set",value:function(t,e,n){var i,o,r=[{el:"source",elId:"sourceId"},{el:"target",elId:"targetId"}][n],s=t[r.elId],a=t.endpoints[n],l={index:n,originalEndpoint:a,originalSourceId:0===n?s:t.sourceId,newSourceId:t.sourceId,originalTargetId:1===n?s:t.targetId,newTargetId:t.targetId,connection:t,newEndpoint:a};return e instanceof us?(i=e).addConnection(t):i=(o=this.getId(e))===t[r.elId]?null:t.makeEndpoint(0===n,e,o),null!=i&&(l.newEndpoint=i,a.detachFromConnection(t),t.endpoints[n]=i,t[r.el]=i.element,t[r.elId]=i.elementId,l[0===n?"newSourceId":"newTargetId"]=i.elementId,this.fireMoveEvent(l),this._paintConnection(t)),l}},{key:"setSource",value:function(t,e){sa(t,this._managedElements[t.sourceId]);var n=this._set(t,e,0);ra(t,this._managedElements[n.newSourceId])}},{key:"setTarget",value:function(t,e){sa(t,this._managedElements[t.targetId]);var n=this._set(t,e,1);ra(t,this._managedElements[n.newTargetId])}},{key:"setConnectionType",value:function(t,e,n){t.setType(e,n),this._paintConnection(t)}},{key:"isHoverSuspended",value:function(){return this.hoverSuspended}},{key:"setSuspendDrawing",value:function(t,e){var n=this._suspendDrawing;return this._suspendDrawing=t,t?this._suspendedAt=""+(new Date).getTime():(this._suspendedAt=null,this.viewport.recomputeBounds()),e&&this.repaintEverything(),n}},{key:"getSuspendedAt",value:function(){return this._suspendedAt}},{key:"batch",value:function(t,e){var n=!0===this._suspendDrawing;n||this.setSuspendDrawing(!0),t(),n||this.setSuspendDrawing(!1,!e)}},{key:"each",value:function(t,e){if(null!=t){if(null!=t.length)for(var n=0;n<t.length;n++)e(t[n]);else e(t);return this}}},{key:"updateOffset",value:function(t){var e=t.elId;return t.recalc?this.viewport.refreshElement(e):this.viewport.getPosition(e)}},{key:"deleteConnection",value:function(t,e){if(null!=t&&!0!==t.deleted&&((e=e||{}).force||M(!0,!1,[[t.endpoints[0],ke,[t]],[t.endpoints[1],ke,[t]],[t,ke,[t]],[this,Ht,[Pe,t]]]))){sa(t,this._managedElements[t.sourceId],this._managedElements[t.targetId]),this.fireDetachEvent(t,!t.pending&&!1!==e.fireEvent,e.originalEvent);var n=t.endpoints[0],i=t.endpoints[1];return n!==e.endpointToIgnore&&n.detachFromConnection(t,null,!0),i!==e.endpointToIgnore&&i.detachFromConnection(t,null,!0),R(this.connections,(function(e){return t.id===e.id})),t.destroy(),n!==e.endpointToIgnore&&n.deleteOnEmpty&&0===n.connections.length&&this.deleteEndpoint(n),i!==e.endpointToIgnore&&i.deleteOnEmpty&&0===i.connections.length&&this.deleteEndpoint(i),!0}return!1}},{key:"deleteEveryConnection",value:function(t){var e=this;t=t||{};var n=this.connections.length,i=0;return this.batch((function(){for(var o=0;o<n;o++)i+=e.deleteConnection(e.connections[0],t)?1:0})),i}},{key:"deleteConnectionsForElement",value:function(t,e){var n=this.getId(t),i=this._managedElements[n];if(i)for(var o=i.connections.length,r=0;r<o;r++)this.deleteConnection(i.connections[0],e);return this}},{key:"fireDetachEvent",value:function(t,e,n){var i=null!=t.id?{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]}:t;e&&this.fire(re,i,n),this.fire(ce,i,n)}},{key:"fireMoveEvent",value:function(t,e){this.fire(se,t,e)}},{key:"manageAll",value:function(t,e){for(var n=_(t)?this.getSelector(this.getContainer(),t):t,i=0;i<n.length;i++)this.manage(n[i],null,e)}},{key:"manage",value:function(t,e,n){null==this.getAttribute(t,Nt)&&(e=e||this.getAttribute(t,"id")||X(),this.setAttribute(t,Nt,e));var i=this.getId(t);if(this._managedElements[i])n&&(this._managedElements[i].viewportElement=this.updateOffset({elId:i,timestamp:null,recalc:!0}));else{var o={el:t,endpoints:[],connections:[],rotation:0,data:{}};this._managedElements[i]=o,this._suspendDrawing?o.viewportElement=this.viewport.registerElement(i,!0):o.viewportElement=this.updateOffset({elId:i,recalc:!0}),this.fire(he,{el:t})}return this._managedElements[i]}},{key:"getManagedData",value:function(t,e,n){if(this._managedElements[t]){var i=this._managedElements[t].data[e];return null!=i?i[n]:null}}},{key:"setManagedData",value:function(t,e,n,i){this._managedElements[t]&&(this._managedElements[t].data[e]=this._managedElements[t].data[e]||{},this._managedElements[t].data[e][n]=i)}},{key:"getManagedElement",value:function(t){return this._managedElements[t]?this._managedElements[t].el:null}},{key:"unmanage",value:function(t,e){var n=this;this.removeAllEndpoints(t,!0);var i=function(t){var i=n.getId(t);n.removeAttribute(t,Nt),delete n._managedElements[i],n.viewport.remove(i),n.fire(xe,{el:t,id:i}),t&&e&&n._removeElement(t)};this._getAssociatedElements(t).map(i),i(t)}},{key:"rotate",value:function(t,e,n){var i=this.getId(t);return this._managedElements[i]&&(this._managedElements[i].rotation=e,this.viewport.rotateElement(i,e),!0!==n)?this.revalidate(t):{c:new Set,e:new Set}}},{key:"_getRotation",value:function(t){var e=this._managedElements[t];return null!=e&&e.rotation||0}},{key:"_getRotations",value:function(t){var e=this,n=[],i=this._managedElements[t];return null!=i&&(n.push({r:i.viewportElement.r||0,c:i.viewportElement.c}),function t(i){if(null!=i.group){var o=e._managedElements[i.group];null!=o&&(n.push({r:o.viewportElement.r,c:o.viewportElement.c}),t(o))}}(i)),n}},{key:"_applyRotations",value:function(t,e){var n=t.slice(),i={x:n[0],y:n[1],cr:0,sr:0};return D(e,(function(t){i=z(i,t.c,t.r)})),i}},{key:"_applyRotationsXY",value:function(t,e){return D(e,(function(e){t=z(t,e.c,e.r)})),t}},{key:"_internal_newEndpoint",value:function(t){var e=y({},t),n=this.manage(e.element);e.elementId=this.getId(e.element),e.id="ep_"+this._idstamp();var i=new us(this,e);return function(t,e){null!=t&&t.endpoints.push(e)}(n,i),t.uuid&&this.endpointsByUUID.set(t.uuid,i),H(this.endpointsByElement,i.elementId,i),this._suspendDrawing||this._paintEndpoint(i,{timestamp:this._suspendedAt}),i}},{key:"_deriveEndpointAndAnchorSpec",value:function(t,e){for(var n=((e?"":"default ")+t).split(/[\s]/),i=null,o=null,r=null,s=null,a=0;a<n.length;a++){var l=this.getConnectionType(n[a]);l&&(l.endpoints&&(i=l.endpoints),l.endpoint&&(o=l.endpoint),l.anchors&&(s=l.anchors),l.anchor&&(r=l.anchor))}return{endpoints:i||[o,o],anchors:s||[r,r]}}},{key:"revalidate",value:function(t,e){var n=this.getId(t);return this.updateOffset({elId:n,recalc:!0,timestamp:e}),this.repaint(t)}},{key:"repaintEverything",value:function(){var t,e=X();for(t in this._managedElements)this.viewport.refreshElement(t,!0);for(t in this.viewport.recomputeBounds(),this._managedElements)this.repaint(this._managedElements[t].el,e,!0);return this}},{key:"setElementPosition",value:function(t,e,n){var i=this.getId(t);return this.viewport.setPosition(i,e,n),this.repaint(t)}},{key:"repaint",value:function(t,e,n){var i={c:new Set,e:new Set},o=function(t){t.c.forEach((function(t){return i.c.add(t)})),t.e.forEach((function(t){return i.e.add(t)}))};if(!this._suspendDrawing){var r=this.getId(t);if(null!=t){var s=this._getAssociatedElements(t);if(null==e&&(e=X()),!n)for(var a=0;a<s.length;a++)this.updateOffset({elId:this.getId(s[a]),recalc:!0,timestamp:e});if(o(this.router.redraw(r,e,null)),s.length>0)for(var l=0;l<s.length;l++)o(this.router.redraw(this.getId(s[l]),e,null))}}return i}},{key:"unregisterEndpoint",value:function(t){var e=t.getUuid();e&&this.endpointsByUUID.delete(e),function(t,e){null!=t&&R(t.endpoints,(function(t){return t===e}))}(this._managedElements[t.elementId],t);var n=this.endpointsByElement[t.elementId];null!=n&&(this.endpointsByElement[t.elementId]=n.filter((function(e){return e!==t}))),this.fire(ue,t)}},{key:"_maybePruneEndpoint",value:function(t){return!(!t.deleteOnEmpty||0!==t.connections.length)&&(this.deleteEndpoint(t),!0)}},{key:"deleteEndpoint",value:function(t){var e=this,n="string"==typeof t?this.endpointsByUUID.get(t):t;if(n){var i=n.proxiedBy,o=n.connections.slice();D(o,(function(t){n.detachFromConnection(t,null,!0)})),this.unregisterEndpoint(n),n.destroy(),D(o,(function(t){e.deleteConnection(t,{force:!0,endpointToIgnore:n})})),null!=i&&this.deleteEndpoint(i)}return this}},{key:"addEndpoint",value:function(t,e,n){var i=y({},n=n||{});y(i,e||{});var o=y({element:t},i);return this._internal_newEndpoint(o)}},{key:"addEndpoints",value:function(t,e,n){for(var i=[],o=0,r=e.length;o<r;o++)i.push(this.addEndpoint(t,e[o],n));return i}},{key:"reset",value:function(){var t=this;this.silently((function(){t.endpointsByElement={},t._managedElements={},t.endpointsByUUID.clear(),t.viewport.reset(),t.router.reset(),t.groupManager.reset(),t.connections.length=0}))}},{key:"destroy",value:function(){this.reset(),this.unbind(),this.sourceSelectors.length=0,this.targetSelectors.length=0,this._connectionTypes.clear(),this._endpointTypes.clear()}},{key:"getEndpoints",value:function(t){return this.endpointsByElement[this.getId(t)]||[]}},{key:"getEndpoint",value:function(t){return this.endpointsByUUID.get(t)}},{key:"setEndpointUuid",value:function(t,e){t.uuid&&this.endpointsByUUID.delete(t.uuid),t.uuid=e,this.endpointsByUUID.set(e,t)}},{key:"connect",value:function(t,e){try{var n=this._prepareConnectionParams(t,e),i=this._newConnection(n);return this._finaliseConnection(i,n),i}catch(t){return void J(t)}}},{key:"_prepareConnectionParams",value:function(t,e){var n=y({},t);e&&y(n,e);var i=n;if(i.source&&i.source.endpoint&&(i.sourceEndpoint=i.source),i.target&&i.target.endpoint&&(i.targetEndpoint=i.target),t.uuids&&(i.sourceEndpoint=this.getEndpoint(t.uuids[0]),i.targetEndpoint=this.getEndpoint(t.uuids[1])),null!=i.sourceEndpoint){if(i.sourceEndpoint.isFull())throw Me;if(i.type||(i.type=i.sourceEndpoint.edgeType),i.sourceEndpoint.connectorOverlays){i.overlays=i.overlays||[];for(var o=0,r=i.sourceEndpoint.connectorOverlays.length;o<r;o++)i.overlays.push(i.sourceEndpoint.connectorOverlays[o])}i.sourceEndpoint.scope&&(i.scope=i.sourceEndpoint.scope)}else if(null==i.source)throw De;if(null!=i.targetEndpoint){if(i.targetEndpoint.isFull())throw we}else if(null==i.target)throw Oe;if(i.sourceEndpoint&&i.targetEndpoint&&!function(t,e){for(var n=t.scope.split(/\s/),i=e.scope.split(/\s/),o=0;o<n.length;o++)for(var r=0;r<i.length;r++)if(i[r]===n[o])return!0;return!1}(i.sourceEndpoint,i.targetEndpoint))throw"Cannot establish connection: scopes do not match";return i}},{key:"_newConnection",value:function(t){t.id="con_"+this._idstamp();var e=new ps(this,t);return ra(e,this._managedElements[e.sourceId],this._managedElements[e.targetId]),this._paintConnection(e),e}},{key:"_finaliseConnection",value:function(t,e,n){e=e||{},t.suspendedEndpoint||this.connections.push(t),t.pending=null,t.endpoints[0].isTemporarySource=!1,this.repaint(t.source);var i={connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]};this.fire(oe,i,n),e.doNotFireConnectionEvent||!1===e.fireEvent||this.fire(ie,i,n)}},{key:"removeAllEndpoints",value:function(t,e){var n=this,i=function(t){var e,i,o=n.getId(t),r=n.endpointsByElement[o];if(r)for(e=0,i=r.length;e<i;e++)n.deleteEndpoint(r[e]);delete n.endpointsByElement[o]};return e&&this._getAssociatedElements(t).map(i),i(t),this}},{key:"_createSourceDefinition",value:function(t,e){var n=y({},e);y(n,t),n.edgeType=n.edgeType||fi;var i=this._deriveEndpointAndAnchorSpec(n.edgeType);n.endpoint=n.endpoint||i.endpoints[0],n.anchor=n.anchor||i.anchors[0];var o=n.maxConnections||-1;return{def:y({},n),uniqueEndpoint:n.uniqueEndpoint,maxConnections:o,enabled:!0,endpoint:null}}},{key:"addSourceSelector",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._createSourceDefinition(e),o=new Ir(t,i,n);return this.sourceSelectors.push(o),o}},{key:"removeSourceSelector",value:function(t){R(this.sourceSelectors,(function(e){return e===t}))}},{key:"removeTargetSelector",value:function(t){R(this.targetSelectors,(function(e){return e===t}))}},{key:"addTargetSelector",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._createTargetDefinition(e),o=new Ir(t,i,n);return this.targetSelectors.push(o),o}},{key:"_createTargetDefinition",value:function(t,e){var n=y({},e);y(n,t),n.edgeType=n.edgeType||fi;var i=n.maxConnections||-1;return{def:y({},n),uniqueEndpoint:n.uniqueEndpoint,maxConnections:i,enabled:!0,endpoint:null}}},{key:"show",value:function(t,e){return this._setVisible(t,wt,e)}},{key:"hide",value:function(t,e){return this._setVisible(t,Dt,e)}},{key:"_setVisible",value:function(t,e,n){var i=e===wt,o=null;n&&(o=function(t){t.setVisible(i,!0,!0)});var r=this.getId(t);return this._operation(t,(function(t){if(i&&n){var e=t.sourceId===r?1:0;t.endpoints[e].isVisible()&&t.setVisible(!0)}else t.setVisible(i)}),o),this}},{key:"toggleVisible",value:function(t,e){var n=null;e&&(n=function(t){var e=t.isVisible();t.setVisible(!e)}),this._operation(t,(function(t){var e=t.isVisible();t.setVisible(!e)}),n)}},{key:"_operation",value:function(t,e,n){var i=this.getId(t),o=this.endpointsByElement[i];if(o&&o.length)for(var r=0,s=o.length;r<s;r++){for(var a=0,l=o[r].connections.length;a<l;a++){if(e(o[r].connections[a]))return}n&&n(o[r])}}},{key:"registerConnectionType",value:function(t,e){if(this._connectionTypes.set(t,y({},e)),e.overlays){for(var n={},i=0;i<e.overlays.length;i++){var o=zr(e.overlays[i]);n[o.options.id]=o}this._connectionTypes.get(t).overlays=n}}},{key:"registerConnectionTypes",value:function(t){for(var e in t)this.registerConnectionType(e,t[e])}},{key:"registerEndpointType",value:function(t,e){if(this._endpointTypes.set(t,y({},e)),e.overlays){for(var n={},i=0;i<e.overlays.length;i++){var o=zr(e.overlays[i]);n[o.options.id]=o}this._endpointTypes.get(t).overlays=n}}},{key:"registerEndpointTypes",value:function(t){for(var e in t)this.registerEndpointType(e,t[e])}},{key:"getType",value:function(t,e){return"connection"===e?this.getConnectionType(t):this.getEndpointType(t)}},{key:"getConnectionType",value:function(t){return this._connectionTypes.get(t)}},{key:"getEndpointType",value:function(t){return this._endpointTypes.get(t)}},{key:"importDefaults",value:function(t){for(var e in t)this.defaults[e]=t[e];return null!=this.defaults[As]&&(this.defaults[As].strokeWidth=this.defaults[As].strokeWidth||2),t.container&&this.setContainer(t.container),this}},{key:"restoreDefaults",value:function(){return this.defaults=y({},this._initialDefaults),this}},{key:"getManagedElements",value:function(){return this._managedElements}},{key:"proxyConnection",value:function(t,e,n,i,o){var r,s=null!=t.proxies[e],a=s?t.proxies[e].originalEp.elementId:t.endpoints[e].elementId,l=s?t.proxies[e].originalEp:t.endpoints[e],u=this.getId(n);t.proxies[e]?t.proxies[e].ep.elementId===u?r=t.proxies[e].ep:(t.proxies[e].ep.detachFromConnection(t,e),r=this._internal_newEndpoint({element:n,endpoint:i(t,e),anchor:o(t,e),parameters:{isProxyEndpoint:!0}})):r=this._internal_newEndpoint({element:n,endpoint:i(t,e),anchor:o(t,e),parameters:{isProxyEndpoint:!0}}),r.deleteOnEmpty=!0,t.proxies[e]={ep:r,originalEp:l},this.sourceOrTargetChanged(a,u,t,n,e),l.detachFromConnection(t,null,!0),r.connections=[t],t.endpoints[e]=r,l.proxiedBy=r,l.setVisible(!1),t.setVisible(!0),this.revalidate(n)}},{key:"unproxyConnection",value:function(t,e){if(null!=t.proxies&&null!=t.proxies[e]){var n=t.proxies[e].originalEp.element,i=t.proxies[e].originalEp.elementId,o=t.proxies[e].ep.elementId;t.endpoints[e]=t.proxies[e].originalEp,delete t.proxies[e].originalEp.proxiedBy,this.sourceOrTargetChanged(o,i,t,n,e),t.proxies[e].ep.detachFromConnection(t,null),t.proxies[e].originalEp.addConnection(t),t.isVisible()&&t.proxies[e].originalEp.setVisible(!0),t.proxies[e]=null,-1===O(t.proxies,(function(t){return null!=t}))&&(t.proxies.length=0)}}},{key:"sourceOrTargetChanged",value:function(t,e,n,i,o){t!==e&&(0===o?(n.sourceId=e,n.source=i):1===o&&(n.targetId=e,n.target=i),sa(n,this._managedElements[t]),ra(n,this._managedElements[e]))}},{key:"getGroup",value:function(t){return this.groupManager.getGroup(t)}},{key:"getGroupFor",value:function(t){return this.groupManager.getGroupFor(t)}},{key:"addGroup",value:function(t){return this.groupManager.addGroup(t)}},{key:"addToGroup",value:function(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return(e=this.groupManager).addToGroup.apply(e,[t,!1].concat(i))}},{key:"collapseGroup",value:function(t){this.groupManager.collapseGroup(t)}},{key:"expandGroup",value:function(t){this.groupManager.expandGroup(t)}},{key:"toggleGroup",value:function(t){this.groupManager.toggleGroup(t)}},{key:"removeGroup",value:function(t,e,n,i){return this.groupManager.removeGroup(t,e,n,i)}},{key:"removeAllGroups",value:function(t,e){this.groupManager.removeAllGroups(t,e,!1)}},{key:"removeFromGroup",value:function(t,e,n){this.groupManager.removeFromGroup(t,n,e),this._appendElement(e,this.getContainer()),this.updateOffset({recalc:!0,elId:this.getId(e)})}},{key:"_paintEndpoint",value:function(t,e){var n=(e=e||{}).timestamp,i=!(!1===e.recalc);if(!n||t.timestamp!==n){var o=this.viewport.getPosition(t.elementId),r=e.offset?{x:e.offset.x,y:e.offset.y}:{x:o.x,y:o.y};if(null!=r){var s=e.anchorLoc;if(null==s){var a={xy:r,wh:o,element:t,timestamp:n};if(i&&this.router.isDynamicAnchor(t)&&t.connections.length>0){var l=function(t){var n=0;if(null!=e.elementWithPrecedence)for(var i=0;i<t.connections.length;i++)if(t.connections[i].sourceId===e.elementWithPrecedence||t.connections[i].targetId===e.elementWithPrecedence){n=i;break}return t.connections[n]}(t),u=l.endpoints[0]===t?1:0,c=0===u?l.sourceId:l.targetId,h=this.viewport.getPosition(c);a.index=0===u?1:0,a.connection=l,a.txy=h,a.twh=h,a.tElement=l.endpoints[u],a.tRotation=this._getRotations(c)}else t.connections.length>0&&(a.connection=t.connections[0]);a.rotation=this._getRotations(t.elementId),s=this.router.computeAnchorLocation(t._anchor,a)}for(var d in t.endpoint.compute(s,this.router.getEndpointOrientation(t),t.paintStyleInUse),this.renderEndpoint(t,t.paintStyleInUse),t.timestamp=n,t.overlays)if(t.overlays.hasOwnProperty(d)){var p=t.overlays[d];p.isVisible()&&(t.overlayPlacements[d]=this.drawOverlay(p,t.endpoint,t.paintStyleInUse,t.getAbsoluteOverlayPosition(p)),this._paintOverlay(p,t.overlayPlacements[d],{xmin:0,ymin:0}))}}}}},{key:"_paintConnection",value:function(t,e){if(!this._suspendDrawing&&!1!==t.visible){var n=(e=e||{}).timestamp;if(null!=n&&n===t.lastPaintedAt)return;if(null==n||n!==t.lastPaintedAt){this.router.computePath(t,n);var i={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0};for(var o in t.overlays)if(t.overlays.hasOwnProperty(o)){var r=t.overlays[o];r.isVisible()&&(t.overlayPlacements[o]=this.drawOverlay(r,t.connector,t.paintStyleInUse,t.getAbsoluteOverlayPosition(r)),i.xmin=Math.min(i.xmin,t.overlayPlacements[o].xmin),i.xmax=Math.max(i.xmax,t.overlayPlacements[o].xmax),i.ymin=Math.min(i.ymin,t.overlayPlacements[o].ymin),i.ymax=Math.max(i.ymax,t.overlayPlacements[o].ymax))}var s=parseFloat(""+t.paintStyleInUse.strokeWidth||"1")/2,a=parseFloat(""+t.paintStyleInUse.strokeWidth||"0"),l={xmin:Math.min(t.connector.bounds.xmin-(s+a),i.xmin),ymin:Math.min(t.connector.bounds.ymin-(s+a),i.ymin),xmax:Math.max(t.connector.bounds.xmax+(s+a),i.xmax),ymax:Math.max(t.connector.bounds.ymax+(s+a),i.ymax)};for(var u in this.paintConnector(t.connector,t.paintStyleInUse,l),t.overlays)if(t.overlays.hasOwnProperty(u)){var c=t.overlays[u];c.isVisible()&&this._paintOverlay(c,t.overlayPlacements[u],l)}}t.lastPaintedAt=n}}},{key:"_refreshEndpoint",value:function(t){t._anchor.isFloating||(t.connections.length>0?this.addEndpointClass(t,this.endpointConnectedClass):this.removeEndpointClass(t,this.endpointConnectedClass),t.isFull()?this.addEndpointClass(t,this.endpointFullClass):this.removeEndpointClass(t,this.endpointFullClass))}},{key:"_makeConnector",value:function(t,e,n){return ea.get(t,e,n)}},{key:"addOverlay",value:function(t,e,n){if(t.addOverlay(e),!n){var i=t instanceof us?t.element:t.source;this.revalidate(i)}}},{key:"removeOverlay",value:function(t,e){t.removeOverlay(e);var n=t instanceof us?t.element:t.source;this.revalidate(n)}},{key:"setOutlineColor",value:function(t,e){t.paintStyleInUse.outlineStroke=e,this._paintConnection(t)}},{key:"setOutlineWidth",value:function(t,e){t.paintStyleInUse.outlineWidth=e,this._paintConnection(t)}},{key:"setColor",value:function(t,e){t.paintStyleInUse.stroke=e,this._paintConnection(t)}},{key:"setLineWidth",value:function(t,e){t.paintStyleInUse.strokeWidth=e,this._paintConnection(t)}},{key:"setLineStyle",value:function(t,e){null!=e.lineWidth&&(t.paintStyleInUse.strokeWidth=e.lineWidth),null!=e.outlineWidth&&(t.paintStyleInUse.outlineWidth=e.outlineWidth),null!=e.color&&(t.paintStyleInUse.stroke=e.color),null!=e.outlineColor&&(t.paintStyleInUse.outlineStroke=e.outlineColor),this._paintConnection(t)}},{key:"getPathData",value:function(t){for(var e="",n=0;n<t.segments.length;n++)e+=t.segments[n].getPath(0===n),e+=" ";return e}}]),a}(Yr),la={};function ua(t,e){la[t]=e}function ca(t,n,i){var o=n,r=e(n.getBoundingClientRect)!==pi?n.getBoundingClientRect():{left:0,top:0,width:0,height:0},s=document.body,a=document.documentElement,l=window.pageYOffset||a.scrollTop||s.scrollTop,u=window.pageXOffset||a.scrollLeft||s.scrollLeft,c=a.clientTop||s.clientTop||0,h=a.clientLeft||s.clientLeft||0,d=r.top+l-c+0*i,p=r.left+u-h+0*i,f=wi(t),v=r.width||o.offsetWidth*i,g=r.height||o.offsetHeight*i;return{x:(f.x-p)/v,y:(f.y-d)/g}}function ha(t){return Es(t)||bs(t)||Cs(t)}function da(t,e){t.canvas&&(t.canvas.style.display=e?"block":"none")}function pa(t){t.canvas&&t.canvas.parentNode.removeChild(t.canvas),delete t.canvas}function fa(t){return t.canvas}function va(t){return Br.getElement(t)}function ga(t){return Br.getElement(t,t.component,(function(e){var n=t.create(e);return t.instance.addClass(n,t.instance.overlayClass),n}))}function ya(t,e,n,i){var o=t.x,r=t.y;return e._jsPlumbParentGroup&&e._jsPlumbParentGroup.constrain&&(o=Math.max(t.x,0),r=Math.max(t.y,0),o=Math.min(o,n.w-i.w),r=Math.min(r,n.h-i.h)),{x:o,y:r}}var ma=function(i){s(d,i);var l=c(d);function d(t,e){var i;if(n(this,d),(i=l.call(this,t,e))._instanceIndex=t,r(u(i),"containerType",null),r(u(i),"dragSelection",void 0),r(u(i),"dragManager",void 0),r(u(i),"_connectorClick",void 0),r(u(i),"_connectorDblClick",void 0),r(u(i),"_connectorTap",void 0),r(u(i),"_connectorDblTap",void 0),r(u(i),"_endpointClick",void 0),r(u(i),"_endpointDblClick",void 0),r(u(i),"_overlayClick",void 0),r(u(i),"_overlayDblClick",void 0),r(u(i),"_overlayTap",void 0),r(u(i),"_overlayDblTap",void 0),r(u(i),"_connectorMouseover",void 0),r(u(i),"_connectorMouseout",void 0),r(u(i),"_endpointMouseover",void 0),r(u(i),"_endpointMouseout",void 0),r(u(i),"_connectorContextmenu",void 0),r(u(i),"_connectorMousedown",void 0),r(u(i),"_connectorMouseup",void 0),r(u(i),"_endpointMousedown",void 0),r(u(i),"_endpointMouseup",void 0),r(u(i),"_overlayMouseover",void 0),r(u(i),"_overlayMouseout",void 0),r(u(i),"_elementClick",void 0),r(u(i),"_elementTap",void 0),r(u(i),"_elementDblTap",void 0),r(u(i),"_elementMouseenter",void 0),r(u(i),"_elementMouseexit",void 0),r(u(i),"_elementMousemove",void 0),r(u(i),"_elementMouseup",void 0),r(u(i),"_elementMousedown",void 0),r(u(i),"_elementContextmenu",void 0),r(u(i),"_resizeObserver",void 0),r(u(i),"eventManager",void 0),r(u(i),"draggingClass","jtk-dragging"),r(u(i),"elementDraggingClass","jtk-element-dragging"),r(u(i),"hoverClass","jtk-hover"),r(u(i),"sourceElementDraggingClass","jtk-source-element-dragging"),r(u(i),"targetElementDraggingClass","jtk-target-element-dragging"),r(u(i),"hoverSourceClass","jtk-source-hover"),r(u(i),"hoverTargetClass","jtk-target-hover"),r(u(i),"dragSelectClass","jtk-drag-select"),r(u(i),"managedElementsSelector",void 0),r(u(i),"elementsDraggable",void 0),r(u(i),"elementDragHandler",void 0),r(u(i),"groupDragOptions",void 0),r(u(i),"elementDragOptions",void 0),r(u(i),"svg",{node:function(t,e){return Xe(t,e)},attr:function(t,e){return Ye(t,e)},pos:function(t){return ze(t)}}),e=e||{},i.containerType=kt(i.getContainer()),i.elementsDraggable=e&&!1!==e.elementsDraggable,i.managedElementsSelector=e&&e.managedElementsSelector||Ae,i.eventManager=new Xi,i.dragSelection=new Go(u(i)),i.dragManager=new Xo(u(i),i.dragSelection),i.dragManager.addHandler(new Hr(u(i))),i.groupDragOptions={constrainFunction:ya},i.dragManager.addHandler(new Ur(u(i),i.dragSelection),i.groupDragOptions),i.elementDragHandler=new Zo(u(i),i.dragSelection),i.elementDragOptions=e&&e.dragOptions||{},i.dragManager.addHandler(i.elementDragHandler,i.elementDragOptions),e&&e.dragOptions&&e.dragOptions.filter&&i.dragManager.addFilter(e.dragOptions.filter),i._createEventListeners(),i._attachEventDelegates(),!1!==e.resizeObserver)try{i._resizeObserver=new ResizeObserver((function(t){t.filter((function(t){var e=i.getAttribute(t.target,Nt);if(null!=e){var n=i.viewport._elementMap.get(e);return!!n&&(n.w!==t.contentRect.width||n.h!==t.contentRect.height)}return!1})).forEach((function(t){return i.revalidate(t.target)}))}))}catch(t){J("WARN: ResizeObserver could not be attached.")}return i}return o(d,[{key:"fireOverlayMethod",value:function(t,e,n){var i=Ze(t.component instanceof ps?sn:on,e);n._jsPlumbOverlay=t,t.fire(e,{e:n,overlay:t}),this.fire(i,t.component,n)}},{key:"addDragFilter",value:function(t,e){this.dragManager.addFilter(t,e)}},{key:"removeDragFilter",value:function(t){this.dragManager.removeFilter(t)}},{key:"setDragGrid",value:function(t){this.dragManager.setOption(this.elementDragHandler,{grid:t})}},{key:"setDragConstrainFunction",value:function(t){this.dragManager.setOption(this.elementDragHandler,{constrainFunction:t})}},{key:"_removeElement",value:function(t){t.parentNode&&t.parentNode.removeChild(t)}},{key:"_appendElement",value:function(t,e){e&&e.appendChild(t)}},{key:"_appendElementToGroup",value:function(t,e){this.getGroupContentArea(t).appendChild(e)}},{key:"_appendElementToContainer",value:function(t){this._appendElement(t,this.getContainer())}},{key:"_getAssociatedElements",value:function(t){var e=[];if(3!==t.nodeType&&8!==t.nodeType){var n=t.querySelectorAll(Ae);Array.prototype.push.apply(e,n)}return e.filter((function(t){return 3!==t.nodeType&&8!==t.nodeType}))}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"getClass",value:function(t){return ct(t)}},{key:"addClass",value:function(t,e){ht(t,e)}},{key:"hasClass",value:function(t,e){return dt(t,e)}},{key:"removeClass",value:function(t,e){pt(t,e)}},{key:"toggleClass",value:function(t,e){ft(t,e)}},{key:"setAttribute",value:function(t,e,n){t.setAttribute(e,n)}},{key:"getAttribute",value:function(t,e){return t.getAttribute(e)}},{key:"setAttributes",value:function(t,e){for(var n in e)t.setAttribute(n,e[n])}},{key:"removeAttribute",value:function(t,e){t.removeAttribute&&t.removeAttribute(e)}},{key:"on",value:function(t,e,n,i){var o=this,r=function(t){null==i?o.eventManager.on(t,e,n):o.eventManager.on(t,e,n,i)};return ut(t)?D(t,(function(t){return r(t)})):r(t),this}},{key:"off",value:function(t,e,n){var i=this;return ut(t)?D(t,(function(t){return i.eventManager.off(t,e,n)})):this.eventManager.off(t,e,n),this}},{key:"trigger",value:function(t,e,n,i,o){this.eventManager.trigger(t,e,n,i,o)}},{key:"getOffsetRelativeToRoot",value:function(t){return yt(t)}},{key:"getOffset",value:function(t){for(var e,n=t,i=this.getContainer(),o=this.getPosition(n),r=t!==i&&n.offsetParent!==i?n.offsetParent:null;null!=r;)o.x+=r.offsetLeft,o.y+=r.offsetTop,null!=(e=r)&&e!==document.body&&(e.scrollTop>0||e.scrollLeft>0)&&(o.x-=e.scrollLeft,o.y-=e.scrollTop),r=r.offsetParent===i?null:r.offsetParent;if(null!=i&&(i.scrollTop>0||i.scrollLeft>0)){var s=null!=n.offsetParent?this.getStyle(n.offsetParent,ii):jt,a=this.getStyle(n,ii);a!==Ot&&a!==It&&s!==Ot&&s!==It&&(o.x-=i.scrollLeft,o.y-=i.scrollTop)}return o}},{key:"getSize",value:function(t){var e=t;return null!=e.offsetWidth?mt(t):e.width&&e.width.baseVal?_t(e):void 0}},{key:"getPosition",value:function(t){var e=t;return null!=e.offsetLeft?{x:parseFloat(e.offsetLeft),y:parseFloat(e.offsetTop)}:e.x&&e.x.baseVal?Et(e):void 0}},{key:"getStyle",value:function(t,n){return e(window.getComputedStyle)!==pi?getComputedStyle(t,null).getPropertyValue(n):t.currentStyle[n]}},{key:"getGroupContentArea",value:function(t){var e=this.getSelector(t.el,ai);return e&&e.length>0?e[0]:t.el}},{key:"getSelector",value:function(t,e){var n=null;if(1===arguments.length){if(!_(t)){var i=document.createDocumentFragment();return i.appendChild(t),F(i.childNodes)}n=F(document.querySelectorAll(t))}else n=F(t.querySelectorAll(e));return n}},{key:"setPosition",value:function(t,e){var n=t;n.style.left=e.x+"px",n.style.top=e.y+"px"}},{key:"setDraggable",value:function(t,e){e?this.removeAttribute(t,Gt):this.setAttribute(t,Gt,vi)}},{key:"isDraggable",value:function(t){var e=this.getAttribute(t,Gt);return null==e||e===gi}},{key:"toggleDraggable",value:function(t){var e=this.isDraggable(t);return this.setDraggable(t,!e),!e}},{key:"_createEventListeners",value:function(){var t=function(t,e){if(!e.defaultPrevented&&null==e._jsPlumbOverlay){var n=rt(st(e),oi,this.getContainer(),!0);this.fire(t,n.jtk.connector.connection,e)}};this._connectorClick=t.bind(this,qn),this._connectorDblClick=t.bind(this,Kn),this._connectorTap=t.bind(this,ni),this._connectorDblTap=t.bind(this,Zn);var e=function(t,e){var n=st(e).parentNode;if(n.jtk&&n.jtk.connector){var i=n.jtk.connector,o=i.connection;this.setConnectorHover(i,t),t?(this.addClass(o.source,this.hoverSourceClass),this.addClass(o.target,this.hoverTargetClass)):(this.removeClass(o.source,this.hoverSourceClass),this.removeClass(o.target,this.hoverTargetClass)),this.fire(t?Qn:Jn,n.jtk.connector.connection,e)}};this._connectorMouseover=e.bind(this,!0),this._connectorMouseout=e.bind(this,!1);var n=function(t,e){var n=st(e).parentNode;n.jtk&&n.jtk.connector&&this.fire(t?$n:ti,n.jtk.connector.connection,e)};this._connectorMouseup=n.bind(this,!0),this._connectorMousedown=n.bind(this,!1),this._connectorContextmenu=function(t){var e=st(t).parentNode;e.jtk&&e.jtk.connector&&this.fire(ei,e.jtk.connector.connection,t)}.bind(this);var i=function(t,e,n){e.defaultPrevented||null!=e._jsPlumbOverlay||this.fire(t,n.jtk.endpoint,e)};this._endpointClick=i.bind(this,Vn),this._endpointDblClick=i.bind(this,Hn);var o=function(t,e){var n=st(e);n.jtk&&n.jtk.endpoint&&(this.setEndpointHover(n.jtk.endpoint,t),this.fire(t?Yn:Bn,n.jtk.endpoint,e))};this._endpointMouseover=o.bind(this,!0),this._endpointMouseout=o.bind(this,!1);var r=function(t,e){var n=st(e);n.jtk&&n.jtk.endpoint&&this.fire(t?Xn:zn,n.jtk.endpoint,e)};this._endpointMouseup=r.bind(this,!0),this._endpointMousedown=r.bind(this,!1);var s=function(t,e){var n=rt(st(e),li,this.getContainer(),!0).jtk.overlay;n&&this.fireOverlayMethod(n,t,e)}.bind(this);this._overlayClick=s.bind(this,ln),this._overlayDblClick=s.bind(this,cn),this._overlayTap=s.bind(this,En),this._overlayDblTap=s.bind(this,hn);var a=function(t,e){var n=rt(st(e),li,this.getContainer(),!0).jtk.overlay;n&&this.setOverlayHover(n,t)};this._overlayMouseover=a.bind(this,!0),this._overlayMouseout=a.bind(this,!1);this._elementClick=function(t,e,n){e.defaultPrevented||this.fire(1===e.detail?wn:Dn,n,e)}.bind(this,wn);this._elementTap=function(t,e,n){e.defaultPrevented||this.fire(Fn,n,e)}.bind(this,Fn);this._elementDblTap=function(t,e,n){e.defaultPrevented||this.fire(On,n,e)}.bind(this,On);var l=function(t,e){this.fire(t?jn:In,st(e),e)};this._elementMouseenter=l.bind(this,!0),this._elementMouseexit=l.bind(this,!1),this._elementMousemove=function(t){this.fire(Ln,st(t),t)}.bind(this),this._elementMouseup=function(t){this.fire(Nn,st(t),t)}.bind(this),this._elementMousedown=function(t){this.fire(Gn,st(t),t)}.bind(this),this._elementContextmenu=function(t){this.fire(Rn,st(t),t)}.bind(this)}},{key:"_attachEventDelegates",value:function(){var t=this.getContainer();this.eventManager.on(t,ln,li,this._overlayClick),this.eventManager.on(t,cn,li,this._overlayDblClick),this.eventManager.on(t,En,li,this._overlayTap),this.eventManager.on(t,hn,li,this._overlayDblTap),this.eventManager.on(t,ln,oi,this._connectorClick),this.eventManager.on(t,cn,oi,this._connectorDblClick),this.eventManager.on(t,En,oi,this._connectorTap),this.eventManager.on(t,hn,oi,this._connectorDblTap),this.eventManager.on(t,ln,ri,this._endpointClick),this.eventManager.on(t,cn,ri,this._endpointDblClick),this.eventManager.on(t,ln,this.managedElementsSelector,this._elementClick),this.eventManager.on(t,En,this.managedElementsSelector,this._elementTap),this.eventManager.on(t,hn,this.managedElementsSelector,this._elementDblTap),this.eventManager.on(t,_n,oi,this._connectorMouseover),this.eventManager.on(t,mn,oi,this._connectorMouseout),this.eventManager.on(t,un,oi,this._connectorContextmenu),this.eventManager.on(t,yn,oi,this._connectorMouseup),this.eventManager.on(t,pn,oi,this._connectorMousedown),this.eventManager.on(t,_n,ri,this._endpointMouseover),this.eventManager.on(t,mn,ri,this._endpointMouseout),this.eventManager.on(t,yn,ri,this._endpointMouseup),this.eventManager.on(t,pn,ri,this._endpointMousedown),this.eventManager.on(t,_n,li,this._overlayMouseover),this.eventManager.on(t,mn,li,this._overlayMouseout),this.eventManager.on(t,_n,Ae,this._elementMouseenter),this.eventManager.on(t,mn,Ae,this._elementMouseexit),this.eventManager.on(t,gn,Ae,this._elementMousemove),this.eventManager.on(t,yn,Ae,this._elementMouseup),this.eventManager.on(t,pn,Ae,this._elementMousedown),this.eventManager.on(t,un,Ae,this._elementContextmenu)}},{key:"_detachEventDelegates",value:function(){var t=this.getContainer();t&&(this.eventManager.off(t,ln,this._connectorClick),this.eventManager.off(t,cn,this._connectorDblClick),this.eventManager.off(t,En,this._connectorTap),this.eventManager.off(t,hn,this._connectorDblTap),this.eventManager.off(t,ln,this._endpointClick),this.eventManager.off(t,cn,this._endpointDblClick),this.eventManager.off(t,ln,this._overlayClick),this.eventManager.off(t,cn,this._overlayDblClick),this.eventManager.off(t,En,this._overlayTap),this.eventManager.off(t,hn,this._overlayDblTap),this.eventManager.off(t,ln,this._elementClick),this.eventManager.off(t,En,this._elementTap),this.eventManager.off(t,hn,this._elementDblTap),this.eventManager.off(t,_n,this._connectorMouseover),this.eventManager.off(t,mn,this._connectorMouseout),this.eventManager.off(t,un,this._connectorContextmenu),this.eventManager.off(t,yn,this._connectorMouseup),this.eventManager.off(t,pn,this._connectorMousedown),this.eventManager.off(t,_n,this._endpointMouseover),this.eventManager.off(t,mn,this._endpointMouseout),this.eventManager.off(t,yn,this._endpointMouseup),this.eventManager.off(t,pn,this._endpointMousedown),this.eventManager.off(t,_n,this._overlayMouseover),this.eventManager.off(t,mn,this._overlayMouseout),this.eventManager.off(t,fn,this._elementMouseenter),this.eventManager.off(t,vn,this._elementMouseexit),this.eventManager.off(t,gn,this._elementMousemove),this.eventManager.off(t,yn,this._elementMouseup),this.eventManager.off(t,pn,this._elementMousedown),this.eventManager.off(t,un,this._elementContextmenu))}},{key:"setContainer",value:function(t){var e,n=this;if(t===document||t===document.body)throw new Error("Cannot set document or document.body as container element");this._detachEventDelegates(),null!=this.dragManager&&(e=this.dragManager.reset()),this.setAttribute(t,$e,X().replace("-",""));var i=this.getContainer();null!=i&&(i.removeAttribute($e),D(F(i.childNodes).filter((function(t){return null!=t&&(n.hasClass(t,Bt)||n.hasClass(t,zt)||n.hasClass(t,ee)||t.getAttribute&&null!=t.getAttribute(Nt))})),(function(e){t.appendChild(e)})));h(a(d.prototype),"setContainer",this).call(this,t),this.containerType=kt(t),null!=this.eventManager&&this._attachEventDelegates(),null!=this.dragManager&&(this.dragManager.addHandler(new Hr(this)),this.dragManager.addHandler(new Ur(this,this.dragSelection),this.groupDragOptions),this.elementDragHandler=new Zo(this,this.dragSelection),this.dragManager.addHandler(this.elementDragHandler,this.elementDragOptions),null!=e&&this.dragManager.setFilters(e))}},{key:"reset",value:function(){h(a(d.prototype),"reset",this).call(this),this._resizeObserver&&this._resizeObserver.disconnect(),D(this.getContainer().querySelectorAll([Ae,ri,oi,li].join(",")),(function(t){return t.parentNode&&t.parentNode.removeChild(t)}))}},{key:"destroy",value:function(){this._detachEventDelegates(),null!=this.dragManager&&this.dragManager.reset(),this.clearDragSelection(),h(a(d.prototype),"destroy",this).call(this)}},{key:"unmanage",value:function(t,e){null!=this._resizeObserver&&this._resizeObserver.unobserve(t),this.removeFromDragSelection(t),h(a(d.prototype),"unmanage",this).call(this,t,e)}},{key:"addToDragSelection",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];D(n,(function(e){return t.dragSelection.add(e)}))}},{key:"clearDragSelection",value:function(){this.dragSelection.clear()}},{key:"removeFromDragSelection",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];D(n,(function(e){return t.dragSelection.remove(e)}))}},{key:"toggleDragSelection",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];D(n,(function(e){return t.dragSelection.toggle(e)}))}},{key:"addToDragGroup",value:function(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(e=this.elementDragHandler).addToDragGroup.apply(e,[t].concat(i))}},{key:"removeFromDragGroup",value:function(){var t;(t=this.elementDragHandler).removeFromDragGroup.apply(t,arguments)}},{key:"setDragGroupState",value:function(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(e=this.elementDragHandler).setDragGroupState.apply(e,[t].concat(i))}},{key:"clearDragGroup",value:function(t){this.elementDragHandler.clearDragGroup(t)}},{key:"consume",value:function(t,e){ot(t,e)}},{key:"rotate",value:function(t,e,n){var i=this.getId(t);return this._managedElements[i]?(this._managedElements[i].el.style.transform="rotate("+e+"deg)",this._managedElements[i].el.style.transformOrigin="center center",h(a(d.prototype),"rotate",this).call(this,t,e,n)):{c:new Set,e:new Set}}},{key:"addOverlayClass",value:function(t,e){if(Jr(t))t.instance.addClass(va(t),e);else if(ha(t))t.instance.addClass(fs(t),e);else{if(!Ps(t))throw"Could not add class to overlay of type ["+t.type+"]";t.instance.addClass(ga(t),e)}}},{key:"removeOverlayClass",value:function(t,e){if(Jr(t))t.instance.removeClass(va(t),e);else if(ha(t))t.instance.removeClass(fs(t),e);else{if(!Ps(t))throw"Could not remove class from overlay of type ["+t.type+"]";t.instance.removeClass(ga(t),e)}}},{key:"_paintOverlay",value:function(t,e,n){if(Jr(t)){va(t);var i=t.component.getXY();t.canvas.style.left=i.x+e.d.minx+"px",t.canvas.style.top=i.y+e.d.miny+"px"}else if(ha(t)){!function(t,e,n,i){fs(t);var o=[0,0];i.xmin<0&&(o[0]=-i.xmin),i.ymin<0&&(o[1]=-i.ymin);var r={d:e,stroke:n.stroke?n.stroke:null,fill:n.fill?n.fill:null,transform:"translate("+o[0]+","+o[1]+")","pointer-events":"visibleStroke"};Ye(t.path,r)}(t,isNaN(e.d.cxy.x)||isNaN(e.d.cxy.y)?"M 0 0":"M"+e.d.hxy.x+","+e.d.hxy.y+" L"+e.d.tail[0].x+","+e.d.tail[0].y+" L"+e.d.cxy.x+","+e.d.cxy.y+" L"+e.d.tail[1].x+","+e.d.tail[1].y+" Z",e,n)}else{if(!Ps(t))throw"Could not paint overlay of type ["+t.type+"]";ga(t);var o=t.component.getXY();t.canvas.style.left=o.x+e.d.minx+"px",t.canvas.style.top=o.y+e.d.miny+"px"}}},{key:"setOverlayVisible",value:function(t,e){var n=e?"block":"none";function i(t){null!=t&&(t.style.display=n)}Jr(t)?i(va(t)):Ps(t)?i(ga(t)):ha(t)&&i(t.path)}},{key:"reattachOverlay",value:function(t,e){Jr(t)?t.instance._appendElement(va(t),this.getContainer()):Ps(t)?t.instance._appendElement(ga(t),this.getContainer()):ha(t)&&this._appendElement(fs(t),e.connector.canvas)}},{key:"setOverlayHover",value:function(t,e){var n;Jr(t)?n=va(t):Ps(t)?n=ga(t):ha(t)&&(n=fs(t)),null!=n&&(null!=this.hoverClass&&(e?this.addClass(n,this.hoverClass):this.removeClass(n,this.hoverClass)),this.setHover(t.component,e))}},{key:"destroyOverlay",value:function(t){if(Jr(t)){var e=va(t);e.parentNode.removeChild(e),delete t.canvas,delete t.cachedDimensions}else if(Es(t)||bs(t)||Cs(t))!function(t,e){var n=t;null!=n.path&&null!=n.path.parentNode&&n.path.parentNode.removeChild(n.path),null!=n.bgPath&&null!=n.bgPath.parentNode&&n.bgPath.parentNode.removeChild(n.bgPath),delete n.path,delete n.bgPath}(t);else if(Ps(t)){var n=ga(t);n.parentNode.removeChild(n),delete t.canvas,delete t.cachedDimensions}}},{key:"drawOverlay",value:function(t,e,n,i){if(Jr(t)||Ps(t)){var o=Br._getDimensions(t);if(null!=o&&null!=o.w&&null!=o.h){var r={x:0,y:0};if(i)r={x:i.x,y:i.y};else if(e instanceof er){var s=Array.isArray(t.location)?t.location:[t.location,t.location];r={x:s[0]*e.w,y:s[1]*e.h}}else{var a=t.location,l=!1;(_(t.location)||t.location<0||t.location>1)&&(a=parseInt(""+t.location,10),l=!0),r=e.pointOnPath(a,l)}var u=r.x-o.w/2,c=r.y-o.h/2;return{component:t,d:{minx:u,miny:c,td:o,cxy:r},xmin:u,xmax:u+o.w,ymin:c,ymax:c+o.h}}return{xmin:0,xmax:0,ymin:0,ymax:0}}if(Es(t)||bs(t)||Cs(t))return t.draw(e,n,i);throw"Could not draw overlay of type ["+t.type+"]"}},{key:"updateLabel",value:function(t){if(k(t.label)){var e=t.label(this);va(t).innerText=null!=e?e:""}else null==t.labelText&&(t.labelText=t.label,null!=t.labelText?va(t).innerText=t.labelText:va(t).innerText="")}},{key:"setHover",value:function(t,e){t._hover=e,t instanceof us&&null!=t.endpoint?this.setEndpointHover(t,e,-1):t instanceof ps&&null!=t.connector&&this.setConnectorHover(t.connector,e)}},{key:"paintConnector",value:function(t,e,n){gs(this,t,e,n)}},{key:"setConnectorHover",value:function(t,e,n){if(!1===e||!this.currentlyDragging&&!this.isHoverSuspended()){var i=t.canvas;null!=i&&(null!=t.hoverClass&&(e?this.addClass(i,t.hoverClass):this.removeClass(i,t.hoverClass)),e?this.addClass(i,this.hoverClass):this.removeClass(i,this.hoverClass)),null!=t.connection.hoverPaintStyle&&(t.connection.paintStyleInUse=e?t.connection.hoverPaintStyle:t.connection.paintStyle,this._suspendDrawing||this._paintConnection(t.connection)),t.connection.endpoints[0]!==n&&this.setEndpointHover(t.connection.endpoints[0],e,0,!0),t.connection.endpoints[1]!==n&&this.setEndpointHover(t.connection.endpoints[1],e,1,!0)}}},{key:"destroyConnector",value:function(t){null!=t.connector&&pa(t.connector)}},{key:"addConnectorClass",value:function(t,e){t.canvas&&this.addClass(t.canvas,e)}},{key:"removeConnectorClass",value:function(t,e){t.canvas&&this.removeClass(t.canvas,e)}},{key:"getConnectorClass",value:function(t){return t.canvas?t.canvas.className.baseVal:""}},{key:"setConnectorVisible",value:function(t,e){da(t,e)}},{key:"applyConnectorType",value:function(t,e){if(t.canvas&&e.cssClass){var n=Array.isArray(e.cssClass)?e.cssClass:[e.cssClass];this.addClass(t.canvas,n.join(" "))}}},{key:"addEndpointClass",value:function(t,e){var n=fa(t.endpoint);null!=n&&this.addClass(n,e)}},{key:"applyEndpointType",value:function(t,e){if(e.cssClass){var n=fa(t.endpoint);if(n){var i=Array.isArray(e.cssClass)?e.cssClass:[e.cssClass];this.addClass(n,i.join(" "))}}}},{key:"destroyEndpoint",value:function(t){var e=this.endpointAnchorClassPrefix+(t.currentAnchorClass?"-"+t.currentAnchorClass:"");this.removeClass(t.element,e),pa(t.endpoint)}},{key:"renderEndpoint",value:function(t,e){var n=la[t.endpoint.type];null!=n?ys.paint(t.endpoint,n,e):J("jsPlumb: no endpoint renderer found for type ["+t.endpoint.type+"]")}},{key:"removeEndpointClass",value:function(t,e){var n=fa(t.endpoint);null!=n&&this.removeClass(n,e)}},{key:"getEndpointClass",value:function(t){var e=fa(t.endpoint);return null!=e?e.className:""}},{key:"setEndpointHover",value:function(t,e,n,i){if(null!=t&&(!1===e||!this.currentlyDragging&&!this.isHoverSuspended())){var o=fa(t.endpoint);if(null!=o&&(null!=t.hoverClass&&(e?this.addClass(o,t.hoverClass):this.removeClass(o,t.hoverClass)),0===n||1===n)){var r=0===n?this.hoverSourceClass:this.hoverTargetClass;e?this.addClass(o,r):this.removeClass(o,r)}if(null!=t.hoverPaintStyle&&(t.paintStyleInUse=e?t.hoverPaintStyle:t.paintStyle,this._suspendDrawing||this.renderEndpoint(t,t.paintStyleInUse)),!i)for(var s=0;s<t.connections.length;s++)this.setConnectorHover(t.connections[s].connector,e,t)}}},{key:"setEndpointVisible",value:function(t,e){da(t.endpoint,e)}},{key:"setGroupVisible",value:function(t,e){for(var n=t.el.querySelectorAll(Ae),i=0;i<n.length;i++)e?this.show(n[i],!0):this.hide(n[i],!0)}},{key:"deleteConnection",value:function(t,e){return null!=t&&!0!==t.deleted&&(!0!==t.endpoints[0].deleted&&this.setEndpointHover(t.endpoints[0],!1,0,!0),!0!==t.endpoints[1].deleted&&this.setEndpointHover(t.endpoints[1],!1,1,!0),h(a(d.prototype),"deleteConnection",this).call(this,t,e))}},{key:"addSourceSelector",value:function(t,e,n){return this.addDragFilter(t),h(a(d.prototype),"addSourceSelector",this).call(this,t,e,n)}},{key:"removeSourceSelector",value:function(t){this.removeDragFilter(t.selector),h(a(d.prototype),"removeSourceSelector",this).call(this,t)}},{key:"manage",value:function(e,n,i){if(this.containerType===t.ElementTypes.SVG&&!Ct(e))throw new Error("ERROR: cannot manage non-svg element when container is an SVG element.");var o=h(a(d.prototype),"manage",this).call(this,e,n,i);return null!=o&&null!=this._resizeObserver&&this._resizeObserver.observe(o.el),o}}]),d}(aa),_a=function(t){s(i,t);var e=c(i);function i(t,o){var s;return n(this,i),r(u(s=e.call(this,t,o)),"width",void 0),r(u(s),"height",void 0),r(u(s),"type",i.type),o=o||{},s.width=o.width||10,s.height=o.height||10,s}return o(i,null,[{key:"_getParams",value:function(t){return{width:t.width,height:t.height}}}]),i}(er);r(_a,"type","Rectangle");var Ea={type:_a.type,cls:_a,compute:function(t,e,n,i){var o=i.width||t.width,r=i.height||t.height,s=e.curX-o/2,a=e.curY-r/2;return t.x=s,t.y=a,t.w=o,t.h=r,[s,a,o,r]},getParams:function(t){return{width:t.width,height:t.height}}},xa=function(t){s(i,t);var e=c(i);function i(t,o){var s;return n(this,i),r(u(s=e.call(this,t,o)),"type",i.type),s}return i}(er);r(xa,"type","Blank");var ba,ka={type:xa.type,cls:xa,compute:function(t,e,n,i){return t.x=e.curX,t.y=e.curY,t.w=10,t.h=0,[e.curX,e.curY,10,0]},getParams:function(t){return{}}},Ca={width:10,height:0,fill:"transparent",stroke:"transparent"};ua(ws.type,{makeNode:function(t,e){return Xe("circle",{cx:t.w/2,cy:t.h/2,r:t.radius})},updateNode:function(t,e){Ye(e,{cx:""+t.w/2,cy:""+t.h/2,r:""+t.radius})}}),ua(xa.type,{makeNode:function(t,e){return Xe("rect",Ca)},updateNode:function(t,e){Ye(e,Ca)}}),ua(_a.type,{makeNode:function(t,e){return Xe("rect",{width:t.w,height:t.h})},updateNode:function(t,e){Ye(e,{width:t.w,height:t.h})}}),t.SupportedEdge=void 0,(ba=t.SupportedEdge||(t.SupportedEdge={}))[ba.top=0]="top",ba[ba.bottom=1]="bottom";var Sa=new Map;Sa.set(t.SupportedEdge.top,[t.AnchorLocations.TopRight,t.AnchorLocations.TopLeft]),Sa.set(t.SupportedEdge.bottom,[t.AnchorLocations.BottomRight,t.AnchorLocations.BottomLeft]);var Pa={deriveAnchor:function(t,e,n,i){return Sa.get(t)[e]}},Ta="jtk-scrollable-list",Aa=Tt(Ta),Ma="scroll",wa=function(){function t(e,i){var o=this;n(this,t),this.instance=e,r(this,"options",void 0),r(this,"count",void 0),r(this,"lists",void 0),this.count=0,this.lists={},this.options=i||{},this.instance.bind(he,(function(t){for(var e=o.instance.getSelector(t.el,Aa),n=0;n<e.length;n++)o.addList(e[n])})),this.instance.bind(xe,(function(t){o.removeList(t.el)})),this.instance.bind(ie,(function(t,e){if(null==e){var n=o.findParentList(t.target);null!=n&&n.newConnection(t.connection,t.target,1);var i=o.findParentList(t.source);null!=i&&i.newConnection(t.connection,t.source,0)}})),this.instance.bind(Se,(function(t){var e=t.dropEndpoint.element,n=o.findParentList(e);return null==n||e.offsetTop>=n.domElement.scrollTop&&e.offsetTop+e.offsetHeight<=n.domElement.scrollTop+n.domElement.offsetHeight}))}return o(t,[{key:"addList",value:function(t,e){var n=y({},Pa);y(n,this.options),e=y(n,e||{});var i=[this.instance._instanceIndex,this.count++].join("_");return this.lists[i]=new Da(this.instance,t,e,i),this.lists[i]}},{key:"getList",value:function(t){var e=this.instance.getAttribute(t,Ta);if(null!=e)return this.lists[e]}},{key:"removeList",value:function(t){var e=this.getList(t);e&&(e.destroy(),delete this.lists[e.id])}},{key:"findParentList",value:function(t){for(var e,n=t.parentNode,i=this.instance.getContainer();null!=n&&n!==i&&n!==document;){if(null!=(e=this.getList(n)))return e;n=n.parentNode}}}]),t}(),Da=function(){function e(t,i,o,s){n(this,e),this.instance=t,this.el=i,this.options=o,this.id=s,r(this,"_scrollHandler",void 0),r(this,"domElement",void 0),r(this,"elId",void 0),this.domElement=i,this.elId=this.instance.getId(i),t.setAttribute(i,Ta,s),this._scrollHandler=this.scrollHandler.bind(this),this.domElement._jsPlumbScrollHandler=this._scrollHandler,t.on(i,Ma,this._scrollHandler),this._scrollHandler()}return o(e,[{key:"deriveAnchor",value:function(t,e,n,i){return this.options.anchor?this.options.anchor:this.options.deriveAnchor(t,e,n,i)}},{key:"deriveEndpoint",value:function(t,e,n,i){return this.options.deriveEndpoint?this.options.deriveEndpoint(t,e,n,i):this.options.endpoint?this.options.endpoint:n.endpoint.type}},{key:"newConnection",value:function(e,n,i){n.offsetTop<this.el.scrollTop?this._proxyConnection(n,e,i,t.SupportedEdge.top):n.offsetTop+n.offsetHeight>this.el.scrollTop+this.domElement.offsetHeight&&this._proxyConnection(n,e,i,t.SupportedEdge.bottom)}},{key:"scrollHandler",value:function(){for(var e=this,n=this.instance.getSelector(this.el,Ae),i=function(i){if(n[i].offsetTop<e.el.scrollTop)n[i]._jsPlumbProxies=n[i]._jsPlumbProxies||[],e.instance.select({source:n[i]}).each((function(o){e._proxyConnection(n[i],o,0,t.SupportedEdge.top)})),e.instance.select({target:n[i]}).each((function(o){e._proxyConnection(n[i],o,1,t.SupportedEdge.top)}));else if(n[i].offsetTop+n[i].offsetHeight>e.el.scrollTop+e.domElement.offsetHeight)n[i]._jsPlumbProxies=n[i]._jsPlumbProxies||[],e.instance.select({source:n[i]}).each((function(o){e._proxyConnection(n[i],o,0,t.SupportedEdge.bottom)})),e.instance.select({target:n[i]}).each((function(o){e._proxyConnection(n[i],o,1,t.SupportedEdge.bottom)}));else if(n[i]._jsPlumbProxies){for(var o=0;o<n[i]._jsPlumbProxies.length;o++)e.instance.unproxyConnection(n[i]._jsPlumbProxies[o][0],n[i]._jsPlumbProxies[o][1]);delete n[i]._jsPlumbProxies}e.instance.revalidate(n[i])},o=0;o<n.length;o++)i(o)}},{key:"_proxyConnection",value:function(t,e,n,i){var o=this;this.instance.proxyConnection(e,n,this.domElement,(function(t,n){return o.deriveEndpoint(i,n,e.endpoints[n],e)}),(function(t,n){return o.deriveAnchor(i,n,e.endpoints[n],e)})),t._jsPlumbProxies=t._jsPlumbProxies||[],t._jsPlumbProxies.push([e,n])}},{key:"destroy",value:function(){this.instance.off(this.el,Ma,this._scrollHandler),delete this.domElement._jsPlumbScrollHandler;for(var t=this.instance.getSelector(this.el,Ae),e=0;e<t.length;e++)if(t[e]._jsPlumbProxies){for(var n=0;n<t[e]._jsPlumbProxies.length;n++)this.instance.unproxyConnection(t[e]._jsPlumbProxies[n][0],t[e]._jsPlumbProxies[n][1]);delete t[e]._jsPlumbProxies}}}]),e}();function Oa(t){var e=Math.floor(t),n=Math.ceil(t);return t-e<1e-10?e:n-t<1e-10?n:t}var Ia=function(t){s(i,t);var e=c(i);function i(t){var o;n(this,i),r(u(o=e.call(this,t)),"type",i.segmentType),r(u(o),"cx",void 0),r(u(o),"cy",void 0),r(u(o),"radius",void 0),r(u(o),"anticlockwise",void 0),r(u(o),"startAngle",void 0),r(u(o),"endAngle",void 0),r(u(o),"sweep",void 0),r(u(o),"length",void 0),r(u(o),"circumference",void 0),r(u(o),"frac",void 0),o.cx=t.cx,o.cy=t.cy,o.radius=t.r,o.anticlockwise=t.ac,t.startAngle&&t.endAngle?(o.startAngle=t.startAngle,o.endAngle=t.endAngle,o.x1=o.cx+o.radius*Math.cos(o.startAngle),o.y1=o.cy+o.radius*Math.sin(o.startAngle),o.x2=o.cx+o.radius*Math.cos(o.endAngle),o.y2=o.cy+o.radius*Math.sin(o.endAngle)):(o.startAngle=o._calcAngle(o.x1,o.y1),o.endAngle=o._calcAngle(o.x2,o.y2)),o.endAngle<0&&(o.endAngle+=qi),o.startAngle<0&&(o.startAngle+=qi);var s=o.endAngle<o.startAngle?o.endAngle+qi:o.endAngle;return o.sweep=Math.abs(s-o.startAngle),o.anticlockwise&&(o.sweep=qi-o.sweep),o.circumference=2*Math.PI*o.radius,o.frac=o.sweep/qi,o.length=o.circumference*o.frac,o.extents={xmin:o.cx-o.radius,xmax:o.cx+o.radius,ymin:o.cy-o.radius,ymax:o.cy+o.radius},o}return o(i,[{key:"_calcAngle",value:function(t,e){return $i({x:this.cx,y:this.cy},{x:t,y:e})}},{key:"_calcAngleForLocation",value:function(t,e){if(t.anticlockwise){var n=t.startAngle<t.endAngle?t.startAngle+qi:t.startAngle;return n-Math.abs(n-t.endAngle)*e}var i=t.endAngle<t.startAngle?t.endAngle+qi:t.endAngle,o=Math.abs(i-t.startAngle);return t.startAngle+o*e}},{key:"getPath",value:function(t){var e=this.sweep>Math.PI?1:0,n=this.anticlockwise?0:1;return(t?"M"+this.x1+" "+this.y1+" ":"")+"A "+this.radius+" "+this.radius+" 0 "+e+","+n+" "+this.x2+" "+this.y2}},{key:"getLength",value:function(){return this.length}},{key:"pointOnPath",value:function(t,e){if(0===t)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1===t)return{x:this.x2,y:this.y2,theta:this.endAngle};e&&(t/=length);var n=this._calcAngleForLocation(this,t),i=this.cx+this.radius*Math.cos(n),o=this.cy+this.radius*Math.sin(n);return{x:Oa(i),y:Oa(o),theta:n}}},{key:"gradientAtPoint",value:function(t,e){var n=this.pointOnPath(t,e),i=Zi({x:this.cx,y:this.cy},n);return this.anticlockwise||i!==1/0&&i!==-1/0||(i*=-1),i}},{key:"pointAlongPathFrom",value:function(t,e,n){var i=this.pointOnPath(t,n),o=e/this.circumference*2*Math.PI,r=this.anticlockwise?-1:1,s=i.theta+r*o;return{x:this.cx+this.radius*Math.cos(s),y:this.cy+this.radius*Math.sin(s)}}}]),i}(di);r(Ia,"segmentType","Arc");var ja=function(t){s(i,t);var e=c(i);function i(t,o){var s;return n(this,i),(s=e.call(this,t,o)).connection=t,r(u(s),"showLoopback",void 0),r(u(s),"curviness",void 0),r(u(s),"margin",void 0),r(u(s),"proximityLimit",void 0),r(u(s),"orientation",void 0),r(u(s),"loopbackRadius",void 0),r(u(s),"clockwise",void 0),r(u(s),"isLoopbackCurrently",void 0),r(u(s),"geometry",null),o=o||{},s.showLoopback=!1!==o.showLoopback,s.curviness=o.curviness||10,s.margin=o.margin||5,s.proximityLimit=o.proximityLimit||80,s.clockwise=o.orientation&&"clockwise"===o.orientation,s.loopbackRadius=o.loopbackRadius||25,s.isLoopbackCurrently=!1,s}return o(i,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(t,e){var n=e.sourcePos,i=e.targetPos,o=Math.abs(n.curX-i.curX),r=Math.abs(n.curY-i.curY);if(this.showLoopback&&e.sourceEndpoint.elementId===e.targetEndpoint.elementId){this.isLoopbackCurrently=!0;var s=e.sourcePos.curX,a=e.sourcePos.curY-this.margin,l=s,u=a-this.loopbackRadius,c=l-this.loopbackRadius,h=u-this.loopbackRadius;o=2*this.loopbackRadius,r=2*this.loopbackRadius,t.points[0]=c,t.points[1]=h,t.points[2]=o,t.points[3]=r,this._addSegment(Ia,{loopback:!0,x1:s-c+4,y1:a-h,startAngle:0,endAngle:2*Math.PI,r:this.loopbackRadius,ac:!this.clockwise,x2:s-c-4,y2:a-h,cx:l-c,cy:u-h})}else this.isLoopbackCurrently=!1,this._computeBezier(t,e,n,i,o,r)}},{key:"exportGeometry",value:function(){return null==this.geometry?null:{controlPoints:[y({},this.geometry.controlPoints[0]),y({},this.geometry.controlPoints[1])],source:y({},this.geometry.source),target:y({},this.geometry.target)}}},{key:"transformGeometry",value:function(t,e,n){return{controlPoints:[{x:t.controlPoints[0].x+e,y:t.controlPoints[0].y+n},{x:t.controlPoints[1].x+e,y:t.controlPoints[1].y+n}],source:this.transformAnchorPlacement(t.source,e,n),target:this.transformAnchorPlacement(t.target,e,n)}}},{key:"importGeometry",value:function(t){return null!=t&&(null==t.controlPoints||2!=t.controlPoints.length?(J("jsPlumb Bezier: cannot import geometry; controlPoints missing or does not have length 2"),this.setGeometry(null,!0),!1):null==t.controlPoints[0].x||null==t.controlPoints[0].y||null==t.controlPoints[1].x||null==t.controlPoints[1].y?(J("jsPlumb Bezier: cannot import geometry; controlPoints malformed"),this.setGeometry(null,!0),!1):null==t.source||null==t.source.curX||null==t.source.curY?(J("jsPlumb Bezier: cannot import geometry; source missing or malformed"),this.setGeometry(null,!0),!1):null==t.target||null==t.target.curX||null==t.target.curY?(J("jsPlumb Bezier: cannot import geometry; target missing or malformed"),this.setGeometry(null,!0),!1):(this.setGeometry(t,!1),!0))}}]),i}(ms),La={subtract:function(t,e){return{x:t.x-e.x,y:t.y-e.y}},dotProduct:function(t,e){return t.x*e.x+t.y*e.y},square:function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},scale:function(t,e){return{x:t.x*e,y:t.y*e}}},Na=64,Ga=Math.pow(2,-Na-1);function Ra(t,e){for(var n,i=[],o=function(t,e){for(var n=e.length-1,i=2*n-1,o=[],r=[],s=[],a=[],l=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],u=0;u<=n;u++)o[u]=La.subtract(e[u],t);for(var c=0;c<=n-1;c++)r[c]=La.subtract(e[c+1],e[c]),r[c]=La.scale(r[c],3);for(var h=0;h<=n-1;h++)for(var d=0;d<=n;d++)s[h]||(s[h]=[]),s[h][d]=La.dotProduct(r[h],o[d]);for(var p=0;p<=i;p++)a[p]||(a[p]=[]),a[p].y=0,a[p].x=parseFloat(""+p)/i;for(var f=n,v=n-1,g=0;g<=f+v;g++)for(var y=Math.max(0,g-v),m=Math.min(g,f),_=y;_<=m;_++){var E=g-_;a[_+E].y+=s[E][_]*l[E][_]}return a}(t,e),r=e.length-1,s=Va(o,2*r-1,i,0),a=La.subtract(t,e[0]),l=La.square(a),u=0,c=0;c<s;c++)a=La.subtract(t,Ha(e,r,i[c],null,null)),(n=La.square(a))<l&&(l=n,u=i[c]);return a=La.subtract(t,e[r]),(n=La.square(a))<l&&(l=n,u=1),{location:u,distance:l}}function Fa(t,e){var n=Ra(t,e);return{point:Ha(e,e.length-1,n.location,null,null),location:n.location}}function Va(t,e,n,i){var o,r,s=[],a=[],l=[],u=[];switch(function(t,e){var n,i,o=0;n=i=Q(t[0].y);for(var r=1;r<=e;r++)(n=Q(t[r].y))!=i&&o++,i=n;return o}(t,e)){case 0:return 0;case 1:if(i>=Na)return n[0]=(t[0].x+t[e].x)/2,1;if(function(t,e){var n,i,o,r,s,a,l,u,c,h,d,p,f;s=t[0].y-t[e].y,a=t[e].x-t[0].x,l=t[0].x*t[e].y-t[e].x*t[0].y,p=f=0;for(var v=1;v<e;v++){var g=s*t[v].x+a*t[v].y+l;g>p?p=g:g<f&&(f=g)}return n=((c=1)*(l-p)-(d=a)*(h=0))*(1/((u=0)*d-s*c)),i=(c*(l-f)-(d=a)*h)*(1/(u*d-s*c)),o=Math.min(n,i),r=Math.max(n,i),r-o<Ga?1:0}(t,e))return n[0]=function(t,e){var n=1,i=0,o=t[e].x-t[0].x,r=t[e].y-t[0].y,s=t[0].x-0,a=t[0].y-0;return 0+n*(1/(o*i-r*n)*(o*a-r*s))}(t,e),1}Ha(t,e,.5,s,a),o=Va(s,e,l,i+1),r=Va(a,e,u,i+1);for(var c=0;c<o;c++)n[c]=l[c];for(var h=0;h<r;h++)n[h+o]=u[h];return o+r}function Ha(t,e,n,i,o){for(var r=[[]],s=0;s<=e;s++)r[0][s]=t[s];for(var a=1;a<=e;a++)for(var l=0;l<=e-a;l++)r[a]||(r[a]=[]),r[a][l]||(r[a][l]={}),r[a][l].x=(1-n)*r[a-1][l].x+n*r[a-1][l+1].x,r[a][l].y=(1-n)*r[a-1][l].y+n*r[a-1][l+1].y;if(null!=i)for(var u=0;u<=e;u++)i[u]=r[u][0];if(null!=o)for(var c=0;c<=e;c++)o[c]=r[e-c][c];return r[e][0]}function Ua(t,e){var n={x:0,y:0};if(0===t)return e[0];var i=e.length-1;if(1===t)return e[i];var o=e,r=1-t;if(0===i)return e[0];if(1===i)return{x:r*o[0].x+t*o[1].x,y:r*o[0].y+t*o[1].y};if(4>i){var s,a,l,u=r*r,c=t*t,h=0;return 2===i?(o=[o[0],o[1],o[2],n],s=u,a=r*t*2,l=c):3===i&&(s=u*r,a=u*t*3,l=r*c*3,h=t*c),{x:s*o[0].x+a*o[1].x+l*o[2].x+h*o[3].x,y:s*o[0].y+a*o[1].y+l*o[2].y+h*o[3].y}}return n}function Ba(t){var e=0;if(!Wa(t))for(var n=function(t,e){var n=[];t--;for(var i=0;i<=t;i++)n.push(Ua(i/t,e));return n}(16,t),i=0;i<15;i++){e+=za(n[i],n[i+1])}return e}var Ya=new Map;function Xa(t,e){for(var n=function(t){var e=Ya.get(t);if(!e){var n=function(t){return function(e){return t}},i=function(t){return function(e){for(var n=1,i=0;i<t.length;i++)n*=t[i](e);return n}};(e=[]).push((function(e){return Math.pow(e,t)}));for(var o=1;o<t;o++){for(var r=[n(t)],s=0;s<t-o;s++)r.push((function(t){return t}));for(var a=0;a<o;a++)r.push((function(t){return 1-t}));e.push(i(r))}e.push((function(e){return Math.pow(1-e,t)})),Ya.set(t,e)}return e}(t.length-1),i=0,o=0,r=0;r<t.length;r++)i+=t[r].x*n[r](e),o+=t[r].y*n[r](e);return{x:i,y:o}}function za(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Wa(t){return t[0].x===t[1].x&&t[0].y===t[1].y}function qa(t,e,n){if(Wa(t))return{point:t[0],location:e};for(var i=Xa(t,e),o=0,r=e,s=n>0?1:-1,a=null;o<Math.abs(n);)o+=za(a=Xa(t,r+=.005*s),i),i=a;return{point:a,location:r}}function Ka(t,e,n){return qa(t,e,n).point}function Za(t,e,n){return qa(t,e,n).location}function Ja(t,e){var n=Xa(t,e),i=Xa(t.slice(0,t.length-1),e),o=i.y-n.y,r=i.x-n.x;return 0===o?1/0:Math.atan(o/r)}function Qa(t,e,n,i,o){var r=i-e,s=t-n,a=t*(e-i)+e*(n-t),l=function(t){return[$a(t,"x"),$a(t,"y")]}(o),u=[r*l[0][0]+s*l[1][0],r*l[0][1]+s*l[1][1],r*l[0][2]+s*l[1][2],r*l[0][3]+s*l[1][3]+a],c=tl.apply(null,u),h=[];if(null!=c)for(var d=0;d<3;d++){var p=c[d],f=Math.pow(p,2),v=Math.pow(p,3),g={x:l[0][0]*v+l[0][1]*f+l[0][2]*p+l[0][3],y:l[1][0]*v+l[1][1]*f+l[1][2]*p+l[1][3]},y=void 0;y=n-t!=0?(g[0]-t)/(n-t):(g[1]-e)/(i-e),p>=0&&p<=1&&y>=0&&y<=1&&h.push(g)}return h}function $a(t,e){return[-t[0][e]+3*t[1][e]+-3*t[2][e]+t[3][e],3*t[0][e]-6*t[1][e]+3*t[2][e],-3*t[0][e]+3*t[1][e],t[0][e]]}function tl(t,e,n,i){var o,r,s=e/t,a=n/t,l=i/t,u=(3*a-Math.pow(s,2))/9,c=(9*s*a-27*l-2*Math.pow(s,3))/54,h=Math.pow(u,3)+Math.pow(c,2),d=[0,0,0];if(h>=0)o=Q(c+Math.sqrt(h))*Math.pow(Math.abs(c+Math.sqrt(h)),1/3),r=Q(c-Math.sqrt(h))*Math.pow(Math.abs(c-Math.sqrt(h)),1/3),d[0]=-s/3+(o+r),d[1]=-s/3-(o+r)/2,d[2]=-s/3-(o+r)/2,0!==Math.abs(Math.sqrt(3)*(o-r)/2)&&(d[1]=-1,d[2]=-1);else{var p=Math.acos(c/Math.sqrt(-Math.pow(u,3)));d[0]=2*Math.sqrt(-u)*Math.cos(p/3)-s/3,d[1]=2*Math.sqrt(-u)*Math.cos((p+2*Math.PI)/3)-s/3,d[2]=2*Math.sqrt(-u)*Math.cos((p+4*Math.PI)/3)-s/3}for(var f=0;f<3;f++)(d[f]<0||d[f]>1)&&(d[f]=-1);return d}var el=function(t){s(i,t);var e=c(i);function i(t){var o;return n(this,i),r(u(o=e.call(this,t)),"curve",void 0),r(u(o),"cp1x",void 0),r(u(o),"cp1y",void 0),r(u(o),"cp2x",void 0),r(u(o),"cp2y",void 0),r(u(o),"length",0),r(u(o),"type",i.segmentType),o.cp1x=t.cp1x,o.cp1y=t.cp1y,o.cp2x=t.cp2x,o.cp2y=t.cp2y,o.x1=t.x1,o.x2=t.x2,o.y1=t.y1,o.y2=t.y2,o.curve=[{x:o.x1,y:o.y1},{x:o.cp1x,y:o.cp1y},{x:o.cp2x,y:o.cp2y},{x:o.x2,y:o.y2}],o.extents={xmin:Math.min(o.x1,o.x2,o.cp1x,o.cp2x),ymin:Math.min(o.y1,o.y2,o.cp1y,o.cp2y),xmax:Math.max(o.x1,o.x2,o.cp1x,o.cp2x),ymax:Math.max(o.y1,o.y2,o.cp1y,o.cp2y)},o}return o(i,[{key:"getPath",value:function(t){return(t?"M "+this.x2+" "+this.y2+" ":"")+"C "+this.cp2x+" "+this.cp2y+" "+this.cp1x+" "+this.cp1y+" "+this.x1+" "+this.y1}},{key:"pointOnPath",value:function(t,e){return t=i._translateLocation(this.curve,t,e),Xa(this.curve,t)}},{key:"gradientAtPoint",value:function(t,e){return t=i._translateLocation(this.curve,t,e),Ja(this.curve,t)}},{key:"pointAlongPathFrom",value:function(t,e,n){return t=i._translateLocation(this.curve,t,n),Ka(this.curve,t,e)}},{key:"getLength",value:function(){return null!=this.length&&0!==this.length||(this.length=Ba(this.curve)),this.length}},{key:"findClosestPointOnPath",value:function(t,e){var n=Fa({x:t,y:e},this.curve);return{d:Math.sqrt(Math.pow(n.point.x-t,2)+Math.pow(n.point.y-e,2)),x:n.point.x,y:n.point.y,l:1-n.location,s:this,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(t,e,n,i){return Qa(t,e,n,i,this.curve)}}],[{key:"_translateLocation",value:function(t,e,n){return n&&(e=Za(t,e>0?0:1,e)),e}}]),i}(di);r(el,"segmentType","Bezier");var nl=function(t){s(i,t);var e=c(i);function i(t,o){var s;return n(this,i),(s=e.call(this,t,o)).connection=t,r(u(s),"type",i.type),r(u(s),"majorAnchor",void 0),r(u(s),"minorAnchor",void 0),o=o||{},s.majorAnchor=o.curviness||150,s.minorAnchor=10,s}return o(i,[{key:"getCurviness",value:function(){return this.majorAnchor}},{key:"_findControlPoint",value:function(t,e,n,i,o){var r={x:0,y:0};return i[0]!==o[0]||i[1]===o[1]?(0===o[0]?r.x=n.curX<e.curX?t.x+this.minorAnchor:t.x-this.minorAnchor:r.x=t.x+this.majorAnchor*o[0],0===o[1]?r.y=n.curY<e.curY?t.y+this.minorAnchor:t.y-this.minorAnchor:r.y=t.y+this.majorAnchor*i[1]):(0===i[0]?r.x=e.curX<n.curX?t.x+this.minorAnchor:t.x-this.minorAnchor:r.x=t.x-this.majorAnchor*i[0],0===i[1]?r.y=e.curY<n.curY?t.y+this.minorAnchor:t.y-this.minorAnchor:r.y=t.y+this.majorAnchor*o[1]),r}},{key:"_computeBezier",value:function(t,e,n,i,o,r){var s,a,l=n.curX<i.curX?o:0,u=n.curY<i.curY?r:0,c=n.curX<i.curX?0:o,h=n.curY<i.curY?0:r;!0!==this.edited?(s=this._findControlPoint({x:l,y:u},n,i,t.so,t.to),a=this._findControlPoint({x:c,y:h},i,n,t.to,t.so)):(s=this.geometry.controlPoints[0],a=this.geometry.controlPoints[1]),this.geometry={controlPoints:[s,a],source:e.sourcePos,target:e.targetPos},this._addSegment(el,{x1:l,y1:u,x2:c,y2:h,cp1x:s.x,cp1y:s.y,cp2x:a.x,cp2y:a.y})}}]),i}(ja);r(nl,"type","Bezier");var il=function(t){s(i,t);var e=c(i);function i(t,o){var s;return n(this,i),(s=e.call(this,t,o)).connection=t,r(u(s),"type",i.type),r(u(s),"_controlPoint",void 0),s.curviness=o.curviness||10,s.margin=o.margin||5,s.proximityLimit=o.proximityLimit||80,s.clockwise=o.orientation&&"clockwise"===o.orientation,s}return o(i,[{key:"_computeBezier",value:function(t,e,n,i,o,r){var s,a,l,u,c,h,d,p,f=n.curX<i.curX?0:o,v=n.curY<i.curY?0:r,g=n.curX<i.curX?o:0,y=n.curY<i.curY?r:0;if(0===n.x&&(f-=this.margin),1===n.x&&(f+=this.margin),0===n.y&&(v-=this.margin),1===n.y&&(v+=this.margin),0===i.x&&(g-=this.margin),1===i.x&&(g+=this.margin),0===i.y&&(y-=this.margin),1===i.y&&(y+=this.margin),!0!==this.edited){var m=(f+g)/2,_=(v+y)/2,E=(a=v,u=y,(s=f)<=(l=g)&&u<=a?1:s<=l&&a<=u?2:l<=s&&u>=a?3:4),x=Math.sqrt(Math.pow(g-f,2)+Math.pow(y-v,2));this._controlPoint=function(t,e,n,i,o,r,s,a,l){return a<=l?{x:t,y:e}:1===n?i.curY<=0&&o.curY>=1?{x:t+(i.x<.5?-1*r:r),y:e}:i.curX>=1&&o.curX<=0?{x:t,y:e+(i.y<.5?-1*s:s)}:{x:t+-1*r,y:e+-1*s}:2===n?i.curY>=1&&o.curY<=0?{x:t+(i.x<.5?-1*r:r),y:e}:i.curX>=1&&o.curX<=0?{x:t,y:e+(i.y<.5?-1*s:s)}:{x:t+r,y:e+-1*s}:3===n?i.curY>=1&&o.curY<=0?{x:t+(i.x<.5?-1*r:r),y:e}:i.curX<=0&&o.curX>=1?{x:t,y:e+(i.y<.5?-1*s:s)}:{x:t+-1*r,y:e+-1*s}:4===n?i.curY<=0&&o.curY>=1?{x:t+(i.x<.5?-1*r:r),y:e}:i.curX<=0&&o.curX>=1?{x:t,y:e+(i.y<.5?-1*s:s)}:{x:t+r,y:e+-1*s}:void 0}(m,_,E,e.sourcePos,e.targetPos,this.curviness,this.curviness,x,this.proximityLimit)}else this._controlPoint=this.geometry.controlPoints[0];c=this._controlPoint.x,h=this._controlPoint.x,d=this._controlPoint.y,p=this._controlPoint.y,this.geometry={controlPoints:[this._controlPoint,this._controlPoint],source:e.sourcePos,target:e.targetPos},this._addSegment(el,{x1:g,y1:y,x2:f,y2:v,cp1x:c,cp1y:d,cp2x:h,cp2y:p})}}]),i}(ja);function ol(t){return t<0?-1:0===t?0:1}function rl(t){return[ol(t[2]-t[0]),ol(t[3]-t[1])]}function sl(t){return Math.sqrt(Math.pow(t[0]-t[2],2)+Math.pow(t[1]-t[3],2))}function al(t){var e=[];return e.push.apply(e,t),e}r(il,"type","StateMachine"),ea.register(nl.type,nl),ea.register(il.type,il);var ll=function(t){s(i,t);var e=c(i);function i(t,o){var s;return n(this,i),(s=e.call(this,t,o)).connection=t,r(u(s),"type",i.type),r(u(s),"internalSegments",[]),r(u(s),"midpoint",void 0),r(u(s),"alwaysRespectStubs",void 0),r(u(s),"cornerRadius",void 0),r(u(s),"lastx",void 0),r(u(s),"lasty",void 0),r(u(s),"lastOrientation",void 0),r(u(s),"loopbackRadius",void 0),r(u(s),"isLoopbackCurrently",void 0),s.midpoint=null==o.midpoint||isNaN(o.midpoint)?.5:o.midpoint,s.cornerRadius=null!=o.cornerRadius?o.cornerRadius:0,s.alwaysRespectStubs=!0===o.alwaysRespectStubs,s.lastx=null,s.lasty=null,s.lastOrientation=null,s.loopbackRadius=o.loopbackRadius||25,s.isLoopbackCurrently=!1,s}return o(i,[{key:"getDefaultStubs",value:function(){return[30,30]}},{key:"addASegment",value:function(t,e,n){if(this.lastx!==t||this.lasty!==e){var i=null==this.lastx?n.sx:this.lastx,o=null==this.lasty?n.sy:this.lasty,r=i===t?"v":"h";this.lastx=t,this.lasty=e,this.internalSegments.push([i,o,t,e,r])}}},{key:"writeSegments",value:function(t){for(var e,n,i,o=null,r=0;r<this.internalSegments.length-1;r++){if(o=o||al(this.internalSegments[r]),e=al(this.internalSegments[r+1]),n=rl(o),i=rl(e),this.cornerRadius>0&&o[4]!==e[4]){var s=Math.min(sl(o),sl(e)),a=Math.min(this.cornerRadius,s/2);o[2]-=n[0]*a,o[3]-=n[1]*a,e[0]+=i[0]*a,e[1]+=i[1]*a;var l=n[1]===i[0]&&1===i[0]||n[1]===i[0]&&0===i[0]&&n[0]!==i[1]||n[1]===i[0]&&-1===i[0],u=(e[1]>o[3]?1:-1)===(e[0]>o[2]?1:-1),c=u&&l||!u&&!l?e[0]:o[2],h=u&&l||!u&&!l?o[3]:e[1];this._addSegment(na,{x1:o[0],y1:o[1],x2:o[2],y2:o[3]}),this._addSegment(Ia,{r:a,x1:o[2],y1:o[3],x2:e[0],y2:e[1],cx:c,cy:h,ac:l})}else this._addSegment(na,{x1:o[0],y1:o[1],x2:o[2],y2:o[3]});o=e}null!=e&&this._addSegment(na,{x1:e[0],y1:e[1],x2:e[2],y2:e[3]})}},{key:"_compute",value:function(t,e){var n=this;this.internalSegments.length=0,this.lastx=null,this.lasty=null,this.lastOrientation=null;var i=function(e){return[t.startStubX,t.startStubY,t.endStubX,t.endStubY]},o={perpendicular:i,orthogonal:i,opposite:function(e){var i=t,o="x"===e?0:1,r={x:function(){return 1===i.so[o]&&(i.startStubX>i.endStubX&&i.tx>i.startStubX||i.sx>i.endStubX&&i.tx>i.sx)||-1===i.so[o]&&(i.startStubX<i.endStubX&&i.tx<i.startStubX||i.sx<i.endStubX&&i.tx<i.sx)},y:function(){return 1===i.so[o]&&(i.startStubY>i.endStubY&&i.ty>i.startStubY||i.sy>i.endStubY&&i.ty>i.sy)||-1===i.so[o]&&(i.startStubY<i.endStubY&&i.ty<i.startStubY||i.sy<i.endStubY&&i.ty<i.sy)}};return!n.alwaysRespectStubs&&r[e]()?{x:[(t.sx+t.tx)/2,t.startStubY,(t.sx+t.tx)/2,t.endStubY],y:[t.startStubX,(t.sy+t.ty)/2,t.endStubX,(t.sy+t.ty)/2]}[e]:[t.startStubX,t.startStubY,t.endStubX,t.endStubY]}},r=o[t.anchorOrientation](t.sourceAxis),s="x"===t.sourceAxis?0:1,a="x"===t.sourceAxis?1:0,l=r[s],u=r[a],c=r[s+2],h=r[a+2];this.addASegment(r[0],r[1],t);var d=t.startStubX+(t.endStubX-t.startStubX)*this.midpoint,p=t.startStubY+(t.endStubY-t.startStubY)*this.midpoint,f={x:[0,1],y:[1,0]},v={perpendicular:function(e,n,i,o,r){var s=t,a={x:[[s.startStubX,s.endStubX],null,[s.endStubX,s.startStubX]],y:[[s.startStubY,s.endStubY],null,[s.endStubY,s.startStubY]]},l={x:[[d,s.startStubY],[d,s.endStubY]],y:[[s.startStubX,p],[s.endStubX,p]]},u={x:[[s.endStubX,s.startStubY]],y:[[s.startStubX,s.endStubY]]},c={x:[[s.startStubX,s.endStubY],[s.endStubX,s.endStubY]],y:[[s.endStubX,s.startStubY],[s.endStubX,s.endStubY]]},h={x:[[s.startStubX,p],[s.endStubX,p],[s.endStubX,s.endStubY]],y:[[d,s.startStubY],[d,s.endStubY],[s.endStubX,s.endStubY]]},v={x:[s.startStubY,s.endStubY],y:[s.startStubX,s.endStubX]},g=f[e][0],y=f[e][1],m=s.so[g]+1,_=s.to[y]+1,E=-1===s.to[y]&&v[e][1]<v[e][0]||1===s.to[y]&&v[e][1]>v[e][0],x=a[e][m][0],b=a[e][m][1],k={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]}[e][m][_];return s.segment===k[3]||s.segment===k[2]&&E?l[e]:s.segment===k[2]&&b<x?u[e]:s.segment===k[2]&&b>=x||s.segment===k[1]&&!E?h[e]:s.segment===k[0]||s.segment===k[1]&&E?c[e]:void 0},orthogonal:function(e,n,i,o,r){var s=t,a={x:-1===s.so[0]?Math.min(n,o):Math.max(n,o),y:-1===s.so[1]?Math.min(n,o):Math.max(n,o)}[e];return{x:[[a,i],[a,r],[o,r]],y:[[i,a],[r,a],[r,o]]}[e]},opposite:function(i,o,r,a,l){var u=t,c={x:"y",y:"x"}[i],h={x:"h",y:"w"}[i],f=u["is"+i.toUpperCase()+"GreaterThanStubTimes2"];if(e.sourceEndpoint.elementId===e.targetEndpoint.elementId){var v=r+(1-e.sourceEndpoint._anchor.computedPosition[c])*e.sourceInfo[h]+n.maxStub;return{x:[[o,v],[a,v]],y:[[v,o],[v,a]]}[i]}return!f||1===u.so[s]&&o>a||-1===u.so[s]&&o<a?{x:[[o,p],[a,p]],y:[[d,o],[d,a]]}[i]:1===u.so[s]&&o<a||-1===u.so[s]&&o>a?{x:[[d,u.sy],[d,u.ty]],y:[[u.sx,p],[u.tx,p]]}[i]:void 0}},g=v[t.anchorOrientation](t.sourceAxis,l,u,c,h);if(g)for(var y=0;y<g.length;y++)this.addASegment(g[y][0],g[y][1],t);this.addASegment(r[2],r[3],t),this.addASegment(t.tx,t.ty,t),this.writeSegments(t)}},{key:"transformGeometry",value:function(t,e,n){return t}}]),i}(ms);r(ll,"type","Flowchart"),ea.register(ll.type,ll),tr.registerHandler(Ds),tr.registerHandler(Ea),tr.registerHandler(ka),ea.register(ia.type,ia);for(var ul={clientX:5e4,clientY:5e4,screenX:5e4,screenY:5e4,pageX:5e4,pageY:5e4},cl=[],hl=0;hl<256;hl++)cl[hl]=(hl<16?"0":"")+hl.toString(16);var dl=function(){function t(e,i,o){n(this,t),this._jsPlumb=e,this.ok=i,this.equal=o,r(this,"_divs",[]),r(this,"mottle",void 0),this.mottle=new Xi}return o(t,[{key:"_t",value:function(t,e,n,i){this.mottle.trigger(t,e,{pageX:n,pageY:i,screenX:n,screenY:i,clientX:n,clientY:i})}},{key:"addDiv",value:function(t,e,n,i,o,r,s){var a=document.createElement("div");return a.style.position="absolute",a.innerHTML=t,e?e.appendChild(a):this._jsPlumb.getContainer().appendChild(a),a.setAttribute("id",t),a.style.left=(null!=i?i:Math.floor(1e3*Math.random()))+"px",a.style.top=(null!=o?o:Math.floor(1e3*Math.random()))+"px",n&&(a.className=n),r&&(a.style.width=r+"px"),s&&(a.style.height=s+"px"),this._divs.push(t),a}},{key:"addDivs",value:function(t,e){for(var n=0;n<t.length;n++)this.addDiv(t[n],e)}},{key:"assertEndpointCount",value:function(t,e){var n=this._jsPlumb.getEndpoints(t),i=n?n.length:0;this.equal(i,e,t.getAttribute("data-jtk-managed")+" has "+e+(e>1||0==e?" endpoints":" endpoint"))}},{key:"_assertManagedEndpointCount",value:function(t,e){var n=this._jsPlumb.getId(t),i=this._jsPlumb._managedElements[n];this.equal(i.endpoints.length,e,n+" has "+e+" endpoints in managed record")}},{key:"_assertManagedConnectionCount",value:function(t,e){var n=this._jsPlumb.getId(t),i=this._jsPlumb._managedElements[n];this.equal(i.connections.length,e,n+" has "+e+" connections in managed record")}},{key:"_registerDiv",value:function(t){this._divs.push(t)}},{key:"makeDragStartEvt",value:function(t){var e=this.makeEvent(t),n=this._jsPlumb.getContainer();return e.clientX+=n.offsetLeft,e.screenX+=n.offsetLeft,e.pageX+=n.offsetLeft,e.clientY+=n.offsetTop,e.screenY+=n.offsetTop,e.pageY+=n.offsetTop,e}},{key:"getAttribute",value:function(t,e){return t.getAttribute(e)}},{key:"dragNodeBy",value:function(t,e,n,i){(i=i||{}).before&&i.before();var o=this.makeEvent(t);this._jsPlumb.trigger(t,pn,o),i.beforeMouseMove&&i.beforeMouseMove(),this._t(document,gn,o.pageX+e,o.pageY+n),i.beforeMouseUp&&i.beforeMouseUp(),this.mottle.trigger(document,yn,null),i.after&&i.after()}},{key:"dragNodeTo",value:function(t,e,n,i){i=i||{};var o=this._jsPlumb.viewport.getPosition(this._jsPlumb.getId(t));i.before&&i.before();var r=this.makeEvent(t);this._jsPlumb.trigger(t,pn,r);var s=this._jsPlumb.getContainer().getBoundingClientRect();i.beforeMouseMove&&i.beforeMouseMove(),this._t(document,gn,s.x+e+o.w/2,s.y+n+o.h/2),i.beforeMouseUp&&i.beforeMouseUp(),this.mottle.trigger(document,yn,null),i.after&&i.after()}},{key:"dragToGroup",value:function(t,e,n){var i=this._jsPlumb.getGroup(e),o=this._jsPlumb.viewport.getPosition(i.elId),r=o.x+o.w/2,s=o.y+o.h/2;this.dragNodeTo(t,r,s,n)}},{key:"aSyncDragNodeBy",value:function(t,e,n,i){var o=this;(i=i||{}).before&&i.before();var r=this.makeEvent(t);this._jsPlumb.trigger(t,pn,r),i.beforeMouseMove&&i.beforeMouseMove(),setTimeout((function(){o._t(document,gn,r.pageX+e,r.pageY+n),i.beforeMouseUp&&i.beforeMouseUp(),setTimeout((function(){o.mottle.trigger(document,yn,null),i.after&&i.after()}),45)}),45)}},{key:"dragANodeAround",value:function(t,e,n){this._jsPlumb.trigger(t,pn,this.makeEvent(t));for(var i,o,r=50*Math.random(),s=0;s<r;s++){var a=(i=void 0,o=void 0,i=Math.floor(2e3*Math.random()),o=Math.floor(2e3*Math.random()),{clientX:i,clientY:o,screenX:i,screenY:o,pageX:i,pageY:o});t.style.left=a.screenX+"px",t.style.top=a.screenY+"px",this._jsPlumb.trigger(document,gn,a)}e&&this.ok(e(),n||"while dragging assert"),this._jsPlumb.trigger(document,yn,ul)}},{key:"dragConnection",value:function(t,e,n,i){var o=this.getCanvas(t),r=this.getCanvas(e),s=this.makeEvent(o),a=this.makeEvent(r);i=i||{};var l=this._jsPlumb.select().length;return this._jsPlumb.trigger(o,pn,s),i.beforeMouseMove&&i.beforeMouseMove(),this._jsPlumb.trigger(n?r:document,gn,a),i.beforeMouseUp&&i.beforeMouseUp(),this._jsPlumb.trigger(n?r:document,yn,a),this._jsPlumb.select().get(l)}},{key:"aSyncDragConnection",value:function(t,e,n){var i=this;n=n||{};var o=this.getCanvas(t),r=this.getCanvas(e),s=this.makeEvent(o),a=this.makeEvent(r),l=this._jsPlumb.select().length;this._jsPlumb.trigger(o,pn,s),setTimeout((function(){n.beforeMouseMove&&n.beforeMouseMove(),i._jsPlumb.trigger(document,gn,a),setTimeout((function(){n.beforeMouseUp&&n.beforeMouseUp(),i._jsPlumb.trigger(r,yn,a),n.after&&n.after(i._jsPlumb.select().get(l))}),5)}),5)}},{key:"dragAndAbortConnection",value:function(t){var e=this.getCanvas(t),n=this.makeEvent(e);this._jsPlumb.trigger(e,pn,n),this._jsPlumb.trigger(document,gn,ul),this._jsPlumb.trigger(document,yn,ul)}},{key:"detachConnection",value:function(t,e){e=e||{};var n=this.getEndpointCanvas(t),i=this.makeEvent(n);e.before&&e.before(),this._jsPlumb.trigger(n,pn,i),e.beforeMouseMove&&e.beforeMouseMove(),this._jsPlumb.trigger(document,gn,ul),e.beforeMouseUp&&e.beforeMouseUp(),this._jsPlumb.trigger(document,yn,ul),e.after&&e.after()}},{key:"detachAndReattachConnection",value:function(t,e){e=e||{};var n=this.getEndpointCanvas(t),i=this.makeEvent(n);e.before&&e.before(),this._jsPlumb.trigger(n,pn,i),e.beforeMouseMove&&e.beforeMouseMove(),this._jsPlumb.trigger(document,gn,ul),this._jsPlumb.trigger(document,gn,i),e.beforeMouseUp&&e.beforeMouseUp(),this._jsPlumb.trigger(document,yn,i),e.after&&e.after()}},{key:"detachConnectionByTarget",value:function(t,e){this.detachConnection(t.endpoints[1],e)}},{key:"relocateTarget",value:function(t,e,n){this.relocate(t,1,e,n)}},{key:"relocate",value:function(t,e,n,i){i=i||{},n=this.getCanvas(n);var o=this.getEndpointCanvas(t.endpoints[e]),r=this.makeEvent(o),s=this.makeEvent(n);i.before&&i.before(),this._jsPlumb.trigger(o,pn,r),i.beforeMouseMove&&i.beforeMouseMove(),this._jsPlumb.trigger(document,gn,s),i.beforeMouseUp&&i.beforeMouseUp(),this._jsPlumb.trigger(n,yn,s),i.after&&i.after()}},{key:"relocateSource",value:function(t,e,n){this.relocate(t,0,e,n)}},{key:"makeEvent",value:function(t){var e=t.getBoundingClientRect(),n=e.x+e.width/2,i=e.y+e.height/2;return{clientX:n,clientY:i,screenX:n,screenY:i,pageX:n,pageY:i}}},{key:"getCanvas",value:function(t){return t.endpoint?this.getEndpointCanvas(t):t}},{key:"getEndpointCanvas",value:function(t){return t.endpoint.canvas}},{key:"getConnectionCanvas",value:function(t){return t.connector.canvas}},{key:"getEndpointCanvasPosition",value:function(t){var e=this.getEndpointCanvas(t);return{x:parseInt(e.style.left,10),y:parseInt(e.style.top,10),w:e.getAttribute("width"),h:e.getAttribute("height")}}},{key:"within",value:function(t,e,n){this.ok(Math.abs(t-e)<1e-11,n+"[expected: "+e+" got "+t+"] [diff:"+Math.abs(t-e)+"]")}},{key:"assertManagedEndpointCount",value:function(t,e){var n=this._jsPlumb.getId(t),i=this._jsPlumb._managedElements[n];this.equal(i.endpoints.length,e,n+" has "+e+" endpoints in managed record")}},{key:"assertManagedConnectionCount",value:function(t,e){var n=this._jsPlumb.getId(t),i=this._jsPlumb._managedElements[n];this.equal(i.connections.length,e,n+" has "+e+" connections in managed record")}},{key:"fireEventOnEndpoint",value:function(t){for(var e=this.getEndpointCanvas(t),n=0;n<(arguments.length<=1?0:arguments.length-1);n++)this._jsPlumb.trigger(e,n+1<1||arguments.length<=n+1?void 0:arguments[n+1])}},{key:"fireEventOnElement",value:function(t){for(var e=0;e<(arguments.length<=1?0:arguments.length-1);e++)this._jsPlumb.trigger(t,e+1<1||arguments.length<=e+1?void 0:arguments[e+1])}},{key:"fireEventOnConnection",value:function(t){for(var e=this.getConnectionCanvas(t),n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];this.fireEventOnElement.apply(this,[e].concat(i))}},{key:"clickOnConnection",value:function(t){this.fireEventOnConnection(t,ln)}},{key:"dblClickOnConnection",value:function(t){this.fireEventOnConnection(t,cn)}},{key:"tapOnConnection",value:function(t){this.fireEventOnConnection(t,pn),this.fireEventOnConnection(t,yn)}},{key:"dblTapOnConnection",value:function(t){this.fireEventOnConnection(t,pn),this.fireEventOnConnection(t,yn),this.fireEventOnConnection(t,pn),this.fireEventOnConnection(t,yn)}},{key:"clickOnElement",value:function(t,e){this._jsPlumb.trigger(t,ln,null,null,null==e?1:e)}},{key:"dblClickOnElement",value:function(t){this._jsPlumb.trigger(t,cn)}},{key:"tapOnElement",value:function(t){this._jsPlumb.trigger(t,pn),this._jsPlumb.trigger(t,yn)}},{key:"dblTapOnElement",value:function(t){this._jsPlumb.trigger(t,pn),this._jsPlumb.trigger(t,yn),this._jsPlumb.trigger(t,pn),this._jsPlumb.trigger(t,yn)}},{key:"getOverlayCanvas",value:function(t){return t.canvas||t.path}},{key:"fireEventOnOverlay",value:function(t,e,n){var i=t.getOverlay(e),o=this.getOverlayCanvas(i);this._jsPlumb.trigger(o,n)}},{key:"clickOnOverlay",value:function(t,e){this.fireEventOnOverlay(t,e,ln)}},{key:"dblClickOnOverlay",value:function(t,e){this.fireEventOnOverlay(t,e,cn)}},{key:"tapOnOverlay",value:function(t,e){this.fireEventOnOverlay(t,e,pn),this.fireEventOnOverlay(t,e,yn)}},{key:"dblTapOnOverlay",value:function(t,e){this.fireEventOnOverlay(t,e,pn),this.fireEventOnOverlay(t,e,yn),this.fireEventOnOverlay(t,e,pn),this.fireEventOnOverlay(t,e,yn)}},{key:"cleanup",value:function(){var t=this._jsPlumb.getContainer();for(var e in this._jsPlumb.destroy(),this._divs){var n=document.getElementById(this._divs[e]);n&&n.parentNode.removeChild(n)}this._divs.length=0;var i=this._jsPlumb.select().length,o=this._jsPlumb.selectEndpoints().length,r=t.querySelectorAll(".jtk-endpoint").length,s=t.querySelectorAll(".jtk-connector").length;for(var a in t.__ta)for(var l in t.__ta[a])throw"Container event bindings not empty for key "+a;if(i>0)throw"there are connections in the data model!";if(o>0)throw"there are endpoints in the data model!";if(r>0)throw"there are "+r+" endpoints left in the dom!";if(s>0)throw"there are "+s+" connections left in the dom!"}},{key:"makeContent",value:function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstChild}},{key:"length",value:function(t){var e=0;for(var n in t)t.hasOwnProperty(n)&&e++;return e}},{key:"head",value:function(t){for(var e in t)return t[e]}},{key:"uuid",value:function(){return X()}}]),t}();var pl=0;t.ABSOLUTE=Ot,t.ADD_CLASS_ACTION="add",t.ATTRIBUTE_CONTAINER=$e,t.ATTRIBUTE_GROUP=Lt,t.ATTRIBUTE_GROUP_CONTENT=tn,t.ATTRIBUTE_JTK_ENABLED=en,t.ATTRIBUTE_JTK_SCOPE=nn,t.ATTRIBUTE_MANAGED=Nt,t.ATTRIBUTE_NOT_DRAGGABLE=Gt,t.ATTRIBUTE_SCOPE=Ft,t.ATTRIBUTE_SCOPE_PREFIX=Vt,t.ATTRIBUTE_TABINDEX=Rt,t.ATTR_SCROLLABLE_LIST=Ta,t.AbstractBezierConnector=ja,t.AbstractConnector=ms,t.AbstractSegment=di,t.ArcSegment=Ia,t.ArrowOverlay=_s,t.BLOCK=wt,t.BOTTOM=rr,t.BezierConnector=nl,t.BezierSegment=el,t.BlankEndpoint=xa,t.BlankEndpointHandler=ka,t.BrowserJsPlumbInstance=ma,t.BrowserUITestSupport=dl,t.CHECK_CONDITION=Ht,t.CHECK_DROP_ALLOWED=Ut,t.CLASS_CONNECTED=Xt,t.CLASS_CONNECTOR=Bt,t.CLASS_CONNECTOR_OUTLINE=Yt,t.CLASS_DELEGATED_DRAGGABLE=Ro,t.CLASS_DRAGGABLE=Fo,t.CLASS_DRAGGED=Bo,t.CLASS_DRAG_ACTIVE=Uo,t.CLASS_DRAG_CONTAINER=Vo,t.CLASS_DRAG_HOVER=Yo,t.CLASS_ENDPOINT=zt,t.CLASS_ENDPOINT_ANCHOR_PREFIX=Qt,t.CLASS_ENDPOINT_CONNECTED=Wt,t.CLASS_ENDPOINT_DROP_ALLOWED=Zt,t.CLASS_ENDPOINT_DROP_FORBIDDEN=Jt,t.CLASS_ENDPOINT_FLOATING=Kt,t.CLASS_ENDPOINT_FULL=qt,t.CLASS_GHOST_PROXY=Ho,t.CLASS_GROUP_COLLAPSED=$t,t.CLASS_GROUP_EXPANDED=te,t.CLASS_OVERLAY=ee,t.CONNECTION=sn,t.Collicat=Lo,t.Component=as,t.Connection=ps,t.ConnectionDragSelector=Ir,t.ConnectionSelection=Gs,t.Connectors=ea,t.CustomOverlay=Ss,t.DEFAULT=fi,t.DEFAULT_KEY_ALLOW_NESTED_GROUPS=Ts,t.DEFAULT_KEY_ANCHOR="anchor",t.DEFAULT_KEY_ANCHORS="anchors",t.DEFAULT_KEY_CONNECTIONS_DETACHABLE="connectionsDetachable",t.DEFAULT_KEY_CONNECTION_OVERLAYS="connectionOverlays",t.DEFAULT_KEY_CONNECTOR="connector",t.DEFAULT_KEY_CONTAINER="container",t.DEFAULT_KEY_ENDPOINT="endpoint",t.DEFAULT_KEY_ENDPOINTS="endpoints",t.DEFAULT_KEY_ENDPOINT_HOVER_STYLE="endpointHoverStyle",t.DEFAULT_KEY_ENDPOINT_HOVER_STYLES="endpointHoverStyles",t.DEFAULT_KEY_ENDPOINT_OVERLAYS="endpointOverlays",t.DEFAULT_KEY_ENDPOINT_STYLE="endpointStyle",t.DEFAULT_KEY_ENDPOINT_STYLES="endpointStyles",t.DEFAULT_KEY_HOVER_CLASS="hoverClass",t.DEFAULT_KEY_HOVER_PAINT_STYLE="hoverPaintStyle",t.DEFAULT_KEY_LIST_STYLE="listStyle",t.DEFAULT_KEY_MAX_CONNECTIONS="maxConnections",t.DEFAULT_KEY_PAINT_STYLE=As,t.DEFAULT_KEY_REATTACH_CONNECTIONS="reattachConnections",t.DEFAULT_KEY_SCOPE=Ms,t.DEFAULT_LIST_OPTIONS=Pa,t.DiamondOverlay=xs,t.DotEndpoint=ws,t.DotEndpointHandler=Ds,t.Drag=Io,t.DragManager=Xo,t.ELEMENT=rn,t.ELEMENT_DIV=an,t.EMPTY_BOUNDS=ui,t.ENDPOINT=on,t.ERROR_SOURCE_DOES_NOT_EXIST=De,t.ERROR_SOURCE_ENDPOINT_FULL=Me,t.ERROR_TARGET_DOES_NOT_EXIST=Oe,t.ERROR_TARGET_ENDPOINT_FULL=we,t.EVENT_ANCHOR_CHANGED=ne,t.EVENT_BEFORE_START=ho,t.EVENT_CLICK=ln,t.EVENT_CONNECTION=ie,t.EVENT_CONNECTION_ABORT=An,t.EVENT_CONNECTION_CLICK=qn,t.EVENT_CONNECTION_CONTEXTMENU=ei,t.EVENT_CONNECTION_DBL_CLICK=Kn,t.EVENT_CONNECTION_DBL_TAP=Zn,t.EVENT_CONNECTION_DETACHED=re,t.EVENT_CONNECTION_DRAG=Mn,t.EVENT_CONNECTION_MOUSEDOWN=ti,t.EVENT_CONNECTION_MOUSEOUT=Jn,t.EVENT_CONNECTION_MOUSEOVER=Qn,t.EVENT_CONNECTION_MOUSEUP=$n,t.EVENT_CONNECTION_MOVED=se,t.EVENT_CONNECTION_TAP=ni,t.EVENT_CONTAINER_CHANGE=ae,t.EVENT_CONTEXTMENU=un,t.EVENT_DBL_CLICK=cn,t.EVENT_DBL_TAP=hn,t.EVENT_DRAG=po,t.EVENT_DRAG_MOVE=Cn,t.EVENT_DRAG_START=Pn,t.EVENT_DRAG_STOP=Sn,t.EVENT_DROP=fo,t.EVENT_ELEMENT_CLICK=wn,t.EVENT_ELEMENT_CONTEXTMENU=Rn,t.EVENT_ELEMENT_DBL_CLICK=Dn,t.EVENT_ELEMENT_DBL_TAP=On,t.EVENT_ELEMENT_MOUSE_DOWN=Gn,t.EVENT_ELEMENT_MOUSE_MOVE=Ln,t.EVENT_ELEMENT_MOUSE_OUT=In,t.EVENT_ELEMENT_MOUSE_OVER=jn,t.EVENT_ELEMENT_MOUSE_UP=Nn,t.EVENT_ELEMENT_TAP=Fn,t.EVENT_ENDPOINT_CLICK=Vn,t.EVENT_ENDPOINT_DBL_CLICK=Hn,t.EVENT_ENDPOINT_DBL_TAP=Un,t.EVENT_ENDPOINT_MOUSEDOWN=zn,t.EVENT_ENDPOINT_MOUSEOUT=Bn,t.EVENT_ENDPOINT_MOUSEOVER=Yn,t.EVENT_ENDPOINT_MOUSEUP=Xn,t.EVENT_ENDPOINT_REPLACED=le,t.EVENT_ENDPOINT_TAP=Wn,t.EVENT_FOCUS=dn,t.EVENT_GROUP_ADDED=de,t.EVENT_GROUP_COLLAPSE=pe,t.EVENT_GROUP_EXPAND=fe,t.EVENT_GROUP_MEMBER_ADDED=ve,t.EVENT_GROUP_MEMBER_REMOVED=ge,t.EVENT_GROUP_REMOVED=ye,t.EVENT_INTERNAL_CONNECTION=oe,t.EVENT_INTERNAL_CONNECTION_DETACHED=ce,t.EVENT_INTERNAL_ENDPOINT_UNREGISTERED=ue,t.EVENT_MANAGE_ELEMENT=he,t.EVENT_MAX_CONNECTIONS=me,t.EVENT_MOUSEDOWN=pn,t.EVENT_MOUSEENTER=fn,t.EVENT_MOUSEEXIT=vn,t.EVENT_MOUSEMOVE=gn,t.EVENT_MOUSEOUT=mn,t.EVENT_MOUSEOVER=_n,t.EVENT_MOUSEUP=yn,t.EVENT_NESTED_GROUP_ADDED=_e,t.EVENT_NESTED_GROUP_REMOVED=Ee,t.EVENT_OUT="out",t.EVENT_OVER=vo,t.EVENT_REVERT=Tn,t.EVENT_SCROLL=Ma,t.EVENT_START=co,t.EVENT_STOP=go,t.EVENT_TAP=En,t.EVENT_TOUCHEND=bn,t.EVENT_TOUCHMOVE=kn,t.EVENT_TOUCHSTART=xn,t.EVENT_UNMANAGE_ELEMENT=xe,t.EVENT_ZOOM=be,t.ElementDragHandler=Zo,t.Endpoint=us,t.EndpointFactory=tr,t.EndpointRepresentation=er,t.EndpointSelection=Ns,t.EventGenerator=Yr,t.EventManager=Xi,t.FALSE=gi,t.FIXED=It,t.FlowchartConnector=ll,t.GroupManager=js,t.INTERCEPT_BEFORE_DETACH=Pe,t.INTERCEPT_BEFORE_DRAG=Ce,t.INTERCEPT_BEFORE_DROP=Se,t.INTERCEPT_BEFORE_START_DETACH=Te,t.IS_DETACH_ALLOWED=ke,t.JsPlumbInstance=aa,t.JsPlumbList=Da,t.JsPlumbListManager=wa,t.KEY_CONNECTION_OVERLAYS=Ie,t.LEFT=ir,t.LabelOverlay=Zr,t.LightweightFloatingAnchor=lr,t.LightweightRouter=$s,t.NONE=Dt,t.OptimisticEventGenerator=Xr,t.Overlay=Wr,t.OverlayFactory=Kr,t.PROPERTY_POSITION=ii,t.PlainArrowOverlay=ks,t.REDROP_POLICY_ANY="any",t.REDROP_POLICY_ANY_SOURCE=Lr,t.REDROP_POLICY_ANY_SOURCE_OR_TARGET=Gr,t.REDROP_POLICY_ANY_TARGET=Nr,t.REDROP_POLICY_STRICT=jr,t.REMOVE_CLASS_ACTION="remove",t.RIGHT=or,t.RectangleEndpoint=_a,t.RectangleEndpointHandler=Ea,t.SELECTOR_CONNECTOR=oi,t.SELECTOR_ENDPOINT=ri,t.SELECTOR_GROUP=si,t.SELECTOR_GROUP_CONTAINER=ai,t.SELECTOR_MANAGED_ELEMENT=Ae,t.SELECTOR_OVERLAY=li,t.SELECTOR_SCROLLABLE_LIST=Aa,t.SOURCE=At,t.SOURCE_INDEX=0,t.STATIC=jt,t.StateMachineConnector=il,t.StraightConnector=ia,t.StraightSegment=na,t.TARGET=Mt,t.TARGET_INDEX=1,t.TOP=nr,t.TRUE=vi,t.TWO_PI=qi,t.UIGroup=Is,t.UINode=Os,t.UNDEFINED=pi,t.Viewport=Xs,t.WILDCARD=yi,t.X_AXIS_FACES=sr,t.Y_AXIS_FACES=ar,t._createPerimeterAnchor=Or,t._removeTypeCssHelper=rs,t._updateHoverStyle=ss,t.add=function(t,e){return{x:t.x+e.x,y:t.y+e.y}},t.addClass=ht,t.addToDictionary=H,t.addToList=function(t,e,n,i){var o=t.get(e);return null==o&&(o=[],t.set(e,o)),o[i?"unshift":"push"](n),o},t.addWithFunction=function(t,e,n){-1===O(t,n)&&t.push(e)},t.arraysEqual=T,t.att=Tt,t.bezierLineIntersection=Qa,t.boundingBoxIntersection=function(t,e){var n=[];return n.push.apply(n,Qa(t.x,t.y,t.x+t.w,t.y,e)),n.push.apply(n,Qa(t.x+t.w,t.y,t.x+t.w,t.y+t.h,e)),n.push.apply(n,Qa(t.x+t.w,t.y+t.h,t.x,t.y+t.h,e)),n.push.apply(n,Qa(t.x,t.y+t.h,t.x,t.y,e)),n},t.boxIntersection=function(t,e,n,i,o){var r=[];return r.push.apply(r,Qa(t,e,t+n,e,o)),r.push.apply(r,Qa(t+n,e,t+n,e+i,o)),r.push.apply(r,Qa(t+n,e+i,t,e+i,o)),r.push.apply(r,Qa(t,e+i,t,e,o)),r},t.classList=Pt,t.clone=C,t.cls=St,t.compoundEvent=Ze,t.computeBezierLength=Ba,t.consume=ot,t.convertToFullOverlaySpec=zr,t.createElement=vt,t.createElementNS=gt,t.createFloatingAnchor=Cr,t.createTestSupportInstance=function(t,e,n){return new dl(t,e,n)},t.createTestSupportInstanceQUnit=function(t){return new dl(t,QUnit.ok,QUnit.equal)},t.dist=za,t.distanceFromCurve=Ra,t.each=q,t.encloses=function(t,e,n){var i=t.x,o=t.x+t.w,r=t.y,s=t.y+t.h,a=e.x,l=e.x+e.w,u=e.y,c=e.y+e.h,h=function(t,e,i,o){return n?t<=e&&i>=o:t<e&&i>o};return h(i,a,o,l)&&h(r,u,s,c)},t.extend=y,t.fastTrim=W,t.filterList=g,t.filterNull=function(t){var e={};for(var n in t)null!=t[n]&&(e[n]=t[n]);return e},t.findAllWithFunction=I,t.findParent=rt,t.findWithFunction=O,t.fixPrecision=no,t.forEach=D,t.fromArray=F,t.functionChain=M,t.getAllWithFunction=L,t.getClass=ct,t.getDefaultFace=dr,t.getElementPosition=xt,t.getElementSize=bt,t.getElementType=kt,t.getEventSource=st,t.getFromSetWithFunction=N,t.getPageLocation=function(t){if(null==t)return{x:0,y:0};if(null!==t.pageX)return{x:t.pageX,y:t.pageY};var e=Di(Oi(t),0);return null!=e&&null!=e.pageX?{x:e.pageX,y:e.pageY}:{x:0,y:0}},t.getPositionOnElement=ca,t.getTouch=Di,t.getWithFunction=j,t.getsert=tt,t.gradient=Ki,t.gradientAtPoint=Ja,t.gradientAtPointAlongPathFrom=function(t,e,n){var i=qa(t,e,n);return i.location>1&&(i.location=1),i.location<0&&(i.location=0),Ja(t,i.location)},t.groupDragConstrain=ya,t.hasClass=dt,t.insertSorted=nt,t.intersects=to,t.isArrayLike=function(t){return!_(t)&&(Array.isArray(t)||ut(t))},t.isArrowOverlay=Es,t.isAssignableFrom=et,t.isBoolean=E,t.isContinuous=Ks,t.isCustomOverlay=Ps,t.isDate=b,t.isDiamondOverlay=bs,t.isDynamic=Js,t.isEdgeSupported=fr,t.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},t.isFloating=Zs,t.isFullOverlaySpec=function(t){return null!=t.type&&null!=t.options},t.isFunction=k,t.isInsideParent=lo,t.isLabelOverlay=Jr,t.isMouseDevice=Pi,t.isNamedFunction=function(t){return k(t)&&null!=t.name&&t.name.length>0},t.isNodeList=ut,t.isNumber=m,t.isObject=x,t.isPlainArrowOverlay=Cs,t.isPoint=Wa,t.isSVGElement=Ct,t.isString=_,t.isTouchDevice=Si,t.lineIntersection=io,t.lineLength=Ji,t.lineRectangleIntersection=function(t,e){var n=[];return D([[{x:e.x,y:e.y},{x:e.x+e.w,y:e.y}],[{x:e.x+e.w,y:e.y},{x:e.x+e.w,y:e.y+e.h}],[{x:e.x,y:e.y},{x:e.x,y:e.y+e.h}],[{x:e.x,y:e.y+e.h},{x:e.x+e.w,y:e.y+e.h}]],(function(e){var i=io(t,e);null!=i&&n.push(i)})),n},t.locationAlongCurveFrom=Za,t.log=J,t.logEnabled=!0,t.makeLightweightAnchorFromSpec=Tr,t.map=K,t.matchesSelector=it,t.merge=S,t.nearestPointOnCurve=Fa,t.newInstance=function(t){return new ma(function(){var t=pl+1;return pl++,t}(),t)},t.normal=Zi,t.objectsEqual=A,t.offsetRelativeToRoot=yt,t.offsetSize=mt,t.onDocumentReady=function(t){!function e(){/complete|loaded|interactive/.test(document.readyState)&&void 0!==document.body&&null!=document.body?t():setTimeout(e,9)}()},t.pageLocation=wi,t.perpendicularLineTo=ro,t.perpendicularToPathAt=function(t,e,n,i){var o=qa(t,e,i=null==i?0:i),r=Ja(t,o.location),s=Math.atan(-1/r),a=n/2*Math.sin(s),l=n/2*Math.cos(s);return[{x:o.point.x+l,y:o.point.y+a},{x:o.point.x-l,y:o.point.y-a}]},t.pointAlongCurveFrom=Ka,t.pointAlongPath=qa,t.pointOnCurve=Xa,t.pointOnLine=oo,t.populate=w,t.quadrant=Qi,t.ready=function(t){!function e(){/complete|loaded|interactive/.test(document.readyState)&&void 0!==document.body&&null!=document.body?t():setTimeout(e,9)}()},t.registerEndpointRenderer=ua,t.remove=V,t.removeClass=pt,t.removeWithFunction=R,t.replace=function(t,e,n){if(null!=t){var i=t;return e.replace(/([^\.])+/g,(function(t,e,o,r){var s=t.match(/([^\[0-9]+){1}(\[)([0-9+])/),a=function(){return i[s[1]]||(i[s[1]]=[],i[s[1]])};if(o+t.length>=r.length)s?a()[s[3]]=n:i[t]=n;else if(s){var l=a();i=l[s[3]]||(l[s[3]]={},l[s[3]])}else i=i[t]||(i[t]={},i[t]);return""})),t}},t.rotateAnchorOrientation=function(t,e){var n=z({x:t[0],y:t[1]},{x:0,y:0},e);return[Math.round(n.x),Math.round(n.y)]},t.rotatePoint=z,t.setForceMouseEvents=function(t){Ci=t},t.setForceTouchEvents=function(t){ki=t},t.setToArray=G,t.sgn=Q,t.snapToGrid=so,t.subtract=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},t.suggest=U,t.svg=Ke,t.svgWidthHeightSize=_t,t.svgXYPosition=Et,t.theta=$i,t.toggleClass=ft,t.touchCount=Ii,t.touches=Oi,t.uuid=X,t.wrap=$,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=/sm/d90c41ba596676e68b087706c5ba36d149ee23ae5fca64bd63dcd63a24128d5a.map